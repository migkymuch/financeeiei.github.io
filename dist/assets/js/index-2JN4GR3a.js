import{j as e,R as ca,L as da,T as ha,C as ua,S as rt,P as je,u as nt,c as ws,a as xa,b as fe,d as ie,e as ma,f as it,g as lt,h as ot,i as ct,k as es,O as dt,l as ht,m as ut,D as xt,n as mt,o as pt,p as pa,q as ga,I as fa,V as ja,r as va,s as ya,t as ba,v as Na,w as wa,x as Pa,y as Sa,z as Ca,A as gt,W as Da,B as Ea}from"./ui-B5TKQzyy.js";import{b as Ma,r as m}from"./vendor-DrP3ejnu.js";import{c as Ps,R as Qe,L as ft,C as os,X as cs,Y as ds,T as Ye,a as hs,P as Aa,b as ka,d as Ra,B as Ta,e as ks}from"./charts-C_qMcSg4.js";import{C as ss,D as us,T as xe,a as Rs,b as be,c as Xe,d as rs,e as Oa,f as Fa,g as Ze,X as Ie,P as Ne,S as ne,h as ae,i as _a,j as Ua,k as jt,l as $a,m as La,n as Ee,Z as qe,F as Ts,o as Os,U as Je,H as Ss,W as Ia,p as Va,q as za,r as vt,s as Ba,t as Ve,u as Ka,v as yt,G as Ga,w as Fs,L as xs,x as ms,y as ps,z as _s,R as Us,A as Ha,B as $s,I as Ls,E as Wa,M as qa}from"./icons-DtVIWNS1.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();var bt,Is=Ma;bt=Is.createRoot,Is.hydrateRoot;const Cs="-",Ja=a=>{const s=Ya(a),{conflictingClassGroups:t,conflictingClassGroupModifiers:r}=a;return{getClassGroupId:l=>{const c=l.split(Cs);return c[0]===""&&c.length!==1&&c.shift(),Nt(c,s)||Qa(l)},getConflictingClassGroupIds:(l,c)=>{const h=t[l]||[];return c&&r[l]?[...h,...r[l]]:h}}},Nt=(a,s)=>{if(a.length===0)return s.classGroupId;const t=a[0],r=s.nextPart.get(t),i=r?Nt(a.slice(1),r):void 0;if(i)return i;if(s.validators.length===0)return;const n=a.join(Cs);return s.validators.find(({validator:l})=>l(n))?.classGroupId},Vs=/^\[(.+)\]$/,Qa=a=>{if(Vs.test(a)){const s=Vs.exec(a)[1],t=s?.substring(0,s.indexOf(":"));if(t)return"arbitrary.."+t}},Ya=a=>{const{theme:s,prefix:t}=a,r={nextPart:new Map,validators:[]};return Za(Object.entries(a.classGroups),t).forEach(([n,l])=>{gs(l,r,n,s)}),r},gs=(a,s,t,r)=>{a.forEach(i=>{if(typeof i=="string"){const n=i===""?s:zs(s,i);n.classGroupId=t;return}if(typeof i=="function"){if(Xa(i)){gs(i(r),s,t,r);return}s.validators.push({validator:i,classGroupId:t});return}Object.entries(i).forEach(([n,l])=>{gs(l,zs(s,n),t,r)})})},zs=(a,s)=>{let t=a;return s.split(Cs).forEach(r=>{t.nextPart.has(r)||t.nextPart.set(r,{nextPart:new Map,validators:[]}),t=t.nextPart.get(r)}),t},Xa=a=>a.isThemeGetter,Za=(a,s)=>s?a.map(([t,r])=>{const i=r.map(n=>typeof n=="string"?s+n:typeof n=="object"?Object.fromEntries(Object.entries(n).map(([l,c])=>[s+l,c])):n);return[t,i]}):a,er=a=>{if(a<1)return{get:()=>{},set:()=>{}};let s=0,t=new Map,r=new Map;const i=(n,l)=>{t.set(n,l),s++,s>a&&(s=0,r=t,t=new Map)};return{get(n){let l=t.get(n);if(l!==void 0)return l;if((l=r.get(n))!==void 0)return i(n,l),l},set(n,l){t.has(n)?t.set(n,l):i(n,l)}}},wt="!",sr=a=>{const{separator:s,experimentalParseClassName:t}=a,r=s.length===1,i=s[0],n=s.length,l=c=>{const h=[];let x=0,f=0,j;for(let M=0;M<c.length;M++){let D=c[M];if(x===0){if(D===i&&(r||c.slice(M,M+n)===s)){h.push(c.slice(f,M)),f=M+n;continue}if(D==="/"){j=M;continue}}D==="["?x++:D==="]"&&x--}const S=h.length===0?c:c.substring(f),R=S.startsWith(wt),T=R?S.substring(1):S,w=j&&j>f?j-f:void 0;return{modifiers:h,hasImportantModifier:R,baseClassName:T,maybePostfixModifierPosition:w}};return t?c=>t({className:c,parseClassName:l}):l},tr=a=>{if(a.length<=1)return a;const s=[];let t=[];return a.forEach(r=>{r[0]==="["?(s.push(...t.sort(),r),t=[]):t.push(r)}),s.push(...t.sort()),s},ar=a=>({cache:er(a.cacheSize),parseClassName:sr(a),...Ja(a)}),rr=/\s+/,nr=(a,s)=>{const{parseClassName:t,getClassGroupId:r,getConflictingClassGroupIds:i}=s,n=[],l=a.trim().split(rr);let c="";for(let h=l.length-1;h>=0;h-=1){const x=l[h],{modifiers:f,hasImportantModifier:j,baseClassName:S,maybePostfixModifierPosition:R}=t(x);let T=!!R,w=r(T?S.substring(0,R):S);if(!w){if(!T){c=x+(c.length>0?" "+c:c);continue}if(w=r(S),!w){c=x+(c.length>0?" "+c:c);continue}T=!1}const M=tr(f).join(":"),D=j?M+wt:M,_=D+w;if(n.includes(_))continue;n.push(_);const y=i(w,T);for(let b=0;b<y.length;++b){const o=y[b];n.push(D+o)}c=x+(c.length>0?" "+c:c)}return c};function ir(){let a=0,s,t,r="";for(;a<arguments.length;)(s=arguments[a++])&&(t=Pt(s))&&(r&&(r+=" "),r+=t);return r}const Pt=a=>{if(typeof a=="string")return a;let s,t="";for(let r=0;r<a.length;r++)a[r]&&(s=Pt(a[r]))&&(t&&(t+=" "),t+=s);return t};function lr(a,...s){let t,r,i,n=l;function l(h){const x=s.reduce((f,j)=>j(f),a());return t=ar(x),r=t.cache.get,i=t.cache.set,n=c,c(h)}function c(h){const x=r(h);if(x)return x;const f=nr(h,t);return i(h,f),f}return function(){return n(ir.apply(null,arguments))}}const Y=a=>{const s=t=>t[a]||[];return s.isThemeGetter=!0,s},St=/^\[(?:([a-z-]+):)?(.+)\]$/i,or=/^\d+\/\d+$/,cr=new Set(["px","full","screen"]),dr=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,hr=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,ur=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,xr=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,mr=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,ce=a=>Se(a)||cr.has(a)||or.test(a),pe=a=>Fe(a,"length",Nr),Se=a=>!!a&&!Number.isNaN(Number(a)),ns=a=>Fe(a,"number",Se),Ue=a=>!!a&&Number.isInteger(Number(a)),pr=a=>a.endsWith("%")&&Se(a.slice(0,-1)),K=a=>St.test(a),ge=a=>dr.test(a),gr=new Set(["length","size","percentage"]),fr=a=>Fe(a,gr,Ct),jr=a=>Fe(a,"position",Ct),vr=new Set(["image","url"]),yr=a=>Fe(a,vr,Pr),br=a=>Fe(a,"",wr),$e=()=>!0,Fe=(a,s,t)=>{const r=St.exec(a);return r?r[1]?typeof s=="string"?r[1]===s:s.has(r[1]):t(r[2]):!1},Nr=a=>hr.test(a)&&!ur.test(a),Ct=()=>!1,wr=a=>xr.test(a),Pr=a=>mr.test(a),Sr=()=>{const a=Y("colors"),s=Y("spacing"),t=Y("blur"),r=Y("brightness"),i=Y("borderColor"),n=Y("borderRadius"),l=Y("borderSpacing"),c=Y("borderWidth"),h=Y("contrast"),x=Y("grayscale"),f=Y("hueRotate"),j=Y("invert"),S=Y("gap"),R=Y("gradientColorStops"),T=Y("gradientColorStopPositions"),w=Y("inset"),M=Y("margin"),D=Y("opacity"),_=Y("padding"),y=Y("saturate"),b=Y("scale"),o=Y("sepia"),d=Y("skew"),v=Y("space"),u=Y("translate"),p=()=>["auto","contain","none"],P=()=>["auto","hidden","clip","visible","scroll"],k=()=>["auto",K,s],O=()=>[K,s],Q=()=>["",ce,pe],ee=()=>["auto",Se,K],N=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],A=()=>["solid","dashed","dotted","double","none"],B=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Z=()=>["start","end","center","between","around","evenly","stretch"],te=()=>["","0",K],As=()=>["auto","avoid","all","avoid-page","page","left","right","column"],oe=()=>[Se,K];return{cacheSize:500,separator:":",theme:{colors:[$e],spacing:[ce,pe],blur:["none","",ge,K],brightness:oe(),borderColor:[a],borderRadius:["none","","full",ge,K],borderSpacing:O(),borderWidth:Q(),contrast:oe(),grayscale:te(),hueRotate:oe(),invert:te(),gap:O(),gradientColorStops:[a],gradientColorStopPositions:[pr,pe],inset:k(),margin:k(),opacity:oe(),padding:O(),saturate:oe(),scale:oe(),sepia:te(),skew:oe(),space:O(),translate:O()},classGroups:{aspect:[{aspect:["auto","square","video",K]}],container:["container"],columns:[{columns:[ge]}],"break-after":[{"break-after":As()}],"break-before":[{"break-before":As()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...N(),K]}],overflow:[{overflow:P()}],"overflow-x":[{"overflow-x":P()}],"overflow-y":[{"overflow-y":P()}],overscroll:[{overscroll:p()}],"overscroll-x":[{"overscroll-x":p()}],"overscroll-y":[{"overscroll-y":p()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[w]}],"inset-x":[{"inset-x":[w]}],"inset-y":[{"inset-y":[w]}],start:[{start:[w]}],end:[{end:[w]}],top:[{top:[w]}],right:[{right:[w]}],bottom:[{bottom:[w]}],left:[{left:[w]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Ue,K]}],basis:[{basis:k()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",K]}],grow:[{grow:te()}],shrink:[{shrink:te()}],order:[{order:["first","last","none",Ue,K]}],"grid-cols":[{"grid-cols":[$e]}],"col-start-end":[{col:["auto",{span:["full",Ue,K]},K]}],"col-start":[{"col-start":ee()}],"col-end":[{"col-end":ee()}],"grid-rows":[{"grid-rows":[$e]}],"row-start-end":[{row:["auto",{span:[Ue,K]},K]}],"row-start":[{"row-start":ee()}],"row-end":[{"row-end":ee()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",K]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",K]}],gap:[{gap:[S]}],"gap-x":[{"gap-x":[S]}],"gap-y":[{"gap-y":[S]}],"justify-content":[{justify:["normal",...Z()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Z(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Z(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[_]}],px:[{px:[_]}],py:[{py:[_]}],ps:[{ps:[_]}],pe:[{pe:[_]}],pt:[{pt:[_]}],pr:[{pr:[_]}],pb:[{pb:[_]}],pl:[{pl:[_]}],m:[{m:[M]}],mx:[{mx:[M]}],my:[{my:[M]}],ms:[{ms:[M]}],me:[{me:[M]}],mt:[{mt:[M]}],mr:[{mr:[M]}],mb:[{mb:[M]}],ml:[{ml:[M]}],"space-x":[{"space-x":[v]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[v]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",K,s]}],"min-w":[{"min-w":[K,s,"min","max","fit"]}],"max-w":[{"max-w":[K,s,"none","full","min","max","fit","prose",{screen:[ge]},ge]}],h:[{h:[K,s,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[K,s,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[K,s,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[K,s,"auto","min","max","fit"]}],"font-size":[{text:["base",ge,pe]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",ns]}],"font-family":[{font:[$e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",K]}],"line-clamp":[{"line-clamp":["none",Se,ns]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",ce,K]}],"list-image":[{"list-image":["none",K]}],"list-style-type":[{list:["none","disc","decimal",K]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[a]}],"placeholder-opacity":[{"placeholder-opacity":[D]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[a]}],"text-opacity":[{"text-opacity":[D]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...A(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",ce,pe]}],"underline-offset":[{"underline-offset":["auto",ce,K]}],"text-decoration-color":[{decoration:[a]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:O()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",K]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",K]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[D]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...N(),jr]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",fr]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},yr]}],"bg-color":[{bg:[a]}],"gradient-from-pos":[{from:[T]}],"gradient-via-pos":[{via:[T]}],"gradient-to-pos":[{to:[T]}],"gradient-from":[{from:[R]}],"gradient-via":[{via:[R]}],"gradient-to":[{to:[R]}],rounded:[{rounded:[n]}],"rounded-s":[{"rounded-s":[n]}],"rounded-e":[{"rounded-e":[n]}],"rounded-t":[{"rounded-t":[n]}],"rounded-r":[{"rounded-r":[n]}],"rounded-b":[{"rounded-b":[n]}],"rounded-l":[{"rounded-l":[n]}],"rounded-ss":[{"rounded-ss":[n]}],"rounded-se":[{"rounded-se":[n]}],"rounded-ee":[{"rounded-ee":[n]}],"rounded-es":[{"rounded-es":[n]}],"rounded-tl":[{"rounded-tl":[n]}],"rounded-tr":[{"rounded-tr":[n]}],"rounded-br":[{"rounded-br":[n]}],"rounded-bl":[{"rounded-bl":[n]}],"border-w":[{border:[c]}],"border-w-x":[{"border-x":[c]}],"border-w-y":[{"border-y":[c]}],"border-w-s":[{"border-s":[c]}],"border-w-e":[{"border-e":[c]}],"border-w-t":[{"border-t":[c]}],"border-w-r":[{"border-r":[c]}],"border-w-b":[{"border-b":[c]}],"border-w-l":[{"border-l":[c]}],"border-opacity":[{"border-opacity":[D]}],"border-style":[{border:[...A(),"hidden"]}],"divide-x":[{"divide-x":[c]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[c]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[D]}],"divide-style":[{divide:A()}],"border-color":[{border:[i]}],"border-color-x":[{"border-x":[i]}],"border-color-y":[{"border-y":[i]}],"border-color-s":[{"border-s":[i]}],"border-color-e":[{"border-e":[i]}],"border-color-t":[{"border-t":[i]}],"border-color-r":[{"border-r":[i]}],"border-color-b":[{"border-b":[i]}],"border-color-l":[{"border-l":[i]}],"divide-color":[{divide:[i]}],"outline-style":[{outline:["",...A()]}],"outline-offset":[{"outline-offset":[ce,K]}],"outline-w":[{outline:[ce,pe]}],"outline-color":[{outline:[a]}],"ring-w":[{ring:Q()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[a]}],"ring-opacity":[{"ring-opacity":[D]}],"ring-offset-w":[{"ring-offset":[ce,pe]}],"ring-offset-color":[{"ring-offset":[a]}],shadow:[{shadow:["","inner","none",ge,br]}],"shadow-color":[{shadow:[$e]}],opacity:[{opacity:[D]}],"mix-blend":[{"mix-blend":[...B(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":B()}],filter:[{filter:["","none"]}],blur:[{blur:[t]}],brightness:[{brightness:[r]}],contrast:[{contrast:[h]}],"drop-shadow":[{"drop-shadow":["","none",ge,K]}],grayscale:[{grayscale:[x]}],"hue-rotate":[{"hue-rotate":[f]}],invert:[{invert:[j]}],saturate:[{saturate:[y]}],sepia:[{sepia:[o]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[t]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[h]}],"backdrop-grayscale":[{"backdrop-grayscale":[x]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[f]}],"backdrop-invert":[{"backdrop-invert":[j]}],"backdrop-opacity":[{"backdrop-opacity":[D]}],"backdrop-saturate":[{"backdrop-saturate":[y]}],"backdrop-sepia":[{"backdrop-sepia":[o]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[l]}],"border-spacing-x":[{"border-spacing-x":[l]}],"border-spacing-y":[{"border-spacing-y":[l]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",K]}],duration:[{duration:oe()}],ease:[{ease:["linear","in","out","in-out",K]}],delay:[{delay:oe()}],animate:[{animate:["none","spin","ping","pulse","bounce",K]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[b]}],"scale-x":[{"scale-x":[b]}],"scale-y":[{"scale-y":[b]}],rotate:[{rotate:[Ue,K]}],"translate-x":[{"translate-x":[u]}],"translate-y":[{"translate-y":[u]}],"skew-x":[{"skew-x":[d]}],"skew-y":[{"skew-y":[d]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",K]}],accent:[{accent:["auto",a]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",K]}],"caret-color":[{caret:[a]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":O()}],"scroll-mx":[{"scroll-mx":O()}],"scroll-my":[{"scroll-my":O()}],"scroll-ms":[{"scroll-ms":O()}],"scroll-me":[{"scroll-me":O()}],"scroll-mt":[{"scroll-mt":O()}],"scroll-mr":[{"scroll-mr":O()}],"scroll-mb":[{"scroll-mb":O()}],"scroll-ml":[{"scroll-ml":O()}],"scroll-p":[{"scroll-p":O()}],"scroll-px":[{"scroll-px":O()}],"scroll-py":[{"scroll-py":O()}],"scroll-ps":[{"scroll-ps":O()}],"scroll-pe":[{"scroll-pe":O()}],"scroll-pt":[{"scroll-pt":O()}],"scroll-pr":[{"scroll-pr":O()}],"scroll-pb":[{"scroll-pb":O()}],"scroll-pl":[{"scroll-pl":O()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",K]}],fill:[{fill:[a,"none"]}],"stroke-w":[{stroke:[ce,pe,ns]}],stroke:[{stroke:[a,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Dt=lr(Sr);function z(...a){return Dt(Ps(a))}function we({className:a,...s}){return e.jsx(ca,{"data-slot":"tabs",className:z("flex flex-col gap-2",a),...s})}function Pe({className:a,...s}){return e.jsx(da,{"data-slot":"tabs-list",className:z("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-xl p-[3px] flex",a),...s})}function q({className:a,...s}){return e.jsx(ha,{"data-slot":"tabs-trigger",className:z("data-[state=active]:bg-card dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-xl border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",a),...s})}function J({className:a,...s}){return e.jsx(ua,{"data-slot":"tabs-content",className:z("flex-1 outline-none",a),...s})}const Bs=a=>typeof a=="boolean"?`${a}`:a===0?"0":a,Ks=Ps,Ds=(a,s)=>t=>{var r;if(s?.variants==null)return Ks(a,t?.class,t?.className);const{variants:i,defaultVariants:n}=s,l=Object.keys(i).map(x=>{const f=t?.[x],j=n?.[x];if(f===null)return null;const S=Bs(f)||Bs(j);return i[x][S]}),c=t&&Object.entries(t).reduce((x,f)=>{let[j,S]=f;return S===void 0||(x[j]=S),x},{}),h=s==null||(r=s.compoundVariants)===null||r===void 0?void 0:r.reduce((x,f)=>{let{class:j,className:S,...R}=f;return Object.entries(R).every(T=>{let[w,M]=T;return Array.isArray(M)?M.includes({...n,...c}[w]):{...n,...c}[w]===M})?[...x,j,S]:x},[]);return Ks(a,l,h,t?.class,t?.className)},Es=Ds("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9 rounded-md"}},defaultVariants:{variant:"default",size:"default"}}),U=m.forwardRef(({className:a,variant:s,size:t,asChild:r=!1,...i},n)=>{const l=r?rt:"button";return e.jsx(l,{"data-slot":"button",className:z(Es({variant:s,size:t,className:a})),ref:n,...i})});U.displayName="Button";function E({className:a,...s}){return e.jsx("div",{"data-slot":"card",className:z("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border",a),...s})}function I({className:a,...s}){return e.jsx("div",{"data-slot":"card-header",className:z("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 pt-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",a),...s})}function V({className:a,...s}){return e.jsx("h4",{"data-slot":"card-title",className:z("leading-none",a),...s})}function G({className:a,...s}){return e.jsx("p",{"data-slot":"card-description",className:z("text-muted-foreground",a),...s})}function L({className:a,...s}){return e.jsx("div",{"data-slot":"card-content",className:z("px-6 [&:last-child]:pb-6",a),...s})}const Cr=Ds("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function se({className:a,variant:s,asChild:t=!1,...r}){const i=t?rt:"span";return e.jsx(i,{"data-slot":"badge",className:z(Cr({variant:s}),a),...r})}function fs(...a){return Dt(Ps(a))}function g(a,s="THB"){return s==="THB"?new Intl.NumberFormat("th-TH",{style:"currency",currency:"THB",minimumFractionDigits:0,maximumFractionDigits:2}).format(a):new Intl.NumberFormat("en-US",{style:"currency",currency:s,minimumFractionDigits:0,maximumFractionDigits:2}).format(a)}function W(a,s=1){return new Intl.NumberFormat("th-TH",{style:"percent",minimumFractionDigits:s,maximumFractionDigits:s}).format(a/100)}function Gs(a,s=0){return new Intl.NumberFormat("th-TH",{minimumFractionDigits:s,maximumFractionDigits:s}).format(a)}function Ce(a){const s=a.replace(/[,\s]/g,"").replace(/k$/i,"000").replace(/m$/i,"000000").replace(/[^\d.-]/g,""),t=parseFloat(s);return isNaN(t)?0:t}function Hs(a,s){if(a.length===0)return;const t=Object.keys(a[0]),r=[t.join(","),...a.map(c=>t.map(h=>{const x=c[h];return typeof x=="string"&&(x.includes(",")||x.includes('"'))?`"${x.replace(/"/g,'""')}"`:x}).join(","))].join(`
`),i=new Blob([r],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(i),l=document.createElement("a");l.href=n,l.download=s,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(n)}function We({title:a,value:s,change:t,icon:r,status:i="good",description:n}){const l=()=>{switch(i){case"good":return"text-green-600";case"warning":return"text-yellow-600";case"danger":return"text-red-600";default:return"text-gray-600"}};return e.jsxs(E,{children:[e.jsxs(I,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(V,{className:"text-sm font-medium",children:a}),e.jsx("div",{className:l(),children:r})]}),e.jsxs(L,{children:[e.jsx("div",{className:"text-2xl font-bold",children:s}),t!==void 0&&e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground",children:[t>0?e.jsx(xe,{className:"w-3 h-3 mr-1"}):e.jsx(Xe,{className:"w-3 h-3 mr-1"}),W(Math.abs(t))," จากเดือนที่แล้ว"]}),n&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:n})]})]})}function Dr({currentScenario:a,financialData:s}){if(!s)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ss,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{children:"กำลังโหลดข้อมูลการเงิน..."})]})});const t=s?.kpis||{revenue:0,grossProfit:0,operatingProfit:0,primeCostPct:0,foodCostPct:0,laborPct:0,bepPerDay:0,safetyMargin:0,cmPct:0};s?.pnl;const r=s?.menus||[],i=[{month:"ม.ค.",revenue:18e4,costs:12e4,profit:6e4},{month:"ก.พ.",revenue:19e4,costs:125e3,profit:65e3},{month:"มี.ค.",revenue:2e5,costs:13e4,profit:7e4},{month:"เม.ย.",revenue:21e4,costs:135e3,profit:75e3},{month:"พ.ค.",revenue:195e3,costs:128e3,profit:67e3},{month:"มิ.ย.",revenue:205e3,costs:132e3,profit:73e3}],n=[{name:"วัตถุดิบ",value:t?.foodCostPct||0,color:"#8884d8"},{name:"แรงงาน",value:t?.laborPct||0,color:"#82ca9d"},{name:"ค่าใช้จ่ายคงที่",value:Math.max(0,100-(t?.foodCostPct||0)-(t?.laborPct||0)),color:"#ffc658"}],l=(c,h)=>{switch(c){case"primeCost":return h>65?"danger":h>55?"warning":"good";case"foodCost":return h>35?"danger":h>30?"warning":"good";case"safetyMargin":return h<20?"danger":h<40?"warning":"good";default:return"good"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"แดชบอร์ดการเงิน"}),e.jsx("p",{className:"text-muted-foreground",children:"ภาพรวมผลการดำเนินงานและตัวชี้วัดสำคัญ"})]}),e.jsxs(se,{variant:"outline",className:"text-sm",children:["สถานการณ์: ",a==="base"?"ฐาน (Base)":a]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(We,{title:"รายได้รายวัน",value:g(t.revenue),icon:e.jsx(us,{className:"h-4 w-4"}),description:"จากยอดขายประมาณ"}),e.jsx(We,{title:"กำไรขั้นต้น",value:g(t.grossProfit),icon:e.jsx(xe,{className:"h-4 w-4"}),description:`อัตรากำไรขั้นต้น ${W(t.grossProfit/t.revenue*100)}`}),e.jsx(We,{title:"Prime Cost %",value:W(t.primeCostPct),status:l("primeCost",t.primeCostPct),icon:e.jsx(Rs,{className:"h-4 w-4"}),description:"วัตถุดิบ + แรงงานโดยตรง"}),e.jsx(We,{title:"จุดคุ้มทุน/วัน",value:`${Gs(t.bepPerDay)} จาน`,icon:e.jsx(Rs,{className:"h-4 w-4"}),description:`Safety Margin: ${W(t.safetyMargin)}`,status:l("safetyMargin",t.safetyMargin)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[e.jsxs(E,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Food Cost %"}),e.jsx("div",{className:"text-xl font-bold mt-1",children:W(t.foodCostPct)})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Labor %"}),e.jsx("div",{className:"text-xl font-bold mt-1",children:W(t.laborPct)})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Avg Ticket"}),e.jsx("div",{className:"text-xl font-bold mt-1",children:g(t.avgTicket)})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"CM %"}),e.jsx("div",{className:"text-xl font-bold mt-1",children:W(t.cmPct)})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Operating Profit"}),e.jsx("div",{className:"text-xl font-bold mt-1",children:g(t.operatingProfit)})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"BEP Units/Month"}),e.jsx("div",{className:"text-xl font-bold mt-1",children:Gs(t.bepUnits)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(V,{children:"แนวโน้มรายได้และกำไร"}),e.jsx(G,{children:"6 เดือนที่ผ่านมา"})]}),e.jsx(L,{children:e.jsx(Qe,{width:"100%",height:300,children:e.jsxs(ft,{data:i,children:[e.jsx(os,{strokeDasharray:"3 3"}),e.jsx(cs,{dataKey:"month"}),e.jsx(ds,{tickFormatter:c=>g(c)}),e.jsx(Ye,{formatter:c=>g(c)}),e.jsx(hs,{type:"monotone",dataKey:"revenue",stroke:"#8884d8",strokeWidth:2,name:"รายได้"}),e.jsx(hs,{type:"monotone",dataKey:"profit",stroke:"#82ca9d",strokeWidth:2,name:"กำไร"})]})})})]}),e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(V,{children:"โครงสร้างต้นทุน"}),e.jsx(G,{children:"สัดส่วนต้นทุนต่อรายได้"})]}),e.jsx(L,{children:e.jsx(Qe,{width:"100%",height:300,children:e.jsxs(Aa,{children:[e.jsx(ka,{data:n,cx:"50%",cy:"50%",outerRadius:80,fill:"#8884d8",dataKey:"value",label:({name:c,value:h})=>`${c}: ${W(h)}`,children:n.map((c,h)=>e.jsx(Ra,{fill:c.color},`cell-${h}`))}),e.jsx(Ye,{formatter:c=>W(c)})]})})})]})]}),e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(V,{children:"ผลการดำเนินงานรายเมนู"}),e.jsx(G,{children:"Unit Economics ของแต่ละรายการอาหาร"})]}),e.jsx(L,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-2",children:"เมนู"}),e.jsx("th",{className:"text-right py-2",children:"ราคาขาย"}),e.jsx("th",{className:"text-right py-2",children:"ต้นทุนผันแปร"}),e.jsx("th",{className:"text-right py-2",children:"Contribution Margin"}),e.jsx("th",{className:"text-right py-2",children:"CM %"})]})}),e.jsx("tbody",{children:r.map(c=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 font-medium",children:c.name}),e.jsx("td",{className:"text-right py-2",children:g(c.price)}),e.jsx("td",{className:"text-right py-2",children:g(c.vc)}),e.jsx("td",{className:"text-right py-2",children:g(c.cm)}),e.jsx("td",{className:"text-right py-2",children:e.jsx(se,{variant:c.cmPct>60?"default":c.cmPct>40?"secondary":"destructive",children:W(c.cmPct)})})]},c.id))})]})})})]}),e.jsxs(E,{children:[e.jsx(I,{children:e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5 text-yellow-500"}),"ข้อเสนอแนะการปรับปรุง"]})}),e.jsx(L,{children:e.jsxs("div",{className:"space-y-3",children:[t.primeCostPct>60&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-red-50 rounded-lg",children:[e.jsx(be,{className:"w-4 h-4 text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-900",children:"Prime Cost สูงเกินมาตรฐาน"}),e.jsx("p",{className:"text-sm text-red-700",children:"ควรลดต้นทุนวัตถุดิบหรือปรับปรุงประสิทธิภาพแรงงาน"})]})]}),t.safetyMargin<30&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-yellow-50 rounded-lg",children:[e.jsx(be,{className:"w-4 h-4 text-yellow-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-yellow-900",children:"Safety Margin ต่ำ"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"ควรเพิ่มยอดขายหรือลดต้นทุนคงที่เพื่อความปลอดภัยทางการเงิน"})]})]}),r.some(c=>c.cmPct<40)&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-blue-50 rounded-lg",children:[e.jsx(xe,{className:"w-4 h-4 text-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:"เมนูที่ควรปรับปรุง CM"}),e.jsx("p",{className:"text-sm text-blue-700",children:"บางเมนูมี Contribution Margin ต่ำ ควรทบทวนราคาขายหรือต้นทุน"})]})]})]})})]})]})}function H({className:a,type:s,...t}){return e.jsx("input",{type:s,"data-slot":"input",className:z("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",a),...t})}var Er="Label",Et=m.forwardRef((a,s)=>e.jsx(je.label,{...a,ref:s,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(a.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));Et.displayName=Er;var Mr=Et;function F({className:a,...s}){return e.jsx(Mr,{"data-slot":"label",className:z("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",a),...s})}var Mt=["PageUp","PageDown"],At=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],kt={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},_e="Slider",[js,Ar,kr]=xa(_e),[Rt]=ws(_e,[kr]),[Rr,ts]=Rt(_e),Tt=m.forwardRef((a,s)=>{const{name:t,min:r=0,max:i=100,step:n=1,orientation:l="horizontal",disabled:c=!1,minStepsBetweenThumbs:h=0,defaultValue:x=[r],value:f,onValueChange:j=()=>{},onValueCommit:S=()=>{},inverted:R=!1,form:T,...w}=a,M=m.useRef(new Set),D=m.useRef(0),y=l==="horizontal"?Tr:Or,[b=[],o]=nt({prop:f,defaultProp:x,onChange:k=>{[...M.current][D.current]?.focus(),j(k)}}),d=m.useRef(b);function v(k){const O=Lr(b,k);P(k,O)}function u(k){P(k,D.current)}function p(){const k=d.current[D.current];b[D.current]!==k&&S(b)}function P(k,O,{commit:Q}={commit:!1}){const ee=Br(n),N=Kr(Math.round((k-r)/n)*n+r,ee),A=it(N,[r,i]);o((B=[])=>{const Z=Ur(B,A,O);if(zr(Z,h*n)){D.current=Z.indexOf(A);const te=String(Z)!==String(B);return te&&Q&&S(Z),te?Z:B}else return B})}return e.jsx(Rr,{scope:a.__scopeSlider,name:t,disabled:c,min:r,max:i,valueIndexToChangeRef:D,thumbs:M.current,values:b,orientation:l,form:T,children:e.jsx(js.Provider,{scope:a.__scopeSlider,children:e.jsx(js.Slot,{scope:a.__scopeSlider,children:e.jsx(y,{"aria-disabled":c,"data-disabled":c?"":void 0,...w,ref:s,onPointerDown:fe(w.onPointerDown,()=>{c||(d.current=b)}),min:r,max:i,inverted:R,onSlideStart:c?void 0:v,onSlideMove:c?void 0:u,onSlideEnd:c?void 0:p,onHomeKeyDown:()=>!c&&P(r,0,{commit:!0}),onEndKeyDown:()=>!c&&P(i,b.length-1,{commit:!0}),onStepKeyDown:({event:k,direction:O})=>{if(!c){const N=Mt.includes(k.key)||k.shiftKey&&At.includes(k.key)?10:1,A=D.current,B=b[A],Z=n*N*O;P(B+Z,A,{commit:!0})}}})})})})});Tt.displayName=_e;var[Ot,Ft]=Rt(_e,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Tr=m.forwardRef((a,s)=>{const{min:t,max:r,dir:i,inverted:n,onSlideStart:l,onSlideMove:c,onSlideEnd:h,onStepKeyDown:x,...f}=a,[j,S]=m.useState(null),R=ie(s,y=>S(y)),T=m.useRef(void 0),w=ma(i),M=w==="ltr",D=M&&!n||!M&&n;function _(y){const b=T.current||j.getBoundingClientRect(),o=[0,b.width],v=Ms(o,D?[t,r]:[r,t]);return T.current=b,v(y-b.left)}return e.jsx(Ot,{scope:a.__scopeSlider,startEdge:D?"left":"right",endEdge:D?"right":"left",direction:D?1:-1,size:"width",children:e.jsx(_t,{dir:w,"data-orientation":"horizontal",...f,ref:R,style:{...f.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:y=>{const b=_(y.clientX);l?.(b)},onSlideMove:y=>{const b=_(y.clientX);c?.(b)},onSlideEnd:()=>{T.current=void 0,h?.()},onStepKeyDown:y=>{const o=kt[D?"from-left":"from-right"].includes(y.key);x?.({event:y,direction:o?-1:1})}})})}),Or=m.forwardRef((a,s)=>{const{min:t,max:r,inverted:i,onSlideStart:n,onSlideMove:l,onSlideEnd:c,onStepKeyDown:h,...x}=a,f=m.useRef(null),j=ie(s,f),S=m.useRef(void 0),R=!i;function T(w){const M=S.current||f.current.getBoundingClientRect(),D=[0,M.height],y=Ms(D,R?[r,t]:[t,r]);return S.current=M,y(w-M.top)}return e.jsx(Ot,{scope:a.__scopeSlider,startEdge:R?"bottom":"top",endEdge:R?"top":"bottom",size:"height",direction:R?1:-1,children:e.jsx(_t,{"data-orientation":"vertical",...x,ref:j,style:{...x.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:w=>{const M=T(w.clientY);n?.(M)},onSlideMove:w=>{const M=T(w.clientY);l?.(M)},onSlideEnd:()=>{S.current=void 0,c?.()},onStepKeyDown:w=>{const D=kt[R?"from-bottom":"from-top"].includes(w.key);h?.({event:w,direction:D?-1:1})}})})}),_t=m.forwardRef((a,s)=>{const{__scopeSlider:t,onSlideStart:r,onSlideMove:i,onSlideEnd:n,onHomeKeyDown:l,onEndKeyDown:c,onStepKeyDown:h,...x}=a,f=ts(_e,t);return e.jsx(je.span,{...x,ref:s,onKeyDown:fe(a.onKeyDown,j=>{j.key==="Home"?(l(j),j.preventDefault()):j.key==="End"?(c(j),j.preventDefault()):Mt.concat(At).includes(j.key)&&(h(j),j.preventDefault())}),onPointerDown:fe(a.onPointerDown,j=>{const S=j.target;S.setPointerCapture(j.pointerId),j.preventDefault(),f.thumbs.has(S)?S.focus():r(j)}),onPointerMove:fe(a.onPointerMove,j=>{j.target.hasPointerCapture(j.pointerId)&&i(j)}),onPointerUp:fe(a.onPointerUp,j=>{const S=j.target;S.hasPointerCapture(j.pointerId)&&(S.releasePointerCapture(j.pointerId),n(j))})})}),Ut="SliderTrack",$t=m.forwardRef((a,s)=>{const{__scopeSlider:t,...r}=a,i=ts(Ut,t);return e.jsx(je.span,{"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation,...r,ref:s})});$t.displayName=Ut;var vs="SliderRange",Lt=m.forwardRef((a,s)=>{const{__scopeSlider:t,...r}=a,i=ts(vs,t),n=Ft(vs,t),l=m.useRef(null),c=ie(s,l),h=i.values.length,x=i.values.map(S=>zt(S,i.min,i.max)),f=h>1?Math.min(...x):0,j=100-Math.max(...x);return e.jsx(je.span,{"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,...r,ref:c,style:{...a.style,[n.startEdge]:f+"%",[n.endEdge]:j+"%"}})});Lt.displayName=vs;var ys="SliderThumb",It=m.forwardRef((a,s)=>{const t=Ar(a.__scopeSlider),[r,i]=m.useState(null),n=ie(s,c=>i(c)),l=m.useMemo(()=>r?t().findIndex(c=>c.ref.current===r):-1,[t,r]);return e.jsx(Fr,{...a,ref:n,index:l})}),Fr=m.forwardRef((a,s)=>{const{__scopeSlider:t,index:r,name:i,...n}=a,l=ts(ys,t),c=Ft(ys,t),[h,x]=m.useState(null),f=ie(s,_=>x(_)),j=h?l.form||!!h.closest("form"):!0,S=lt(h),R=l.values[r],T=R===void 0?0:zt(R,l.min,l.max),w=$r(r,l.values.length),M=S?.[c.size],D=M?Ir(M,T,c.direction):0;return m.useEffect(()=>{if(h)return l.thumbs.add(h),()=>{l.thumbs.delete(h)}},[h,l.thumbs]),e.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[c.startEdge]:`calc(${T}% + ${D}px)`},children:[e.jsx(js.ItemSlot,{scope:a.__scopeSlider,children:e.jsx(je.span,{role:"slider","aria-label":a["aria-label"]||w,"aria-valuemin":l.min,"aria-valuenow":R,"aria-valuemax":l.max,"aria-orientation":l.orientation,"data-orientation":l.orientation,"data-disabled":l.disabled?"":void 0,tabIndex:l.disabled?void 0:0,...n,ref:f,style:R===void 0?{display:"none"}:a.style,onFocus:fe(a.onFocus,()=>{l.valueIndexToChangeRef.current=r})})}),j&&e.jsx(Vt,{name:i??(l.name?l.name+(l.values.length>1?"[]":""):void 0),form:l.form,value:R},r)]})});It.displayName=ys;var _r="RadioBubbleInput",Vt=m.forwardRef(({__scopeSlider:a,value:s,...t},r)=>{const i=m.useRef(null),n=ie(i,r),l=ot(s);return m.useEffect(()=>{const c=i.current;if(!c)return;const h=window.HTMLInputElement.prototype,f=Object.getOwnPropertyDescriptor(h,"value").set;if(l!==s&&f){const j=new Event("input",{bubbles:!0});f.call(c,s),c.dispatchEvent(j)}},[l,s]),e.jsx(je.input,{style:{display:"none"},...t,ref:n,defaultValue:s})});Vt.displayName=_r;function Ur(a=[],s,t){const r=[...a];return r[t]=s,r.sort((i,n)=>i-n)}function zt(a,s,t){const n=100/(t-s)*(a-s);return it(n,[0,100])}function $r(a,s){return s>2?`Value ${a+1} of ${s}`:s===2?["Minimum","Maximum"][a]:void 0}function Lr(a,s){if(a.length===1)return 0;const t=a.map(i=>Math.abs(i-s)),r=Math.min(...t);return t.indexOf(r)}function Ir(a,s,t){const r=a/2,n=Ms([0,50],[0,r]);return(r-n(s)*t)*t}function Vr(a){return a.slice(0,-1).map((s,t)=>a[t+1]-s)}function zr(a,s){if(s>0){const t=Vr(a);return Math.min(...t)>=s}return!0}function Ms(a,s){return t=>{if(a[0]===a[1]||s[0]===s[1])return s[0];const r=(s[1]-s[0])/(a[1]-a[0]);return s[0]+r*(t-a[0])}}function Br(a){return(String(a).split(".")[1]||"").length}function Kr(a,s){const t=Math.pow(10,s);return Math.round(a*t)/t}var Gr=Tt,Hr=$t,Wr=Lt,qr=It;function ye({className:a,defaultValue:s,value:t,min:r=0,max:i=100,...n}){const l=m.useMemo(()=>Array.isArray(t)?t:Array.isArray(s)?s:[r,i],[t,s,r,i]);return e.jsxs(Gr,{"data-slot":"slider",defaultValue:s,value:t,min:r,max:i,className:z("relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",a),...n,children:[e.jsx(Hr,{"data-slot":"slider-track",className:z("bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-4 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5"),children:e.jsx(Wr,{"data-slot":"slider-range",className:z("bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full")})}),Array.from({length:l.length},(c,h)=>e.jsx(qr,{"data-slot":"slider-thumb",className:"border-primary bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"},h))]})}class Ws{data={};scenarios={};constructor(){this.initializeDefaultData()}init(){this.loadFromStorage()}initializeDefaultData(){this.data={meta:{currency:"THB",vatPercent:7,openDays:["Mon","Tue","Wed","Thu","Fri","Sat"],operatingHours:{open:"07:00",close:"15:00"}},menus:[{id:"khao_man_gai",name:"ข้าวมันไก่",price:50,channelMix:{dineIn:.7,takeaway:.2,delivery:.1},bom:[{item:"chicken_thigh",qtyG:120,unitCostPerKg:70,yieldPercent:85,wastePercent:5},{item:"rice",qtyG:180,unitCostPerKg:30,yieldPercent:95,wastePercent:2},{item:"sauce",qtyG:30,unitCostPerKg:60,yieldPercent:100,wastePercent:0},{item:"packaging",qtyG:0,unitCostPerKg:0,yieldPercent:100,wastePercent:0,packaging:{qtyUnit:1,unitCost:2.5}}]}],salesModel:{forecastDailyUnits:120,seasonality:{Jan:.9,Feb:.95,Mar:1,Apr:1.1,May:1,Jun:.9,Jul:.9,Aug:1.1,Sep:1,Oct:1,Nov:1.1,Dec:1.2},paymentFeePercent:1.5,deliveryCommissionPercent:25},utilities:[{id:"ac_main",type:"electric",device:"เครื่องปรับอากาศ",kw:2.5,hoursPerDay:6,ratePerKwh:5},{id:"rice_cooker",type:"electric",device:"หม้อหุงข้าว",kw:1.8,hoursPerDay:3,ratePerKwh:5},{id:"gas_stove",type:"lpg",device:"เตาแก๊ส",kgPerBatch:.25,batchesPerDay:2,ratePerKg:29.33}],labor:[{id:"kitchen_chef",role:"พ่อครัว",type:"direct",wagePerHour:45,hoursPerDay:8,daysPerWeek:6},{id:"cashier",role:"แคชเชียร์",type:"indirect",wagePerHour:40,hoursPerDay:6,daysPerWeek:6}],fixedCosts:[{id:"rent",name:"ค่าเช่า",amountPerMonth:0},{id:"internet",name:"อินเทอร์เน็ต",amountPerMonth:700},{id:"maintenance",name:"ซ่อมบำรุง",amountPerMonth:1e3},{id:"depreciation",name:"ค่าเสื่อมราคา",amountPerMonth:1500}]},this.scenarios={base:{id:"base",name:"ฐาน (Base)",deltas:{}},S1:{id:"S1",name:"สถานการณ์ 1",deltas:{menuPriceDeltaPercent:5,ingredientCostDeltaPercent:8}}}}compute(){try{if(!this.validateData())return console.error("Data validation failed"),this.getDefaultComputationResult();const s=this.calculatePnL(),t=this.calculateKPIs(s),r=this.calculateMenuMetrics();return{pnl:s,kpis:t,menus:r,sensitivity:this.calculateSensitivity(),computedAt:new Date().toISOString(),dataVersion:this.getDataVersion()}}catch(s){return console.error("Failed to load stored data:",s instanceof Error?s.message:String(s)),this.getDefaultComputationResult()}}validateData(){try{return this.data?!this.data.menus||!Array.isArray(this.data.menus)||this.data.menus.length===0?(console.warn("No menus data available"),!1):!this.data.salesModel||typeof this.data.salesModel.forecastDailyUnits!="number"?(console.warn("Invalid sales model data"),!1):!Array.isArray(this.data.utilities)||!Array.isArray(this.data.labor)||!Array.isArray(this.data.fixedCosts)?(console.warn("Invalid utilities, labor, or fixed costs data"),!1):!0:(console.warn("No data available"),!1)}catch(s){return console.error("Error validating data:",s),!1}}getDefaultComputationResult(){return{pnl:{daily:{revenue:0,cogs:0,grossProfit:0,operatingExpenses:0,operatingProfit:0},monthly:{revenue:0,cogs:0,grossProfit:0,operatingExpenses:0,operatingProfit:0}},kpis:this.getDefaultFinancialMetrics(),menus:[],sensitivity:{variable:"ingredient_cost",series:[]},computedAt:new Date().toISOString(),dataVersion:this.getDataVersion(),error:"Computation failed due to invalid data"}}getDataVersion(){try{const s=JSON.stringify(this.data);return btoa(s).substring(0,8)}catch{return"unknown"}}calculatePnL(){const s=this.calculateDailyRevenue(),t=this.calculateDailyCOGS(),r=this.calculateMonthlyFixedCosts(),i=this.calculateMonthlyLaborCosts(),n=this.calculateMonthlyUtilityCosts(),l=s-t,c=(r+i+n)/30,h=l-c;return{daily:{revenue:s,cogs:t,grossProfit:l,operatingExpenses:c,operatingProfit:h},monthly:{revenue:s*30,cogs:t*30,grossProfit:l*30,operatingExpenses:r+i+n,operatingProfit:h*30}}}calculateDailyRevenue(){return!this.data.salesModel||typeof this.data.salesModel.forecastDailyUnits!="number"?(console.warn("Invalid sales model data:",this.data.salesModel),0):!this.data.menus||!Array.isArray(this.data.menus)?(console.warn("Invalid menus data:",this.data.menus),0):this.data.menus.reduce((s,t)=>{if(!t||typeof t.price!="number"||!t.channelMix)return console.warn("Invalid menu data:",t),s;const{dineIn:r,takeaway:i,delivery:n}=t.channelMix;if(typeof r!="number"||typeof i!="number"||typeof n!="number")return console.warn("Invalid channel mix data:",t.channelMix),s;const l=Math.max(0,r),c=Math.max(0,i),h=Math.max(0,n),x=this.data.salesModel.forecastDailyUnits*(l+c+h);return s+t.price*x},0)}calculateDailyCOGS(){return this.data.menus.reduce((s,t)=>{const r=this.data.salesModel.forecastDailyUnits,i=this.calculateVariableCostPerUnit(t);return s+i*r},0)}calculateVariableCostPerUnit(s){return!s||!s.bom||!Array.isArray(s.bom)?(console.warn("Invalid menu or BOM data:",s),0):s.bom.reduce((t,r)=>{if(!r)return console.warn("Invalid BOM item:",r),t;if(r.packaging)return typeof r.packaging.qtyUnit!="number"||typeof r.packaging.unitCost!="number"?(console.warn("Invalid packaging data:",r.packaging),t):t+r.packaging.qtyUnit*r.packaging.unitCost;if(typeof r.qtyG!="number"||typeof r.unitCostPerKg!="number"||typeof r.yieldPercent!="number"||typeof r.wastePercent!="number")return console.warn("Invalid ingredient data:",r),t;if(r.yieldPercent<=0)return console.warn("Invalid yield percentage (must be > 0):",r.yieldPercent),t;const i=Math.max(0,r.wastePercent),n=r.yieldPercent/100,l=1+i/100,h=r.qtyG/1e3*l/n;return t+h*r.unitCostPerKg},0)}calculateMonthlyFixedCosts(){return this.data.fixedCosts.reduce((s,t)=>s+t.amountPerMonth,0)}calculateMonthlyLaborCosts(){return this.data.labor.reduce((s,t)=>{const r=t.hoursPerDay*t.daysPerWeek*4.33;return s+t.wagePerHour*r},0)}calculateMonthlyUtilityCosts(){return this.data.utilities.reduce((s,t)=>{let r=0;return t.type==="electric"&&t.kw&&t.hoursPerDay&&t.ratePerKwh?r=t.kw*t.hoursPerDay*t.ratePerKwh:t.type==="lpg"&&t.kgPerBatch&&t.batchesPerDay&&t.ratePerKg?r=t.kgPerBatch*t.batchesPerDay*t.ratePerKg:t.type==="water"&&t.m3PerDay&&t.ratePerM3&&(r=t.m3PerDay*t.ratePerM3),s+r*30},0)}calculateKPIs(s){if(!s||!s.daily)return console.warn("Invalid PnL data:",s),this.getDefaultFinancialMetrics();const t=s.daily.revenue||0,r=s.daily.grossProfit||0,i=s.daily.operatingProfit||0;if(!this.data.menus||!Array.isArray(this.data.menus)||this.data.menus.length===0)return console.warn("No menus data available for KPI calculation"),this.getDefaultFinancialMetrics();const l=this.data.menus.reduce((o,d)=>{if(!d||typeof d.price!="number")return console.warn("Invalid menu data for CM calculation:",d),o;const v=this.calculateVariableCostPerUnit(d),u=d.price-v;return o+u},0)/this.data.menus.length,c=this.calculateMonthlyFixedCosts()+this.calculateMonthlyLaborCosts()+this.calculateMonthlyUtilityCosts(),h=l>0?c/l:0,x=h/30,f=this.data.labor.filter(o=>o&&o.type==="direct").reduce((o,d)=>!d||typeof d.wagePerHour!="number"||typeof d.hoursPerDay!="number"?(console.warn("Invalid labor data:",d),o):o+d.wagePerHour*d.hoursPerDay,0),j=s.daily.cogs||0,S=j+f,R=t>0?S/t*100:0,T=t>0?j/t*100:0,w=t>0?f/t*100:0,M=this.data.menus.reduce((o,d)=>o+(d?.price||0),0)/this.data.menus.length,D=M>0?l/M*100:0,_=this.data.salesModel?.forecastDailyUnits||0,y=_>0?(_-x)/_*100:0,b=_>0?t/_:0;return{revenue:t,grossProfit:r,operatingProfit:i,netProfit:i,primeCostPct:R,foodCostPct:T,laborPct:w,cmPct:D,bepUnits:h,bepPerDay:x,safetyMargin:y,avgTicket:b}}getDefaultFinancialMetrics(){return{revenue:0,grossProfit:0,operatingProfit:0,netProfit:0,primeCostPct:0,foodCostPct:0,laborPct:0,cmPct:0,bepUnits:0,bepPerDay:0,safetyMargin:0,avgTicket:0}}calculateMenuMetrics(){return this.data.menus.map(s=>{const t=this.calculateVariableCostPerUnit(s),r=s.price-t,i=r/s.price*100;return{id:s.id,name:s.name,price:s.price,vc:t,cm:r,cmPct:i}})}calculateSensitivity(){return{variable:"ingredient_cost",series:[{change:-10,impact:15},{change:-5,impact:7.5},{change:0,impact:0},{change:5,impact:-7.5},{change:10,impact:-15}]}}save(){try{localStorage.setItem("finance_data",JSON.stringify(this.data)),localStorage.setItem("finance_scenarios",JSON.stringify(this.scenarios)),console.log("[FinanceEngine] save() called. menus:",Array.isArray(this.data?.menus)?this.data.menus.length:0)}catch(s){console.error("[FinanceEngine] save() failed:",s instanceof Error?s.message:String(s))}}load(s){this.data=s}loadFromStorage(){const s=localStorage.getItem("finance_data"),t=localStorage.getItem("finance_scenarios");if(s)try{this.data=JSON.parse(s)}catch(r){console.error("Failed to load stored data:",r instanceof Error?r.message:String(r))}if(t)try{this.scenarios=JSON.parse(t)}catch(r){console.error("Failed to load stored scenarios:",r instanceof Error?r.message:String(r))}}exportJSON(){return JSON.stringify({data:this.data,scenarios:this.scenarios,exportDate:new Date().toISOString()},null,2)}importJSON(s){try{if(!s||typeof s!="string")return{success:!1,error:"Invalid JSON string provided"};const t=JSON.parse(s);if(!t.data||!t.scenarios)return{success:!1,error:"Invalid data structure: missing data or scenarios"};if(!Array.isArray(t.data.menus)||!Array.isArray(t.data.utilities)||!Array.isArray(t.data.labor)||!Array.isArray(t.data.fixedCosts))return{success:!1,error:"Invalid data structure: arrays expected for menus, utilities, labor, and fixedCosts"};const r={data:JSON.parse(JSON.stringify(this.data)),scenarios:JSON.parse(JSON.stringify(this.scenarios))};try{return this.data=t.data,this.scenarios=t.scenarios,this.validateData()?(this.save(),{success:!0}):(this.data=r.data,this.scenarios=r.scenarios,{success:!1,error:"Imported data failed validation"})}catch(i){return this.data=r.data,this.scenarios=r.scenarios,{success:!1,error:`Data validation failed: ${i instanceof Error?i.message:String(i)}`}}}catch(t){return console.error("Failed to import JSON:",t instanceof Error?t.message:String(t)),{success:!1,error:`JSON parsing failed: ${t instanceof Error?t.message:String(t)}`}}}getData(){return this.data}getScenarios(){return this.scenarios}updateMenu(s,t){const r=this.data.menus.findIndex(i=>i.id===s);r>=0&&(this.data.menus[r]={...this.data.menus[r],...t},this.save())}addMenu(s){this.data.menus||(this.data.menus=[]),this.data.menus.some(r=>r.id===s.id)||(this.data.menus.push(s),console.log("[FinanceEngine] addMenu:",s.id),this.save())}deleteMenu(s){try{if(!this.data||!Array.isArray(this.data.menus))return;const t=this.data.menus.length;this.data.menus=this.data.menus.filter(i=>i.id!==s);const r=this.data.menus.length;r!==t&&(console.log("[FinanceEngine] deleteMenu:",s,"remaining:",r),this.save())}catch(t){console.error("[FinanceEngine] deleteMenu failed:",t instanceof Error?t.message:String(t))}}updateSalesModel(s){this.data.salesModel={...this.data.salesModel,...s},this.save()}updateUtilities(s){this.data.utilities=s,this.save()}updateLabor(s){this.data.labor=s,this.save()}updateFixedCosts(s){this.data.fixedCosts=s,this.save()}}class ve{static MIN_PRICE=.01;static MAX_PRICE=1e4;static MIN_QUANTITY=0;static MAX_QUANTITY=1e4;static MIN_PERCENTAGE=0;static MAX_PERCENTAGE=1e3;static MIN_HOURS=0;static MAX_HOURS=24;static MIN_DAYS=0;static MAX_DAYS=7;static validateMenuItem(s){const t=[],r=[];if((!s.id||typeof s.id!="string")&&t.push("Menu ID is required and must be a string"),(!s.name||typeof s.name!="string")&&t.push("Menu name is required and must be a string"),typeof s.price!="number"||isNaN(s.price)?t.push("Price must be a valid number"):(s.price<this.MIN_PRICE&&t.push(`Price must be at least ${this.MIN_PRICE}`),s.price>this.MAX_PRICE&&r.push(`Price seems high: ${s.price}. Please verify.`)),!s.channelMix)t.push("Channel mix is required");else{const{dineIn:i,takeaway:n,delivery:l}=s.channelMix,c=(i||0)+(n||0)+(l||0);c<=0&&t.push("Channel mix total must be greater than 0"),c>1.5&&r.push(`Channel mix total (${c}) seems high. Please verify.`)}return Array.isArray(s.bom)?s.bom.forEach((i,n)=>{const l=this.validateBOMItem(i);l.errors.forEach(c=>t.push(`BOM item ${n+1}: ${c}`)),l.warnings.forEach(c=>r.push(`BOM item ${n+1}: ${c}`))}):t.push("BOM must be an array"),{isValid:t.length===0,errors:t,warnings:r}}static validateBOMItem(s){const t=[],r=[];return(!s.item||typeof s.item!="string")&&t.push("Item name is required"),typeof s.qtyG!="number"||isNaN(s.qtyG)?t.push("Quantity (grams) must be a valid number"):(s.qtyG<this.MIN_QUANTITY&&t.push(`Quantity must be at least ${this.MIN_QUANTITY}`),s.qtyG>this.MAX_QUANTITY&&r.push(`Quantity seems high: ${s.qtyG}g. Please verify.`)),typeof s.unitCostPerKg!="number"||isNaN(s.unitCostPerKg)?t.push("Unit cost per kg must be a valid number"):(s.unitCostPerKg<0&&t.push("Unit cost cannot be negative"),s.unitCostPerKg>1e3&&r.push(`Unit cost seems high: ${s.unitCostPerKg} THB/kg. Please verify.`)),typeof s.yieldPercent!="number"||isNaN(s.yieldPercent)?t.push("Yield percentage must be a valid number"):(s.yieldPercent<=0&&t.push("Yield percentage must be greater than 0"),s.yieldPercent>100&&r.push(`Yield percentage (${s.yieldPercent}%) seems high. Please verify.`)),typeof s.wastePercent!="number"||isNaN(s.wastePercent)?t.push("Waste percentage must be a valid number"):(s.wastePercent<0&&t.push("Waste percentage cannot be negative"),s.wastePercent>50&&r.push(`Waste percentage (${s.wastePercent}%) seems high. Please verify.`)),s.packaging&&((typeof s.packaging.qtyUnit!="number"||isNaN(s.packaging.qtyUnit))&&t.push("Packaging quantity must be a valid number"),typeof s.packaging.unitCost!="number"||isNaN(s.packaging.unitCost)?t.push("Packaging unit cost must be a valid number"):s.packaging.unitCost<0&&t.push("Packaging unit cost cannot be negative")),{isValid:t.length===0,errors:t,warnings:r}}static validateSalesModel(s){const t=[],r=[];return typeof s.forecastDailyUnits!="number"||isNaN(s.forecastDailyUnits)?t.push("Daily units forecast must be a valid number"):(s.forecastDailyUnits<1&&t.push("Daily units forecast must be at least 1"),s.forecastDailyUnits>1e3&&r.push(`Daily units forecast (${s.forecastDailyUnits}) seems high. Please verify.`)),typeof s.paymentFeePercent!="number"||isNaN(s.paymentFeePercent)?t.push("Payment fee percentage must be a valid number"):(s.paymentFeePercent<0&&t.push("Payment fee percentage cannot be negative"),s.paymentFeePercent>10&&r.push(`Payment fee (${s.paymentFeePercent}%) seems high. Please verify.`)),typeof s.deliveryCommissionPercent!="number"||isNaN(s.deliveryCommissionPercent)?t.push("Delivery commission percentage must be a valid number"):(s.deliveryCommissionPercent<0&&t.push("Delivery commission percentage cannot be negative"),s.deliveryCommissionPercent>50&&r.push(`Delivery commission (${s.deliveryCommissionPercent}%) seems high. Please verify.`)),{isValid:t.length===0,errors:t,warnings:r}}static validateLaborItem(s){const t=[],r=[];return(!s.id||typeof s.id!="string")&&t.push("Labor ID is required"),(!s.role||typeof s.role!="string")&&t.push("Role is required"),(!s.type||!["direct","indirect"].includes(s.type))&&t.push('Type must be either "direct" or "indirect"'),typeof s.wagePerHour!="number"||isNaN(s.wagePerHour)?t.push("Wage per hour must be a valid number"):(s.wagePerHour<0&&t.push("Wage cannot be negative"),s.wagePerHour>1e3&&r.push(`Wage (${s.wagePerHour} THB/hour) seems high. Please verify.`)),typeof s.hoursPerDay!="number"||isNaN(s.hoursPerDay)?t.push("Hours per day must be a valid number"):(s.hoursPerDay<this.MIN_HOURS&&t.push(`Hours per day must be at least ${this.MIN_HOURS}`),s.hoursPerDay>this.MAX_HOURS&&t.push(`Hours per day cannot exceed ${this.MAX_HOURS}`)),typeof s.daysPerWeek!="number"||isNaN(s.daysPerWeek)?t.push("Days per week must be a valid number"):(s.daysPerWeek<this.MIN_DAYS&&t.push(`Days per week must be at least ${this.MIN_DAYS}`),s.daysPerWeek>this.MAX_DAYS&&t.push(`Days per week cannot exceed ${this.MAX_DAYS}`)),{isValid:t.length===0,errors:t,warnings:r}}static validateUtilityItem(s){const t=[],r=[];return(!s.id||typeof s.id!="string")&&t.push("Utility ID is required"),(!s.type||!["electric","lpg","water"].includes(s.type))&&t.push('Type must be "electric", "lpg", or "water"'),(!s.device||typeof s.device!="string")&&t.push("Device name is required"),s.type==="electric"?(typeof s.kw!="number"||isNaN(s.kw)?t.push("KW rating is required for electric devices"):s.kw<=0&&t.push("KW rating must be greater than 0"),typeof s.hoursPerDay!="number"||isNaN(s.hoursPerDay)?t.push("Hours per day is required for electric devices"):(s.hoursPerDay<0||s.hoursPerDay>24)&&t.push("Hours per day must be between 0 and 24"),typeof s.ratePerKwh!="number"||isNaN(s.ratePerKwh)?t.push("Rate per KWh is required for electric devices"):s.ratePerKwh<0&&t.push("Rate per KWh cannot be negative")):s.type==="lpg"?(typeof s.kgPerBatch!="number"||isNaN(s.kgPerBatch)?t.push("KG per batch is required for LPG devices"):s.kgPerBatch<=0&&t.push("KG per batch must be greater than 0"),typeof s.batchesPerDay!="number"||isNaN(s.batchesPerDay)?t.push("Batches per day is required for LPG devices"):s.batchesPerDay<0&&t.push("Batches per day cannot be negative"),typeof s.ratePerKg!="number"||isNaN(s.ratePerKg)?t.push("Rate per KG is required for LPG devices"):s.ratePerKg<0&&t.push("Rate per KG cannot be negative")):s.type==="water"&&(typeof s.m3PerDay!="number"||isNaN(s.m3PerDay)?t.push("M3 per day is required for water devices"):s.m3PerDay<0&&t.push("M3 per day cannot be negative"),typeof s.ratePerM3!="number"||isNaN(s.ratePerM3)?t.push("Rate per M3 is required for water devices"):s.ratePerM3<0&&t.push("Rate per M3 cannot be negative")),{isValid:t.length===0,errors:t,warnings:r}}static validateFixedCost(s){const t=[],r=[];return(!s.id||typeof s.id!="string")&&t.push("Fixed cost ID is required"),(!s.name||typeof s.name!="string")&&t.push("Fixed cost name is required"),typeof s.amountPerMonth!="number"||isNaN(s.amountPerMonth)?t.push("Amount per month must be a valid number"):(s.amountPerMonth<0&&t.push("Amount per month cannot be negative"),s.amountPerMonth>1e5&&r.push(`Amount per month (${s.amountPerMonth} THB) seems high. Please verify.`)),{isValid:t.length===0,errors:t,warnings:r}}static validateAllData(s){const t=[],r=[];if(!s||typeof s!="object")return t.push("No data available for validation"),{isValid:!1,errors:t,warnings:r};if(Array.isArray(s.menus)&&s.menus.forEach((i,n)=>{const l=this.validateMenuItem(i);l.errors.forEach(c=>t.push(`Menu ${n+1}: ${c}`)),l.warnings.forEach(c=>r.push(`Menu ${n+1}: ${c}`))}),s.salesModel){const i=this.validateSalesModel(s.salesModel);i.errors.forEach(n=>t.push(`Sales Model: ${n}`)),i.warnings.forEach(n=>r.push(`Sales Model: ${n}`))}return Array.isArray(s.labor)&&s.labor.forEach((i,n)=>{const l=this.validateLaborItem(i);l.errors.forEach(c=>t.push(`Labor ${n+1}: ${c}`)),l.warnings.forEach(c=>r.push(`Labor ${n+1}: ${c}`))}),Array.isArray(s.utilities)&&s.utilities.forEach((i,n)=>{const l=this.validateUtilityItem(i);l.errors.forEach(c=>t.push(`Utility ${n+1}: ${c}`)),l.warnings.forEach(c=>r.push(`Utility ${n+1}: ${c}`))}),Array.isArray(s.fixedCosts)&&s.fixedCosts.forEach((i,n)=>{const l=this.validateFixedCost(i);l.errors.forEach(c=>t.push(`Fixed Cost ${n+1}: ${c}`)),l.warnings.forEach(c=>r.push(`Fixed Cost ${n+1}: ${c}`))}),{isValid:t.length===0,errors:t,warnings:r}}}class Jr{state;financeEngine;subscribers=[];validationCache=new Map;updateQueue=[];isProcessingQueue=!1;queueTimeoutId=null;lastSavedDataString=null;lastComputationHash=null;syncTimeoutId=null;isSyncInProgress=!1;SYNC_DEBOUNCE_MS=500;constructor(){this.financeEngine=new Ws,this.state=this.getInitialState(),this.initializeState()}getInitialState(){return{data:null,scenarios:{},currentScenario:"base",computationResult:null,validationResults:[],isLoading:!1,error:null,lastUpdated:new Date().toISOString()}}initializeState(){try{this.financeEngine.init();const s=this.financeEngine.getData(),t=this.financeEngine.getScenarios();this.state.data=s,this.state.scenarios=t,this.updateState({type:"DATA_UPDATE",payload:{data:s,scenarios:t}}),s&&this.computeAndValidate()}catch(s){this.updateState({type:"ERROR_UPDATE",payload:{error:`Failed to initialize: ${this.formatError(s)}`}})}}formatError(s){return s&&s instanceof Error?s.message:String(s)}updateState(s,t){this.updateQueue.push({update:s,opts:t}),!this.isProcessingQueue&&(this.queueTimeoutId&&clearTimeout(this.queueTimeoutId),this.queueTimeoutId=setTimeout(()=>this.processUpdateQueue(),0))}processUpdateQueue(){if(!(this.isProcessingQueue||this.updateQueue.length===0)){this.isProcessingQueue=!0;try{for(;this.updateQueue.length>0;){const s=this.updateQueue.shift(),t=this.updateQueue.length>0||s.opts?.skipAuto;this.applyStateUpdate(s.update,{skipAuto:t})}}finally{this.isProcessingQueue=!1}}}applyStateUpdate(s,t){const r={...this.state};try{switch(this.validateStateUpdate(s),s.type){case"DATA_UPDATE":if(!this.validateDataPayload(s.payload))throw new Error("Invalid data update payload");this.state.data=s.payload.data,this.state.scenarios=s.payload.scenarios;break;case"SCENARIO_UPDATE":if(!this.state.scenarios[s.payload.scenarioId])throw new Error(`Invalid scenario ID: ${s.payload.scenarioId}`);this.state.currentScenario=s.payload.scenarioId;break;case"COMPUTATION_UPDATE":if(!this.validateComputationPayload(s.payload))throw new Error("Invalid computation result payload");this.state.computationResult=s.payload.result;break;case"VALIDATION_UPDATE":if(!Array.isArray(s.payload.results))throw new Error("Validation results must be an array");this.state.validationResults=s.payload.results;break;case"ERROR_UPDATE":this.state.error=s.payload.error,this.state.isLoading=!1;break;case"LOADING_UPDATE":if(this.state.isLoading===s.payload.isLoading){s.payload.isLoading&&(this.state.error=null);break}this.state.isLoading=s.payload.isLoading,s.payload.isLoading&&(this.state.error=null);break;default:throw new Error(`Unsupported update type: ${s.type}`)}this.state.lastUpdated=new Date().toISOString(),this.notifySubscribers(),s.type==="DATA_UPDATE"&&!t?.skipAuto&&(this.autoSave(),this.computeAndValidate()),console.debug(`State update successful: ${s.type}`)}catch(i){this.state=r,console.error("Error updating state:",i);const n=this.formatError(i);throw s.type!=="ERROR_UPDATE"&&this.updateState({type:"ERROR_UPDATE",payload:{error:`State update failed (${s.type}): ${n}`,originalError:i}}),i}}validateStateUpdate(s){if(!s||typeof s!="object")throw new Error("State update must be an object");if(!s.type)throw new Error("State update must have a type");if(!s.payload)throw new Error("State update must have a payload")}validateDataPayload(s){return s&&typeof s=="object"&&"data"in s&&"scenarios"in s&&typeof s.scenarios=="object"}validateComputationPayload(s){return s&&typeof s=="object"&&"result"in s}syncAfterDataChange(s){if(this.isSyncInProgress){console.debug("[StateManager] Skipping sync, already in progress");try{this.updateState({type:"LOADING_UPDATE",payload:{isLoading:!1}})}catch{}return}this.syncTimeoutId&&clearTimeout(this.syncTimeoutId),this.syncTimeoutId=setTimeout(()=>{this.isSyncInProgress=!0,console.debug(`[StateManager] Starting sync: ${s||"unknown reason"}`);try{const t=typeof this.financeEngine.getData=="function"?this.financeEngine.getData():this.state.data;if(!t){try{this.updateState({type:"LOADING_UPDATE",payload:{isLoading:!1}})}catch{}this.isSyncInProgress=!1;return}const r=JSON.stringify(t);if(this.lastSavedDataString&&this.lastSavedDataString===r){try{this.updateState({type:"LOADING_UPDATE",payload:{isLoading:!1}})}catch{}this.isSyncInProgress=!1;return}try{typeof this.financeEngine.save=="function"&&this.financeEngine.save(),this.lastSavedDataString=r}catch(n){console.error("syncAfterDataChange: save failed",n)}try{typeof this.financeEngine.load=="function"&&this.financeEngine.load(t)}catch(n){console.error("syncAfterDataChange: load failed",n)}let i=null;try{typeof this.financeEngine.compute=="function"&&(i=this.financeEngine.compute())}catch(n){console.error("syncAfterDataChange: compute failed",n)}try{this.updateState({type:"DATA_UPDATE",payload:{data:t,scenarios:this.state.scenarios}},{skipAuto:!0})}catch{}if(i)try{const n=JSON.stringify(i);this.lastComputationHash!==n&&(this.lastComputationHash=n,this.updateState({type:"COMPUTATION_UPDATE",payload:{result:i}},{skipAuto:!0}));const l=i?.kpis,c=Array.isArray(t?.menus)?t.menus.length:0,h=t?.menus?.[0],x=h?.bom?.reduce((j,S)=>{if(S.packaging)return j+S.packaging.qtyUnit*S.packaging.unitCost;const R=S.yieldPercent/100,T=1+S.wastePercent/100,w=S.qtyG/1e3*T/R;return j+w*S.unitCostPerKg},0),f=h&&x?(x/h.price*100).toFixed(1):"n/a";console.log(`[StateManager] syncAfterDataChange${s?" ("+s+")":""} => menus=${c}, computedAt=${i?.computedAt||"n/a"}, revenue=${l?.revenue??"n/a"}, dashboardFoodCost%=${l?.foodCostPct?.toFixed(1)??"n/a"}, firstMenuFoodCost%=${f}`)}catch{}try{this.validateAllData()}catch(n){console.error("syncAfterDataChange: validation failed",n)}try{this.updateState({type:"LOADING_UPDATE",payload:{isLoading:!1}})}catch{}}finally{this.isSyncInProgress=!1}},this.SYNC_DEBOUNCE_MS)}subscribe(s){return this.subscribers.push(s),()=>{const t=this.subscribers.indexOf(s);t>-1&&this.subscribers.splice(t,1)}}notifySubscribers(){this.subscribers.forEach(s=>{try{s(this.state)}catch(t){console.error("Error in subscriber callback:",t)}})}updateMenu(s,t){try{this.updateState({type:"LOADING_UPDATE",payload:{isLoading:!0}});const r=ve.validateMenuItem(t);if(!r.isValid){this.updateState({type:"ERROR_UPDATE",payload:{error:`Menu validation failed: ${r.errors.join(", ")}`}});return}if(this.financeEngine.updateMenu(s,t),this.financeEngine.save(),!this.financeEngine.getData()?.menus?.some(l=>l.id===s))try{const l={id:s,name:t.name||`เมนูใหม่ ${s}`,price:typeof t.price=="number"?t.price:0,channelMix:t.channelMix||{dineIn:.7,takeaway:.2,delivery:.1},bom:t.bom||[]};typeof this.financeEngine.addMenu=="function"&&this.financeEngine.addMenu(l)}catch{}const n=this.financeEngine.getData();this.updateState({type:"DATA_UPDATE",payload:{data:n,scenarios:this.state.scenarios}},{skipAuto:!0}),this.syncAfterDataChange("updateMenu")}catch(r){this.updateState({type:"ERROR_UPDATE",payload:{error:`Failed to update menu: ${this.formatError(r)}`}})}finally{try{this.updateState({type:"LOADING_UPDATE",payload:{isLoading:!1}})}catch{}}}addMenu(s){try{this.updateState({type:"LOADING_UPDATE",payload:{isLoading:!0}});const t=ve.validateMenuItem(s);if(!t.isValid){this.updateState({type:"ERROR_UPDATE",payload:{error:`Menu validation failed: ${t.errors.join(", ")}`}});return}if(typeof this.financeEngine.addMenu=="function")this.financeEngine.addMenu(s);else{const i=this.financeEngine.getData?this.financeEngine.getData():null;i&&Array.isArray(i.menus)&&(i.menus.push(s),typeof this.financeEngine.load=="function"&&this.financeEngine.load(i))}const r=this.financeEngine.getData();this.updateState({type:"DATA_UPDATE",payload:{data:r,scenarios:this.state.scenarios}},{skipAuto:!0}),this.syncAfterDataChange("addMenu")}catch(t){this.updateState({type:"ERROR_UPDATE",payload:{error:`Failed to add menu: ${this.formatError(t)}`}})}finally{try{this.updateState({type:"LOADING_UPDATE",payload:{isLoading:!1}})}catch{}}}updateSalesModel(s){try{this.updateState({type:"LOADING_UPDATE",payload:{isLoading:!0}});const t=ve.validateSalesModel(s);if(!t.isValid){this.updateState({type:"ERROR_UPDATE",payload:{error:`Sales model validation failed: ${t.errors.join(", ")}`}});return}this.financeEngine.updateSalesModel(s);const r=this.financeEngine.getData();this.updateState({type:"DATA_UPDATE",payload:{data:r,scenarios:this.state.scenarios}},{skipAuto:!0}),this.syncAfterDataChange("updateSalesModel")}catch(t){this.updateState({type:"ERROR_UPDATE",payload:{error:`Failed to update sales model: ${this.formatError(t)}`}})}finally{try{this.updateState({type:"LOADING_UPDATE",payload:{isLoading:!1}})}catch{}}}updateUtilities(s){try{this.updateState({type:"LOADING_UPDATE",payload:{isLoading:!0}});const t=s.map(n=>ve.validateUtilityItem(n));if(t.some(n=>!n.isValid)){const n=t.filter(l=>!l.isValid).flatMap(l=>l.errors);this.updateState({type:"ERROR_UPDATE",payload:{error:`Utility validation failed: ${n.join(", ")}`}});return}this.financeEngine.updateUtilities(s);const i=this.financeEngine.getData();this.updateState({type:"DATA_UPDATE",payload:{data:i,scenarios:this.state.scenarios}},{skipAuto:!0}),this.syncAfterDataChange("updateUtilities")}catch(t){this.updateState({type:"ERROR_UPDATE",payload:{error:`Failed to update utilities: ${this.formatError(t)}`}})}finally{try{this.updateState({type:"LOADING_UPDATE",payload:{isLoading:!1}})}catch{}}}updateLabor(s){try{this.updateState({type:"LOADING_UPDATE",payload:{isLoading:!0}});const t=s.map(n=>ve.validateLaborItem(n));if(t.some(n=>!n.isValid)){const n=t.filter(l=>!l.isValid).flatMap(l=>l.errors);this.updateState({type:"ERROR_UPDATE",payload:{error:`Labor validation failed: ${n.join(", ")}`}});return}this.financeEngine.updateLabor(s);const i=this.financeEngine.getData();this.updateState({type:"DATA_UPDATE",payload:{data:i,scenarios:this.state.scenarios}},{skipAuto:!0}),this.syncAfterDataChange("updateLabor")}catch(t){this.updateState({type:"ERROR_UPDATE",payload:{error:`Failed to update labor: ${this.formatError(t)}`}})}finally{try{this.updateState({type:"LOADING_UPDATE",payload:{isLoading:!1}})}catch{}}}updateFixedCosts(s){try{this.updateState({type:"LOADING_UPDATE",payload:{isLoading:!0}});const t=s.map(n=>ve.validateFixedCost(n));if(t.some(n=>!n.isValid)){const n=t.filter(l=>!l.isValid).flatMap(l=>l.errors);this.updateState({type:"ERROR_UPDATE",payload:{error:`Fixed cost validation failed: ${n.join(", ")}`}});return}this.financeEngine.updateFixedCosts(s);const i=this.financeEngine.getData();this.updateState({type:"DATA_UPDATE",payload:{data:i,scenarios:this.state.scenarios}},{skipAuto:!0}),this.syncAfterDataChange("updateFixedCosts")}catch(t){this.updateState({type:"ERROR_UPDATE",payload:{error:`Failed to update fixed costs: ${this.formatError(t)}`}})}finally{try{this.updateState({type:"LOADING_UPDATE",payload:{isLoading:!1}})}catch{}}}deleteMenu(s){try{if(this.updateState({type:"LOADING_UPDATE",payload:{isLoading:!0}}),typeof this.financeEngine.deleteMenu=="function")this.financeEngine.deleteMenu(s);else{const r=this.financeEngine.getData?this.financeEngine.getData():null;r&&Array.isArray(r.menus)&&(r.menus=r.menus.filter(i=>i.id!==s),typeof this.financeEngine.load=="function"?this.financeEngine.load(r):typeof this.financeEngine.setData=="function"&&this.financeEngine.setData(r))}const t=this.financeEngine.getData();this.updateState({type:"DATA_UPDATE",payload:{data:t,scenarios:this.state.scenarios}},{skipAuto:!0}),this.syncAfterDataChange("deleteMenu")}catch(t){this.updateState({type:"ERROR_UPDATE",payload:{error:`Failed to delete menu: ${this.formatError(t)}`}})}finally{try{this.updateState({type:"LOADING_UPDATE",payload:{isLoading:!1}})}catch{}}}computeAndValidate(){try{if(!this.state.data){this.updateState({type:"LOADING_UPDATE",payload:{isLoading:!1}});return}const s=this.financeEngine.compute();this.updateState({type:"COMPUTATION_UPDATE",payload:{result:s}}),this.validateAllData(),this.updateState({type:"LOADING_UPDATE",payload:{isLoading:!1}})}catch(s){this.updateState({type:"ERROR_UPDATE",payload:{error:`Computation failed: ${this.formatError(s)}`}})}}validateAllData(){try{const s=JSON.stringify(this.state.data),t=this.validationCache.get(s);if(t){this.updateState({type:"VALIDATION_UPDATE",payload:{results:[t]}});return}const r=ve.validateAllData(this.state.data);this.validationCache.set(s,r),this.updateState({type:"VALIDATION_UPDATE",payload:{results:[r]}})}catch(s){console.error("Validation failed:",s)}}importData(s){try{this.updateState({type:"LOADING_UPDATE",payload:{isLoading:!0}});const t=this.financeEngine.importJSON(s);if(t.success){const r=this.financeEngine.getData(),i=this.financeEngine.getScenarios();this.updateState({type:"DATA_UPDATE",payload:{data:r,scenarios:i}}),this.computeAndValidate(),this.validationCache.clear()}else this.updateState({type:"ERROR_UPDATE",payload:{error:t.error||"Import failed"}});return t}catch(t){return this.updateState({type:"ERROR_UPDATE",payload:{error:`Import failed: ${this.formatError(t)}`}}),{success:!1,error:this.formatError(t)}}}exportData(){try{return this.financeEngine.exportJSON()}catch(s){throw console.error("Export failed:",s),s}}async exportFreshData(){try{console.log("[StateManager] Starting fresh data export..."),this.forceSave(),await this.waitForIdle(),await this.forceRecompute();const s=this.validateDataForExport();if(!s.isValid){const n=s.issues.join(", ");console.warn("[StateManager] Data validation issues:",n)}const t=this.financeEngine.exportJSON(),i={...JSON.parse(t),computationResult:this.state.computationResult,exportTimestamp:new Date().toISOString(),dataVersion:this.state.lastUpdated,isFreshExport:!0,validation:s,exportQuality:s.isValid?"excellent":"warning"};return console.log("[StateManager] Fresh data export completed successfully"),console.log("[StateManager] Export summary:",{hasComputationResult:!!this.state.computationResult,hasKpis:!!this.state.computationResult?.kpis,hasPnL:!!this.state.computationResult?.pnl,hasMenus:!!this.state.computationResult?.menus,menuCount:this.state.computationResult?.menus?.length||0,validationScore:s.isValid?"pass":"warning",dataAge:new Date().toISOString()}),JSON.stringify(i,null,2)}catch(s){throw console.error("Fresh export failed:",s),console.error("State at failure:",{hasData:!!this.state.data,hasComputationResult:!!this.state.computationResult,isLoading:this.state.isLoading,error:this.state.error,lastUpdated:this.state.lastUpdated}),new Error(`Failed to export fresh data: ${this.formatError(s)}`)}}async waitForIdle(s=2e3){const t=Date.now();for(;this.isSyncInProgress||this.isProcessingQueue;){if(Date.now()-t>s){console.warn("[StateManager] Timeout waiting for idle state");break}await new Promise(r=>setTimeout(r,50))}}async forceRecompute(){try{const s=this.financeEngine.getData();if(s){this.updateState({type:"DATA_UPDATE",payload:{data:s,scenarios:this.state.scenarios}},{skipAuto:!0});const t=this.financeEngine.compute();t&&this.updateState({type:"COMPUTATION_UPDATE",payload:{result:t}},{skipAuto:!0}),this.validateAllData()}await new Promise(t=>setTimeout(t,100))}catch(s){throw console.error("Force recompute failed:",s),s}}validateDataForExport(){const s=[],t=this.state.data,r=this.state.computationResult;if(!t)return s.push("ไม่พบข้อมูลพื้นฐานในระบบ"),{isValid:!1,issues:s};r?(r.kpis||s.push("ไม่พบตัวชี้วัดสำคัญ (KPIs)"),r.pnl||s.push("ไม่พบงบกำไรขาดทุน (P&L)"),(!r.menus||r.menus.length===0)&&s.push("ไม่พบข้อมูลเมนูหรือการวิเคราะห์เมนู")):s.push("ไม่พบผลการคำนวณ อาจต้องรอให้ระบบประมวลผลเสร็จ");const i=new Date(this.state.lastUpdated),l=(new Date().getTime()-i.getTime())/(1e3*60);return l>5&&s.push(`ข้อมูลอาจไม่เป็นปัจจุบัน (อัปเดตล่าสุด ${Math.round(l)} นาทีที่แล้ว)`),this.state.validationResults.some(c=>!c.isValid)&&s.push("พบข้อผิดพลาดในการตรวจสอบข้อมูล"),{isValid:s.length===0,issues:s}}autoSave(){try{const s=this.financeEngine.getData(),t=JSON.stringify(s);if(this.lastSavedDataString===t){console.debug("[StateManager] Skipping auto-save, data unchanged");return}this.financeEngine.save(),this.lastSavedDataString=t,console.debug("[StateManager] Data auto-saved successfully")}catch(s){console.error("Auto-save failed:",s),this.updateState({type:"ERROR_UPDATE",payload:{error:`Auto-save failed: ${this.formatError(s)}`}})}}forceSave(){try{const s=this.financeEngine.getData(),t=JSON.stringify(s);if(this.lastSavedDataString&&this.lastSavedDataString===t){console.debug("[StateManager] forceSave skipped, data unchanged");return}typeof this.financeEngine.save=="function"&&this.financeEngine.save(),this.lastSavedDataString=t,console.log("Data force-saved successfully")}catch(s){console.error("Force save failed:",s),this.updateState({type:"ERROR_UPDATE",payload:{error:`Force save failed: ${this.formatError(s)}`}})}}getState(){return{...this.state}}getData(){return this.state.data}getComputationResult(){return this.state.computationResult}getValidationResults(){return this.state.validationResults}getError(){return this.state.error}isLoading(){return this.state.isLoading}setCurrentScenario(s){this.state.scenarios[s]?this.updateState({type:"SCENARIO_UPDATE",payload:{scenarioId:s}}):this.updateState({type:"ERROR_UPDATE",payload:{error:`Scenario ${s} not found`}})}getCurrentScenario(){return this.state.currentScenario}getScenarios(){return this.state.scenarios}clearError(){this.updateState({type:"ERROR_UPDATE",payload:{error:null}})}reset(){try{this.updateState({type:"LOADING_UPDATE",payload:{isLoading:!0}}),localStorage.removeItem("finance_data"),localStorage.removeItem("finance_scenarios"),this.financeEngine=new Ws,this.financeEngine.init();const s=this.financeEngine.getData(),t=this.financeEngine.getScenarios();this.updateState({type:"DATA_UPDATE",payload:{data:s,scenarios:t}}),this.computeAndValidate(),this.validationCache.clear()}catch(s){this.updateState({type:"ERROR_UPDATE",payload:{error:`Reset failed: ${this.formatError(s)}`}})}}cleanup(){try{console.log("[StateManager] Cleaning up resources..."),this.syncTimeoutId&&(clearTimeout(this.syncTimeoutId),this.syncTimeoutId=null),this.queueTimeoutId&&(clearTimeout(this.queueTimeoutId),this.queueTimeoutId=null),this.isProcessingQueue=!1,this.isSyncInProgress=!1,this.updateQueue=[],this.validationCache.clear(),this.subscribers.forEach(s=>{try{s({...this.state,isLoading:!1,error:null})}catch(t){console.warn("[StateManager] Subscriber notification failed during cleanup:",t)}}),this.subscribers=[],console.log("[StateManager] Cleanup completed successfully")}catch(s){console.error("[StateManager] Cleanup failed:",s)}}isHealthy(){try{return!this.isSyncInProgress&&!this.isProcessingQueue&&this.updateQueue.length===0&&this.state.error===null}catch(s){return console.error("[StateManager] Health check failed:",s),!1}}}let is=null;const ls=()=>(is||(is=new Jr),is),le=()=>{const[a,s]=m.useState(()=>ls().getState()),t=m.useRef(null);m.useEffect(()=>{const n=ls();return t.current=n.subscribe(l=>{try{s(l)}catch(c){console.error("[useFinanceState] State update failed:",c)}}),()=>{try{t.current&&(t.current(),t.current=null)}catch(l){console.error("[useFinanceState] Cleanup failed:",l)}}},[]);const r=m.useRef(ls()),i={updateMenu:m.useCallback((n,l)=>{r.current.updateMenu(n,l)},[]),addMenu:m.useCallback(n=>{r.current.addMenu(n)},[]),deleteMenu:m.useCallback(n=>{r.current.deleteMenu(n)},[]),updateSalesModel:m.useCallback(n=>{r.current.updateSalesModel(n)},[]),updateUtilities:m.useCallback(n=>{r.current.updateUtilities(n)},[]),updateLabor:m.useCallback(n=>{r.current.updateLabor(n)},[]),updateFixedCosts:m.useCallback(n=>{r.current.updateFixedCosts(n)},[]),importData:m.useCallback(n=>r.current.importData(n),[]),exportData:m.useCallback(()=>r.current.exportData(),[]),exportFreshData:m.useCallback(async()=>await r.current.exportFreshData(),[]),setCurrentScenario:m.useCallback(n=>{r.current.setCurrentScenario(n)},[]),clearError:m.useCallback(()=>{r.current.clearError()},[]),reset:m.useCallback(()=>{r.current.reset()},[]),forceSave:m.useCallback(()=>{r.current.forceSave()},[])};return{...a,...i}},Qr=()=>{const{validationResults:a,isLoading:s,error:t}=le(),r=a.some(c=>!c.isValid),i=a.some(c=>c.warnings.length>0),n=a.flatMap(c=>c.errors),l=a.flatMap(c=>c.warnings);return{validationResults:a,hasErrors:r,hasWarnings:i,allErrors:n,allWarnings:l,isLoading:s,error:t}};function Yr(){const{data:a,updateSalesModel:s}=le(),t=a?.salesModel||{},r=["ม.ค.","ก.พ.","มี.ค.","เม.ย.","พ.ค.","มิ.ย.","ก.ค.","ส.ค.","ก.ย.","ต.ค.","พ.ย.","ธ.ค."],i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],[n,l]=m.useState(t.forecastDailyUnits||100),[c,h]=m.useState(t.paymentFeePercent||3),[x,f]=m.useState(t.deliveryCommissionPercent||15),[j,S]=m.useState(()=>{const d={};return i.forEach(v=>{d[v]=(t.seasonality?.[v]||1)*100}),d}),R=m.useRef(!1),T=m.useRef(null);m.useEffect(()=>{if(!R.current){R.current=!0;return}if(a?.salesModel){const d=a.salesModel.forecastDailyUnits||100,v=a.salesModel.paymentFeePercent||3,u=a.salesModel.deliveryCommissionPercent||15;if(d!==n&&l(d),v!==c&&h(v),u!==x&&f(u),a.salesModel.seasonality){const p={};let P=!1;i.forEach(k=>{const O=(a.salesModel.seasonality?.[k]||1)*100,Q=j[k];p[k]=O,Math.abs(O-Q)>.1&&(P=!0)}),P&&S(p)}}},[a?.salesModel?.forecastDailyUnits,a?.salesModel?.paymentFeePercent,a?.salesModel?.deliveryCommissionPercent,a?.salesModel?.seasonality]),m.useEffect(()=>()=>{T.current&&clearTimeout(T.current)},[]);const w=(d,v)=>{S(O=>({...O,[d]:v}));const u=v/100,p=(t.seasonality||{})[d]||1;if(Math.abs(p-u)<.001)return;const P={...t.seasonality||{},[d]:u},k={...t,seasonality:P};console.log(`[SalesModel] Updating seasonality for ${d}: ${v.toFixed(1)}%`),s(k)},M=(d,v)=>{if(v===""){S(P=>({...P,[d]:100}));return}const u=parseFloat(v);if(isNaN(u))return;const p=Math.max(25,Math.min(200,u));S(P=>({...P,[d]:p})),T.current&&clearTimeout(T.current),T.current=setTimeout(()=>{w(d,p)},300)},D=d=>{if(l(d),(t.forecastDailyUnits||0)===d)return;const v={...t,forecastDailyUnits:d};s(v)},_=d=>{if(h(d),(t.paymentFeePercent||0)===d)return;const v={...t,paymentFeePercent:d};s(v)},y=d=>{if(f(d),(t.deliveryCommissionPercent||0)===d)return;const v={...t,deliveryCommissionPercent:d};s(v)},b=d=>{const v=(j[d]||100)/100;return Math.round(n*30*v)},o=d=>b(d)*60;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"โมเดลยอดขาย"}),e.jsx("p",{className:"text-muted-foreground",children:"จัดการการคาดการณ์ยอดขายและค่าธรรมเนียม"})]}),e.jsxs(se,{variant:"outline",children:["รายได้เดือนละ ",g(o("Jan"))]})]}),e.jsxs(we,{defaultValue:"forecast",className:"space-y-4",children:[e.jsxs(Pe,{children:[e.jsx(q,{value:"forecast",children:"คาดการณ์ยอดขาย"}),e.jsx(q,{value:"seasonality",children:"ปรับปรุงตามฤดูกาล"}),e.jsx(q,{value:"channels",children:"ช่องทางและค่าธรรมเนียม"}),e.jsx(q,{value:"schedule",children:"เวลาดำเนินการ"})]}),e.jsx(J,{value:"forecast",className:"space-y-4",children:e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5"}),"การคาดการณ์ยอดขายรายวัน"]}),e.jsx(G,{children:"ตั้งค่าจำนวนจานที่คาดว่าจะขายได้ต่อวัน"})]}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"daily-forecast",children:"จำนวนจานต่อวัน"}),e.jsx(H,{id:"daily-forecast",type:"number",value:n,onChange:d=>D(Ce(d.target.value)),placeholder:"120"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"ยอดขายเฉลี่ยต่อวันที่คาดการณ์"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"ปรับด้วย Slider"}),e.jsx(ye,{value:[n],onValueChange:d=>D(d[0]),max:1e3,min:10,step:1,className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:"10 จาน"}),e.jsx("span",{children:"1,000 จาน"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[e.jsxs(E,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"รายวัน"}),e.jsxs("div",{className:"text-xl font-bold",children:[n," จาน"]})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"รายสัปดาห์"}),e.jsxs("div",{className:"text-xl font-bold",children:[n*7," จาน"]})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"รายเดือน"}),e.jsxs("div",{className:"text-xl font-bold",children:[n*30," จาน"]})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"รายปี"}),e.jsxs("div",{className:"text-xl font-bold",children:[n*365," จาน"]})]})]})]})]})}),e.jsxs(J,{value:"seasonality",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(E,{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200 hover-lift card-animate",children:e.jsx(L,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500 rounded-lg",children:e.jsx(rs,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-700",children:"ยอดขายเฉลี่ย"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:g(i.reduce((d,v)=>d+o(v),0)/12)})]})]})})}),e.jsx(E,{className:"bg-gradient-to-br from-green-50 to-green-100 border-green-200 hover-lift card-animate",children:e.jsx(L,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-500 rounded-lg",children:e.jsx(xe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-700",children:"เดือนที่ดีที่สุด"}),e.jsx("p",{className:"text-lg font-bold text-green-900",children:r[i.findIndex(d=>o(d)===Math.max(...i.map(v=>o(v))))]})]})]})})}),e.jsx(E,{className:"bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200 hover-lift card-animate",children:e.jsx(L,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-500 rounded-lg",children:e.jsx(rs,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-orange-700",children:"เดือนที่ต่ำสุด"}),e.jsx("p",{className:"text-lg font-bold text-orange-900",children:r[i.findIndex(d=>o(d)===Math.min(...i.map(v=>o(v))))]})]})]})})})]}),e.jsxs(E,{className:"overflow-hidden",children:[e.jsxs(I,{className:"bg-gradient-to-r from-purple-50 to-pink-50 border-b",children:[e.jsxs(V,{className:"flex items-center gap-2 text-purple-900",children:[e.jsx(rs,{className:"w-6 h-6"}),"ปรับปรุงตามฤดูกาล"]}),e.jsx(G,{className:"text-purple-700",children:"ลากแถบเลื่อนเพื่อปรับยอดขายในแต่ละเดือน (100% = ยอดปกติ)"})]}),e.jsx(L,{className:"p-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:i.map((d,v)=>{const u=j[d]||100,p=u>110,P=u<90;return e.jsxs("div",{className:`group relative p-4 rounded-xl border-2 transition-all duration-300 hover:shadow-lg hover:scale-[1.02] cursor-pointer ${p?"bg-gradient-to-br from-green-50 to-green-100 border-green-300 hover:border-green-400":P?"bg-gradient-to-br from-red-50 to-red-100 border-red-300 hover:border-red-400":"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-300 hover:border-blue-400"}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${p?"bg-green-500":P?"bg-red-500":"bg-blue-500"}`}),e.jsx(F,{className:"text-sm font-semibold",children:r[v]})]}),e.jsxs(se,{variant:p?"default":P?"destructive":"secondary",className:"text-xs font-bold",children:[u.toFixed(1),"%"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(ye,{value:[u],onValueChange:k=>w(d,k[0]),max:200,min:25,step:.1,className:"w-full transition-opacity duration-200 group-hover:opacity-100 slider-smooth"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{type:"number",min:25,max:200,step:.1,value:u.toFixed(1),onChange:k=>M(d,k.target.value),className:`h-8 text-xs text-center transition-all duration-200 ${u<25||u>200?"border-red-300 bg-red-50 focus:border-red-500":"border-input hover:border-accent-foreground/50 focus:border-accent-foreground"}`,placeholder:"100",title:`Valid range: 25% - 200% (Current: ${u.toFixed(1)}%)`}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"%"})]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:"จาน/เดือน"}),e.jsx("span",{className:"font-medium",children:b(d).toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:"รายได้"}),e.jsx("span",{className:"font-bold text-green-600",children:g(o(d))})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:`w-full h-2 rounded-full ${p?"bg-gradient-to-r from-green-400 to-green-600":P?"bg-gradient-to-r from-red-400 to-red-600":"bg-gradient-to-r from-blue-400 to-blue-600"}`})})]})]},d)})})})]}),e.jsxs(E,{className:"bg-gradient-to-r from-indigo-50 to-purple-50 border-indigo-200",children:[e.jsxs(I,{children:[e.jsx(V,{className:"text-indigo-900",children:"สรุปยอดขายรายเดือน"}),e.jsx(G,{className:"text-indigo-700",children:"ภาพรวมการเปลี่ยนแปลงยอดขายตลอดทั้งปี"})]}),e.jsx(L,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-2",children:i.map((d,v)=>{const u=j[d]||100,p=Math.max(20,u/200*100);return e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"text-xs font-medium text-indigo-700",children:r[v]}),e.jsx("div",{className:`w-6 rounded-t transition-all duration-500 ${u>100?"bg-gradient-to-t from-green-400 to-green-600":u<90?"bg-gradient-to-t from-red-400 to-red-600":"bg-gradient-to-t from-indigo-400 to-indigo-600"}`,style:{height:`${p}%`}}),e.jsxs("div",{className:"text-xs text-indigo-600 font-medium",children:[u.toFixed(1),"%"]})]},d)})})})]})]}),e.jsx(J,{value:"channels",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(Oa,{className:"w-5 h-5"}),"ค่าธรรมเนียมการชำระเงิน"]}),e.jsx(G,{children:"ค่าธรรมเนียมบัตรเครดิต/QR Payment"})]}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"payment-fee",children:"ค่าธรรมเนียม (%)"}),e.jsx(H,{id:"payment-fee",type:"number",step:"0.1",value:c,onChange:d=>_(parseFloat(d.target.value)||0),placeholder:"1.5"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"ค่าธรรมเนียมเฉลี่ยของการชำระเงินแบบไม่ใช้เงินสด"})]}),e.jsxs("div",{className:"p-3 bg-muted rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium",children:"ผลกระทบต่อรายได้"}),e.jsxs("div",{className:"text-lg font-bold text-red-600",children:["-",g(o("Jan")*c/100)," /เดือน"]})]})]})]}),e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(Fa,{className:"w-5 h-5"}),"ค่าคอมมิชชันเดลิเวอรี"]}),e.jsx(G,{children:"ค่าคอมมิชชันแพลตฟอร์มเดลิเวอรี"})]}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"delivery-commission",children:"ค่าคอมมิชชัน (%)"}),e.jsx(H,{id:"delivery-commission",type:"number",step:"0.1",value:x,onChange:d=>y(parseFloat(d.target.value)||0),placeholder:"25"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"ค่าคอมมิชชันของแพลตฟอร์มเดลิเวอรี (Grab, Foodpanda)"})]}),e.jsxs("div",{className:"p-3 bg-muted rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium",children:"ผลกระทบยอดเดลิเวอรี"}),e.jsxs("div",{className:"text-lg font-bold text-red-600",children:["-",g(o("Jan")*.1*x/100)," /เดือน"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"สมมติเดลิเวอรี 10% ของยอดขาย"})]})]})]})]})}),e.jsx(J,{value:"schedule",className:"space-y-4",children:e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"w-5 h-5"}),"เวลาดำเนินการ"]}),e.jsx(G,{children:"ตั้งค่าวันและเวลาเปิด-ปิดร้าน"})]}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(F,{children:"วันเปิดทำการ"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["จันทร์","อังคาร","พุธ","พฤหัสบดี","ศุกร์","เสาร์","อาทิตย์"].map((d,v)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:`day-${v}`,defaultChecked:v<6,className:"rounded border-gray-300"}),e.jsx(F,{htmlFor:`day-${v}`,className:"text-sm",children:d})]},d))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"open-time",children:"เวลาเปิด"}),e.jsx(H,{id:"open-time",type:"time",defaultValue:"07:00"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"close-time",children:"เวลาปิด"}),e.jsx(H,{id:"close-time",type:"time",defaultValue:"15:00"})]})]})]}),e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-blue-900",children:"ข้อมูลสรุป"}),e.jsx("div",{className:"text-sm text-blue-700",children:"เปิดทำการ 6 วัน/สัปดาห์ × 8 ชั่วโมง/วัน = 48 ชั่วโมง/สัปดาห์"})]})]})]})})]})]})}function de({className:a,...s}){return e.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:e.jsx("table",{"data-slot":"table",className:z("w-full caption-bottom text-sm",a),...s})})}function he({className:a,...s}){return e.jsx("thead",{"data-slot":"table-header",className:z("[&_tr]:border-b",a),...s})}function ue({className:a,...s}){return e.jsx("tbody",{"data-slot":"table-body",className:z("[&_tr:last-child]:border-0",a),...s})}function X({className:a,...s}){return e.jsx("tr",{"data-slot":"table-row",className:z("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",a),...s})}function $({className:a,...s}){return e.jsx("th",{"data-slot":"table-head",className:z("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...s})}function C({className:a,...s}){return e.jsx("td",{"data-slot":"table-cell",className:z("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...s})}const Me=a=>e.jsx(pt,{"data-slot":"dialog",...a}),Ae=m.forwardRef(({...a},s)=>e.jsx(ct,{ref:s,"data-slot":"dialog-trigger",...a}));function Xr(a){return e.jsx(mt,{"data-slot":"dialog-portal",...a})}m.forwardRef(({...a},s)=>e.jsx(es,{ref:s,"data-slot":"dialog-close",...a}));const Zr=m.forwardRef(({className:a,...s},t)=>e.jsx(dt,{ref:t,"data-slot":"dialog-overlay",className:z("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",a),...s})),ke=m.forwardRef(({className:a,children:s,...t},r)=>e.jsxs(Xr,{"data-slot":"dialog-portal",children:[e.jsx(Zr,{}),e.jsxs(ht,{ref:r,"data-slot":"dialog-content",className:z("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",a),...t,children:[s,e.jsxs(es,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(Ie,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})),Re=m.forwardRef(({className:a,...s},t)=>e.jsx("div",{ref:t,"data-slot":"dialog-header",className:z("flex flex-col gap-2 text-center sm:text-left",a),...s})),Te=m.forwardRef(({className:a,...s},t)=>e.jsx("div",{ref:t,"data-slot":"dialog-footer",className:z("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",a),...s})),Oe=m.forwardRef(({className:a,...s},t)=>e.jsx(ut,{ref:t,"data-slot":"dialog-title",className:z("text-lg leading-none font-semibold",a),...s})),He=m.forwardRef(({className:a,...s},t)=>e.jsx(xt,{ref:t,"data-slot":"dialog-description",className:z("text-muted-foreground text-sm",a),...s}));function en(){const{data:a,updateMenu:s,addMenu:t,deleteMenu:r}=le(),i=a?.menus||[],[n,l]=m.useState(i[0]||null);m.useEffect(()=>{if(i.length>0){const N=i[0];(!n||n.id!==N.id)&&l(N)}else n&&l(null)},[i.length,n?.id]);const[c,h]=m.useState(!1),[x,f]=m.useState(!1),[j,S]=m.useState(null),[R,T]=m.useState(!1),[w,M]=m.useState({name:"",price:0,channelMix:{dineIn:70,takeaway:20,delivery:10},bom:[]}),[D,_]=m.useState({item:"",qtyG:0,unitCostPerKg:0,yieldPercent:100,wastePercent:0}),y=N=>{if(N.packaging)return N.packaging.qtyUnit*N.packaging.unitCost;const A=N.yieldPercent/100,B=1+N.wastePercent/100;return N.qtyG/1e3*B/A*N.unitCostPerKg},b=N=>N.reduce((A,B)=>A+y(B),0),o=N=>{const A=b(N.bom);return N.price-A},d=N=>o(N)/N.price*100,v=()=>{const A={id:`menu_${Date.now()}`,name:w.name,price:w.price,channelMix:{dineIn:w.channelMix.dineIn/100,takeaway:w.channelMix.takeaway/100,delivery:w.channelMix.delivery/100},bom:w.bom};t(A),M({name:"",price:0,channelMix:{dineIn:70,takeaway:20,delivery:10},bom:[]}),h(!1),l(A)},u=()=>{if(!n)return;const N=j!==null?n.bom.map((B,Z)=>Z===j?D:B):[...n.bom,D],A={...n,bom:N};try{const B=JSON.stringify(n),Z=JSON.stringify(A);B!==Z&&(s(n.id,A),l(A))}catch{s(n.id,A),l(A)}_({item:"",qtyG:0,unitCostPerKg:0,yieldPercent:100,wastePercent:0}),S(null),T(!1),f(!1)},p=()=>{const N=j!==null?w.bom.map((A,B)=>B===j?D:A):[...w.bom,D];M(A=>({...A,bom:N})),_({item:"",qtyG:0,unitCostPerKg:0,yieldPercent:100,wastePercent:0}),S(null),T(!1),f(!1)},P=N=>{_(w.bom[N]),S(N),T(!0),f(!0)},k=N=>{const A=w.bom.filter((B,Z)=>Z!==N);M(B=>({...B,bom:A}))},O=N=>{n&&(_(n.bom[N]),S(N),T(!1),f(!0))},Q=N=>{if(!n)return;const A=n.bom.filter((Z,te)=>te!==N),B={...n,bom:A};try{const Z=JSON.stringify(n),te=JSON.stringify(B);Z!==te&&(s(n.id,B),l(B))}catch{s(n.id,B),l(B)}},ee=N=>N>=60?"default":N>=40?"secondary":"destructive";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"เมนูและสูตรอาหาร (BOM)"}),e.jsx("p",{className:"text-muted-foreground",children:"จัดการรายการอาหารและคำนวณต้นทุนวัตถุดิบ"})]}),e.jsxs(Me,{open:c,onOpenChange:h,children:[e.jsx(Ae,{asChild:!0,children:e.jsxs(U,{children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"เพิ่มเมนูใหม่"]})}),e.jsxs(ke,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Re,{children:[e.jsx(Oe,{children:"เพิ่มเมนูใหม่"}),e.jsx(He,{children:"กรอกข้อมูลเมนูอาหารใหม่ และสูตรอาหาร"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"menu-name",children:"ชื่อเมนู"}),e.jsx(H,{id:"menu-name",value:w.name,onChange:N=>M(A=>({...A,name:N.target.value})),placeholder:"ข้าวมันไก่"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"menu-price",children:"ราคาขาย (บาท)"}),e.jsx(H,{id:"menu-price",type:"number",value:w.price,onChange:N=>M(A=>({...A,price:Ce(N.target.value)})),placeholder:"60"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Dine-in (%)"}),e.jsx(H,{type:"number",value:w.channelMix.dineIn,onChange:N=>M(A=>({...A,channelMix:{...A.channelMix,dineIn:parseFloat(N.target.value)||0}}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Takeaway (%)"}),e.jsx(H,{type:"number",value:w.channelMix.takeaway,onChange:N=>M(A=>({...A,channelMix:{...A.channelMix,takeaway:parseFloat(N.target.value)||0}}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Delivery (%)"}),e.jsx(H,{type:"number",value:w.channelMix.delivery,onChange:N=>M(A=>({...A,channelMix:{...A.channelMix,delivery:parseFloat(N.target.value)||0}}))})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-medium",children:"สูตรอาหาร (วัตถุดิบ)"}),e.jsxs(U,{type:"button",size:"sm",variant:"outline",onClick:()=>{T(!0),S(null),f(!0)},children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"เพิ่มวัตถุดิบ"]})]}),w.bom.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs(de,{children:[e.jsx(he,{children:e.jsxs(X,{children:[e.jsx($,{children:"วัตถุดิบ"}),e.jsx($,{className:"text-right",children:"ปริมาณ (กรัม)"}),e.jsx($,{className:"text-right",children:"ราคา/กก."}),e.jsx($,{className:"text-right",children:"Yield %"}),e.jsx($,{className:"text-right",children:"Waste %"}),e.jsx($,{className:"text-right",children:"ต้นทุน"}),e.jsx($,{className:"text-right",children:"การดำเนินการ"})]})}),e.jsx(ue,{children:w.bom.map((N,A)=>e.jsxs(X,{children:[e.jsx(C,{className:"font-medium",children:N.item}),e.jsx(C,{className:"text-right",children:N.qtyG}),e.jsx(C,{className:"text-right",children:g(N.unitCostPerKg)}),e.jsxs(C,{className:"text-right",children:[N.yieldPercent,"%"]}),e.jsxs(C,{className:"text-right",children:[N.wastePercent,"%"]}),e.jsx(C,{className:"text-right font-medium",children:g(y(N))}),e.jsx(C,{className:"text-right",children:e.jsxs("div",{className:"flex gap-1 justify-end",children:[e.jsx(U,{size:"sm",variant:"ghost",onClick:()=>P(A),children:e.jsx(ne,{className:"w-3 h-3"})}),e.jsx(U,{size:"sm",variant:"ghost",onClick:()=>k(A),children:e.jsx(ae,{className:"w-3 h-3"})})]})})]},A))})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 mt-4 p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"ต้นทุนรวม"}),e.jsx("div",{className:"text-sm font-bold",children:g(b(w.bom))})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"CM"}),e.jsx("div",{className:"text-sm font-bold text-green-600",children:g(w.price-b(w.bom))})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"CM %"}),e.jsxs("div",{className:"text-sm font-bold",children:[w.price>0?((w.price-b(w.bom))/w.price*100).toFixed(1):0,"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Food Cost %"}),e.jsxs("div",{className:"text-sm font-bold",children:[w.price>0?(b(w.bom)/w.price*100).toFixed(1):0,"%"]})]})]})]}):e.jsx("div",{className:"text-center py-4 text-muted-foreground text-sm border rounded-lg",children:'ยังไม่มีวัตถุดิบ คลิก "เพิ่มวัตถุดิบ" เพื่อเริ่มต้น'})]})]}),e.jsx(Te,{children:e.jsx(U,{onClick:v,children:"เพิ่มเมนู"})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(E,{children:[e.jsx(I,{children:e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(_a,{className:"w-5 h-5"}),"รายการเมนู"]})}),e.jsx(L,{children:e.jsx("div",{className:"space-y-2",children:i.map(N=>e.jsxs("div",{className:`p-3 rounded-lg border cursor-pointer transition-colors ${n?.id===N.id?"border-primary bg-primary/5":"border-border hover:bg-muted"}`,onClick:()=>l(N),children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:N.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:g(N.price)})]}),e.jsxs(se,{variant:ee(d(N)),children:["CM ",d(N).toFixed(1),"%"]})]}),e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsx(U,{size:"sm",variant:"ghost",onClick:A=>{A.stopPropagation(),confirm(`ต้องการลบเมนู "${N.name}" ใช่หรือไม่?`)&&(r(N.id),n?.id===N.id&&l(null))},"aria-label":`ลบ ${N.name}`,children:e.jsx(ae,{className:"w-4 h-4 text-red-600"})})})]},N.id))})})]}),e.jsxs(E,{className:"lg:col-span-2",children:[e.jsx(I,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(Ua,{className:"w-5 h-5"}),n?`สูตร: ${n.name}`:"เลือกเมนู"]}),n&&e.jsxs(G,{children:["ราคาขาย ",g(n.price)," | ต้นทุน ",g(b(n.bom))," | CM ",g(o(n))]})]}),n&&e.jsxs(Me,{open:x,onOpenChange:f,children:[e.jsx(Ae,{asChild:!0,children:e.jsxs(U,{size:"sm",children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"เพิ่มวัตถุดิบ"]})}),e.jsxs(ke,{className:"max-w-2xl",children:[e.jsx(Re,{children:e.jsx(Oe,{children:j!==null?"แก้ไขวัตถุดิบ":"เพิ่มวัตถุดิบใหม่"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"item-name",children:"ชื่อวัตถุดิบ"}),e.jsx(H,{id:"item-name",value:D.item,onChange:N=>_(A=>({...A,item:N.target.value})),placeholder:"น่องไก่"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"qty",children:"ปริมาณ (กรัม)"}),e.jsx(H,{id:"qty",type:"number",value:D.qtyG,onChange:N=>_(A=>({...A,qtyG:Ce(N.target.value)})),placeholder:"120"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"unit-cost",children:"ราคาต่อกิโลกรัม (บาท)"}),e.jsx(H,{id:"unit-cost",type:"number",value:D.unitCostPerKg,onChange:N=>_(A=>({...A,unitCostPerKg:Ce(N.target.value)})),placeholder:"70"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"yield",children:"Yield (%)"}),e.jsx(H,{id:"yield",type:"number",value:D.yieldPercent,onChange:N=>_(A=>({...A,yieldPercent:parseFloat(N.target.value)||100})),placeholder:"85"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"waste",children:"Waste (%)"}),e.jsx(H,{id:"waste",type:"number",value:D.wastePercent,onChange:N=>_(A=>({...A,wastePercent:parseFloat(N.target.value)||0})),placeholder:"5"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"ต้นทุนคำนวณ"}),e.jsx("div",{className:"text-lg font-bold text-primary",children:g(y(D))})]})]}),e.jsx(Te,{children:e.jsx(U,{onClick:R?p:u,children:j!==null?"บันทึกการแก้ไข":"เพิ่มวัตถุดิบ"})})]})]})]})}),e.jsx(L,{children:n?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(de,{children:[e.jsx(he,{children:e.jsxs(X,{children:[e.jsx($,{children:"วัตถุดิบ"}),e.jsx($,{className:"text-right",children:"ปริมาณ (กรัม)"}),e.jsx($,{className:"text-right",children:"ราคา/กก."}),e.jsx($,{className:"text-right",children:"Yield %"}),e.jsx($,{className:"text-right",children:"Waste %"}),e.jsx($,{className:"text-right",children:"ต้นทุน"}),e.jsx($,{className:"text-right",children:"การดำเนินการ"})]})}),e.jsx(ue,{children:n.bom.map((N,A)=>e.jsxs(X,{children:[e.jsx(C,{className:"font-medium",children:N.item}),e.jsx(C,{className:"text-right",children:N.qtyG}),e.jsx(C,{className:"text-right",children:g(N.unitCostPerKg)}),e.jsxs(C,{className:"text-right",children:[N.yieldPercent,"%"]}),e.jsxs(C,{className:"text-right",children:[N.wastePercent,"%"]}),e.jsx(C,{className:"text-right font-medium",children:g(y(N))}),e.jsx(C,{className:"text-right",children:e.jsxs("div",{className:"flex gap-1 justify-end",children:[e.jsx(U,{size:"sm",variant:"ghost",onClick:()=>O(A),children:e.jsx(ne,{className:"w-3 h-3"})}),e.jsx(U,{size:"sm",variant:"ghost",onClick:()=>Q(A),children:e.jsx(ae,{className:"w-3 h-3"})})]})})]},A))})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-4",children:[e.jsxs(E,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"ต้นทุนรวม"}),e.jsx("div",{className:"text-xl font-bold",children:g(b(n.bom))})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Contribution Margin"}),e.jsx("div",{className:"text-xl font-bold text-green-600",children:g(o(n))})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"CM %"}),e.jsxs("div",{className:"text-xl font-bold",children:[d(n).toFixed(1),"%"]})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Food Cost %"}),e.jsxs("div",{className:"text-xl font-bold",children:[(b(n.bom)/n.price*100).toFixed(1),"%"]})]})]})]}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"กรุณาเลือกเมนูเพื่อดูรายละเอียดสูตรอาหาร"})})]})]})]})}function ze({...a}){return e.jsx(pa,{"data-slot":"select",...a})}function Be({...a}){return e.jsx(ja,{"data-slot":"select-value",...a})}function Ke({className:a,size:s="default",children:t,...r}){return e.jsxs(ga,{"data-slot":"select-trigger","data-size":s,className:z("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-full items-center justify-between gap-2 rounded-md border bg-input-background px-3 py-2 text-sm whitespace-nowrap transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",a),...r,children:[t,e.jsx(fa,{asChild:!0,children:e.jsx(jt,{className:"size-4 opacity-50"})})]})}function Ge({className:a,children:s,position:t="popper",...r}){return e.jsx(va,{children:e.jsxs(ya,{"data-slot":"select-content",className:z("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:t,...r,children:[e.jsx(sn,{}),e.jsx(ba,{className:z("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:s}),e.jsx(tn,{})]})})}function re({className:a,children:s,...t}){return e.jsxs(Na,{"data-slot":"select-item",className:z("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",a),...t,children:[e.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:e.jsx(wa,{children:e.jsx($a,{className:"size-4"})})}),e.jsx(Pa,{children:s})]})}function sn({className:a,...s}){return e.jsx(Sa,{"data-slot":"select-scroll-up-button",className:z("flex cursor-default items-center justify-center py-1",a),...s,children:e.jsx(La,{className:"size-4"})})}function tn({className:a,...s}){return e.jsx(Ca,{"data-slot":"select-scroll-down-button",className:z("flex cursor-default items-center justify-center py-1",a),...s,children:e.jsx(jt,{className:"size-4"})})}function an(){const{data:a,updateUtilities:s}=le(),[t,r]=m.useState(!1),[i,n]=m.useState(null),[l,c]=m.useState({id:"",type:"electric",device:"",kw:0,hoursPerDay:0,ratePerKwh:5}),h=a?.utilities||[],x=()=>{c({id:"",type:"electric",device:"",kw:0,hoursPerDay:0,ratePerKwh:5})},f=o=>o.type==="electric"&&o.kw&&o.hoursPerDay&&o.ratePerKwh?o.kw*o.hoursPerDay*o.ratePerKwh:o.type==="lpg"&&o.kgPerBatch&&o.batchesPerDay&&o.ratePerKg?o.kgPerBatch*o.batchesPerDay*o.ratePerKg:o.type==="water"&&o.m3PerDay&&o.ratePerM3?o.m3PerDay*o.ratePerM3:0,j=o=>f(o)*30,S=()=>h.reduce((o,d)=>o+j(d),0),R=()=>{const o=l.id||`utility_${Date.now()}`,d={...l,id:o},v=i!==null?h.map((u,p)=>p===i?d:u):[...h,d];try{const u=JSON.stringify(h),p=JSON.stringify(v);u!==p&&s(v)}catch{s(v)}x(),n(null),r(!1)},T=o=>{c(h[o]),n(o),r(!0)},w=o=>{const d=h.filter((v,u)=>u!==o);try{const v=JSON.stringify(h),u=JSON.stringify(d);v!==u&&s(d)}catch{s(d)}},M=o=>{switch(o){case"electric":return e.jsx(qe,{className:"w-4 h-4"});case"lpg":return e.jsx(Ts,{className:"w-4 h-4"});case"water":return e.jsx(Os,{className:"w-4 h-4"});default:return e.jsx(qe,{className:"w-4 h-4"})}},D=o=>{const d={electric:"bg-yellow-100 text-yellow-800",lpg:"bg-orange-100 text-orange-800",water:"bg-blue-100 text-blue-800"},v={electric:"ไฟฟ้า",lpg:"แก๊ส LPG",water:"น้ำประปา"};return e.jsx(se,{className:d[o]||d.electric,children:v[o]||"ไฟฟ้า"})},_=h.filter(o=>o.type==="electric"),y=h.filter(o=>o.type==="lpg"),b=h.filter(o=>o.type==="water");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"สาธารณูปโภค"}),e.jsx("p",{className:"text-muted-foreground",children:"จัดการต้นทุนไฟฟ้า แก๊ส และน้ำประปา"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"ต้นทุนรวม/เดือน"}),e.jsx("div",{className:"text-xl font-bold",children:g(S())})]}),e.jsxs(Me,{open:t,onOpenChange:r,children:[e.jsx(Ae,{asChild:!0,children:e.jsxs(U,{onClick:()=>{x(),n(null)},children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"เพิ่มรายการ"]})}),e.jsxs(ke,{className:"max-w-2xl",children:[e.jsxs(Re,{children:[e.jsx(Oe,{children:i!==null?"แก้ไขรายการสาธารณูปโภค":"เพิ่มรายการสาธารณูปโภค"}),e.jsx(He,{children:"กรอกข้อมูลการใช้งานและอัตราค่าบริการ"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"device",children:"ชื่ออุปกรณ์/บริการ"}),e.jsx(H,{id:"device",value:l.device,onChange:o=>c(d=>({...d,device:o.target.value})),placeholder:"เครื่องปรับอากาศ"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"type",children:"ประเภท"}),e.jsxs(ze,{value:l.type,onValueChange:o=>c(d=>({...d,type:o})),children:[e.jsx(Ke,{children:e.jsx(Be,{})}),e.jsxs(Ge,{children:[e.jsx(re,{value:"electric",children:"ไฟฟ้า"}),e.jsx(re,{value:"lpg",children:"แก๊ส LPG"}),e.jsx(re,{value:"water",children:"น้ำประปา"})]})]})]})]}),l.type==="electric"&&e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"kw",children:"กำลังไฟ (kW)"}),e.jsx(H,{id:"kw",type:"number",step:"0.1",value:l.kw||"",onChange:o=>c(d=>({...d,kw:parseFloat(o.target.value)||0})),onBlur:()=>{const o=l.kw??0,d=l.hoursPerDay??0;if(l.device&&o>0&&d>0){const v=l.id||`utility_${Date.now()}`,u={...l,id:v},p=i!==null?h.map((P,k)=>k===i?u:P):[...h,u];s(p)}},placeholder:"2.5"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"hours",children:"ชั่วโมง/วัน"}),e.jsx(H,{id:"hours",type:"number",value:l.hoursPerDay||"",onChange:o=>c(d=>({...d,hoursPerDay:parseFloat(o.target.value)||0})),placeholder:"6"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"rate-kwh",children:"อัตรา บาท/kWh"}),e.jsx(H,{id:"rate-kwh",type:"number",step:"0.01",value:l.ratePerKwh||"",onChange:o=>c(d=>({...d,ratePerKwh:parseFloat(o.target.value)||0})),placeholder:"5.00"})]})]}),l.type==="lpg"&&e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"kg-batch",children:"กก./batch"}),e.jsx(H,{id:"kg-batch",type:"number",step:"0.01",value:l.kgPerBatch||"",onChange:o=>c(d=>({...d,kgPerBatch:parseFloat(o.target.value)||0})),placeholder:"0.25"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"batches",children:"batch/วัน"}),e.jsx(H,{id:"batches",type:"number",value:l.batchesPerDay||"",onChange:o=>c(d=>({...d,batchesPerDay:parseFloat(o.target.value)||0})),placeholder:"2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"rate-kg",children:"อัตรา บาท/กก."}),e.jsx(H,{id:"rate-kg",type:"number",step:"0.01",value:l.ratePerKg||"",onChange:o=>c(d=>({...d,ratePerKg:parseFloat(o.target.value)||0})),placeholder:"29.33"})]})]}),l.type==="water"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"m3-day",children:"ลูกบาศก์เมตร/วัน"}),e.jsx(H,{id:"m3-day",type:"number",step:"0.1",value:l.m3PerDay||"",onChange:o=>c(d=>({...d,m3PerDay:parseFloat(o.target.value)||0})),placeholder:"0.2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"rate-m3",children:"อัตรา บาท/ลบ.ม."}),e.jsx(H,{id:"rate-m3",type:"number",step:"0.01",value:l.ratePerM3||"",onChange:o=>c(d=>({...d,ratePerM3:parseFloat(o.target.value)||0})),placeholder:"14.00"})]})]}),e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ee,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"การคำนวณต้นทุน"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"ต้นทุน/วัน:"}),e.jsx("div",{className:"font-bold",children:g(f(l))})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"ต้นทุน/เดือน:"}),e.jsx("div",{className:"font-bold",children:g(j(l))})]})]})]})]}),e.jsx(Te,{children:e.jsx(U,{onClick:R,children:i!==null?"บันทึกการแก้ไข":"เพิ่มรายการ"})})]})]})]})]}),e.jsxs(we,{defaultValue:"all",className:"space-y-4",children:[e.jsxs(Pe,{children:[e.jsx(q,{value:"all",children:"ทั้งหมด"}),e.jsxs(q,{value:"electric",children:["ไฟฟ้า (",_.length,")"]}),e.jsxs(q,{value:"lpg",children:["แก๊ส (",y.length,")"]}),e.jsxs(q,{value:"water",children:["น้ำประปา (",b.length,")"]})]}),e.jsx(J,{value:"all",children:e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(V,{children:"รายการสาธารณูปโภคทั้งหมด"}),e.jsxs(G,{children:["ต้นทุนรวมทั้งหมด ",g(S())," ต่อเดือน"]})]}),e.jsx(L,{children:e.jsxs(de,{children:[e.jsx(he,{children:e.jsxs(X,{children:[e.jsx($,{children:"อุปกรณ์/บริการ"}),e.jsx($,{children:"ประเภท"}),e.jsx($,{className:"text-right",children:"การใช้งาน"}),e.jsx($,{className:"text-right",children:"อัตรา"}),e.jsx($,{className:"text-right",children:"ต้นทุน/วัน"}),e.jsx($,{className:"text-right",children:"ต้นทุน/เดือน"}),e.jsx($,{className:"text-right",children:"การดำเนินการ"})]})}),e.jsx(ue,{children:h.map((o,d)=>e.jsxs(X,{children:[e.jsx(C,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[M(o.type),o.device]})}),e.jsx(C,{children:D(o.type)}),e.jsxs(C,{className:"text-right",children:[o.type==="electric"&&`${o.kw} kW × ${o.hoursPerDay} ชม.`,o.type==="lpg"&&`${o.kgPerBatch} กก. × ${o.batchesPerDay} batch`,o.type==="water"&&`${o.m3PerDay} ลบ.ม./วัน`]}),e.jsxs(C,{className:"text-right",children:[o.type==="electric"&&`${o.ratePerKwh} บาท/kWh`,o.type==="lpg"&&`${o.ratePerKg} บาท/กก.`,o.type==="water"&&`${o.ratePerM3} บาท/ลบ.ม.`]}),e.jsx(C,{className:"text-right font-medium",children:g(f(o))}),e.jsx(C,{className:"text-right font-bold",children:g(j(o))}),e.jsx(C,{className:"text-right",children:e.jsxs("div",{className:"flex gap-1 justify-end",children:[e.jsx(U,{size:"sm",variant:"ghost",onClick:()=>T(d),children:e.jsx(ne,{className:"w-3 h-3"})}),e.jsx(U,{size:"sm",variant:"ghost",onClick:()=>w(d),children:e.jsx(ae,{className:"w-3 h-3"})})]})})]},o.id))})]})})]})}),e.jsx(J,{value:"electric",children:e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"w-5 h-5"}),"ไฟฟ้า"]}),e.jsxs(G,{children:["ต้นทุนไฟฟ้ารวม ",g(_.reduce((o,d)=>o+j(d),0))," ต่อเดือน"]})]}),e.jsx(L,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:_.map((o,d)=>e.jsxs(E,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h4",{className:"font-medium",children:o.device}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(U,{size:"sm",variant:"ghost",onClick:()=>T(h.indexOf(o)),children:e.jsx(ne,{className:"w-3 h-3"})}),e.jsx(U,{size:"sm",variant:"ghost",onClick:()=>w(h.indexOf(o)),children:e.jsx(ae,{className:"w-3 h-3"})})]})]}),e.jsxs("div",{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsxs("div",{children:["กำลังไฟ: ",o.kw," kW"]}),e.jsxs("div",{children:["ใช้งาน: ",o.hoursPerDay," ชั่วโมง/วัน"]}),e.jsxs("div",{children:["อัตรา: ",o.ratePerKwh," บาท/kWh"]})]}),e.jsx("div",{className:"mt-2 pt-2 border-t",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"ต้นทุน/เดือน:"}),e.jsx("span",{className:"font-bold",children:g(j(o))})]})})]},o.id))})})]})}),e.jsx(J,{value:"lpg",children:e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(Ts,{className:"w-5 h-5"}),"แก๊ส LPG"]}),e.jsxs(G,{children:["ต้นทุนแก๊สรวม ",g(y.reduce((o,d)=>o+j(d),0))," ต่อเดือน"]})]}),e.jsx(L,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:y.map(o=>e.jsxs(E,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h4",{className:"font-medium",children:o.device}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(U,{size:"sm",variant:"ghost",onClick:()=>T(h.indexOf(o)),children:e.jsx(ne,{className:"w-3 h-3"})}),e.jsx(U,{size:"sm",variant:"ghost",onClick:()=>w(h.indexOf(o)),children:e.jsx(ae,{className:"w-3 h-3"})})]})]}),e.jsxs("div",{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsxs("div",{children:["การใช้: ",o.kgPerBatch," กก./batch"]}),e.jsxs("div",{children:["จำนวน: ",o.batchesPerDay," batch/วัน"]}),e.jsxs("div",{children:["อัตรา: ",o.ratePerKg," บาท/กก."]})]}),e.jsx("div",{className:"mt-2 pt-2 border-t",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"ต้นทุน/เดือน:"}),e.jsx("span",{className:"font-bold",children:g(j(o))})]})})]},o.id))})})]})}),e.jsx(J,{value:"water",children:e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(Os,{className:"w-5 h-5"}),"น้ำประปา"]}),e.jsxs(G,{children:["ต้นทุนน้ำรวม ",g(b.reduce((o,d)=>o+j(d),0))," ต่อเดือน"]})]}),e.jsx(L,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:b.map(o=>e.jsxs(E,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h4",{className:"font-medium",children:o.device}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(U,{size:"sm",variant:"ghost",onClick:()=>T(h.indexOf(o)),children:e.jsx(ne,{className:"w-3 h-3"})}),e.jsx(U,{size:"sm",variant:"ghost",onClick:()=>w(h.indexOf(o)),children:e.jsx(ae,{className:"w-3 h-3"})})]})]}),e.jsxs("div",{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsxs("div",{children:["การใช้: ",o.m3PerDay," ลูกบาศก์เมตร/วัน"]}),e.jsxs("div",{children:["อัตรา: ",o.ratePerM3," บาท/ลบ.ม."]})]}),e.jsx("div",{className:"mt-2 pt-2 border-t",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"ต้นทุน/เดือน:"}),e.jsx("span",{className:"font-bold",children:g(j(o))})]})})]},o.id))})})]})})]})]})}function rn(){const{data:a,updateLabor:s}=le(),[t,r]=m.useState(!1),[i,n]=m.useState(null),[l,c]=m.useState({id:"",role:"",type:"direct",wagePerHour:45,hoursPerDay:8,daysPerWeek:6}),h=a?.labor||[],x=()=>{c({id:"",role:"",type:"direct",wagePerHour:45,hoursPerDay:8,daysPerWeek:6})},f=d=>d.wagePerHour*d.hoursPerDay,j=d=>f(d)*d.daysPerWeek,S=d=>j(d)*4.33,R=()=>h.reduce((d,v)=>d+S(v),0),T=()=>h.filter(d=>d.type==="direct").reduce((d,v)=>d+S(v),0),w=()=>h.filter(d=>d.type==="indirect").reduce((d,v)=>d+S(v),0),M=()=>{const d=l.id||`labor_${Date.now()}`,v={...l,id:d},u=i!==null?h.map((p,P)=>P===i?v:p):[...h,v];try{const p=JSON.stringify(h),P=JSON.stringify(u);p!==P&&s(u)}catch{s(u)}x(),n(null),r(!1)},D=d=>{c(h[d]),n(d),r(!0)},_=d=>{const v=h.filter((u,p)=>p!==d);try{const u=JSON.stringify(h),p=JSON.stringify(v);u!==p&&s(v)}catch{s(v)}},y=d=>d==="direct"?e.jsx(se,{className:"bg-green-100 text-green-800",children:"แรงงานโดยตรง"}):e.jsx(se,{className:"bg-blue-100 text-blue-800",children:"แรงงานทางอ้อม"}),b=h.filter(d=>d.type==="direct"),o=h.filter(d=>d.type==="indirect");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"แรงงาน"}),e.jsx("p",{className:"text-muted-foreground",children:"จัดการต้นทุนแรงงานและตารางงาน"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"ต้นทุนรวม/เดือน"}),e.jsx("div",{className:"text-xl font-bold",children:g(R())})]}),e.jsxs(Me,{open:t,onOpenChange:r,children:[e.jsx(Ae,{asChild:!0,children:e.jsxs(U,{onClick:()=>{x(),n(null)},children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"เพิ่มพนักงาน"]})}),e.jsxs(ke,{className:"max-w-2xl",children:[e.jsxs(Re,{children:[e.jsx(Oe,{children:i!==null?"แก้ไขข้อมูลพนักงาน":"เพิ่มพนักงานใหม่"}),e.jsx(He,{children:"กรอกข้อมูลตำแหน่งงาน ค่าจ้าง และตารางงาน"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"role",children:"ตำแหน่งงาน"}),e.jsx(H,{id:"role",value:l.role,onChange:d=>c(v=>({...v,role:d.target.value})),placeholder:"พ่อครัว, แคชเชียร์, ผู้ช่วย"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"type",children:"ประเภทแรงงาน"}),e.jsxs(ze,{value:l.type,onValueChange:d=>c(v=>({...v,type:d})),children:[e.jsx(Ke,{children:e.jsx(Be,{})}),e.jsxs(Ge,{children:[e.jsx(re,{value:"direct",children:"แรงงานโดยตรง (เกี่ยวข้องการผลิต)"}),e.jsx(re,{value:"indirect",children:"แรงงานทางอ้อม (บริหาร/ขาย)"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"wage",children:"ค่าจ้าง/ชั่วโมง (บาท)"}),e.jsx(H,{id:"wage",type:"number",step:"0.5",value:l.wagePerHour,onChange:d=>c(v=>({...v,wagePerHour:parseFloat(d.target.value)||0})),placeholder:"45"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"hours",children:"ชั่วโมง/วัน"}),e.jsx(H,{id:"hours",type:"number",value:l.hoursPerDay,onChange:d=>c(v=>({...v,hoursPerDay:parseFloat(d.target.value)||0})),placeholder:"8"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"days",children:"วัน/สัปดาห์"}),e.jsx(H,{id:"days",type:"number",value:l.daysPerWeek,onChange:d=>c(v=>({...v,daysPerWeek:parseFloat(d.target.value)||0})),placeholder:"6"})]})]}),e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ee,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"การคำนวณค่าจ้าง"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"รายวัน:"}),e.jsx("div",{className:"font-bold",children:g(f(l))})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"รายสัปดาห์:"}),e.jsx("div",{className:"font-bold",children:g(j(l))})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"รายเดือน:"}),e.jsx("div",{className:"font-bold",children:g(S(l))})]})]})]})]}),e.jsx(Te,{children:e.jsx(U,{onClick:M,children:i!==null?"บันทึกการแก้ไข":"เพิ่มพนักงาน"})})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(E,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"ต้นทุนรวม/เดือน"}),e.jsx("div",{className:"text-2xl font-bold",children:g(R())})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"แรงงานโดยตรง"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:g(T())})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"แรงงานทางอ้อม"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:g(w())})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"จำนวนพนักงาน"}),e.jsxs("div",{className:"text-2xl font-bold",children:[h.length," คน"]})]})]}),e.jsxs(we,{defaultValue:"all",className:"space-y-4",children:[e.jsxs(Pe,{children:[e.jsx(q,{value:"all",children:"ทั้งหมด"}),e.jsxs(q,{value:"direct",children:["แรงงานโดยตรง (",b.length,")"]}),e.jsxs(q,{value:"indirect",children:["แรงงานทางอ้อม (",o.length,")"]})]}),e.jsx(J,{value:"all",children:e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(V,{children:"รายการพนักงานทั้งหมด"}),e.jsxs(G,{children:["ต้นทุนแรงงานรวม ",g(R())," ต่อเดือน"]})]}),e.jsx(L,{children:e.jsxs(de,{children:[e.jsx(he,{children:e.jsxs(X,{children:[e.jsx($,{children:"ตำแหน่งงาน"}),e.jsx($,{children:"ประเภท"}),e.jsx($,{className:"text-right",children:"ค่าจ้าง/ชม."}),e.jsx($,{className:"text-right",children:"ชั่วโมง/วัน"}),e.jsx($,{className:"text-right",children:"วัน/สัปดาห์"}),e.jsx($,{className:"text-right",children:"รายวัน"}),e.jsx($,{className:"text-right",children:"รายเดือน"}),e.jsx($,{className:"text-right",children:"การดำเนินการ"})]})}),e.jsx(ue,{children:h.map((d,v)=>e.jsxs(X,{children:[e.jsx(C,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4"}),d.role]})}),e.jsx(C,{children:y(d.type)}),e.jsx(C,{className:"text-right",children:g(d.wagePerHour)}),e.jsx(C,{className:"text-right",children:d.hoursPerDay}),e.jsx(C,{className:"text-right",children:d.daysPerWeek}),e.jsx(C,{className:"text-right font-medium",children:g(f(d))}),e.jsx(C,{className:"text-right font-bold",children:g(S(d))}),e.jsx(C,{className:"text-right",children:e.jsxs("div",{className:"flex gap-1 justify-end",children:[e.jsx(U,{size:"sm",variant:"ghost",onClick:()=>D(v),children:e.jsx(ne,{className:"w-3 h-3"})}),e.jsx(U,{size:"sm",variant:"ghost",onClick:()=>_(v),children:e.jsx(ae,{className:"w-3 h-3"})})]})})]},d.id))})]})})]})}),e.jsx(J,{value:"direct",children:e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-5 h-5 text-green-600"}),"แรงงานโดยตรง"]}),e.jsxs(G,{children:["พนักงานที่เกี่ยวข้องการผลิตโดยตรง - ต้นทุน ",g(T())," ต่อเดือน"]})]}),e.jsx(L,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:b.map((d,v)=>e.jsxs(E,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h4",{className:"font-medium",children:d.role}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(U,{size:"sm",variant:"ghost",onClick:()=>D(h.indexOf(d)),children:e.jsx(ne,{className:"w-3 h-3"})}),e.jsx(U,{size:"sm",variant:"ghost",onClick:()=>_(h.indexOf(d)),children:e.jsx(ae,{className:"w-3 h-3"})})]})]}),e.jsxs("div",{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(us,{className:"w-3 h-3"}),g(d.wagePerHour),"/ชั่วโมง"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ze,{className:"w-3 h-3"}),d.hoursPerDay," ชม./วัน × ",d.daysPerWeek," วัน/สัปดาห์"]})]}),e.jsx("div",{className:"mt-2 pt-2 border-t",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"ต้นทุน/เดือน:"}),e.jsx("span",{className:"font-bold text-green-600",children:g(S(d))})]})})]},d.id))})})]})}),e.jsx(J,{value:"indirect",children:e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-5 h-5 text-blue-600"}),"แรงงานทางอ้อม"]}),e.jsxs(G,{children:["พนักงานบริหารและขาย - ต้นทุน ",g(w())," ต่อเดือน"]})]}),e.jsx(L,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:o.map(d=>e.jsxs(E,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h4",{className:"font-medium",children:d.role}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(U,{size:"sm",variant:"ghost",onClick:()=>D(h.indexOf(d)),children:e.jsx(ne,{className:"w-3 h-3"})}),e.jsx(U,{size:"sm",variant:"ghost",onClick:()=>_(h.indexOf(d)),children:e.jsx(ae,{className:"w-3 h-3"})})]})]}),e.jsxs("div",{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(us,{className:"w-3 h-3"}),g(d.wagePerHour),"/ชั่วโมง"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ze,{className:"w-3 h-3"}),d.hoursPerDay," ชม./วัน × ",d.daysPerWeek," วัน/สัปดาห์"]})]}),e.jsx("div",{className:"mt-2 pt-2 border-t",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"ต้นทุน/เดือน:"}),e.jsx("span",{className:"font-bold text-blue-600",children:g(S(d))})]})})]},d.id))})})]})})]}),e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(V,{children:"การวิเคราะห์ประสิทธิภาพแรงงาน"}),e.jsx(G,{children:"ตัวชี้วัดประสิทธิภาพและต้นทุนแรงงาน"})]}),e.jsx(L,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-green-900",children:"สัดส่วนแรงงานโดยตรง"}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[R()>0?(T()/R()*100).toFixed(1):0,"%"]}),e.jsxs("div",{className:"text-xs text-green-700",children:[g(T())," จาก ",g(R())]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-blue-900",children:"สัดส่วนแรงงานทางอ้อม"}),e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[R()>0?(w()/R()*100).toFixed(1):0,"%"]}),e.jsxs("div",{className:"text-xs text-blue-700",children:[g(w())," จาก ",g(R())]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"ค่าแรงเฉลี่ย/ชั่วโมง"}),e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:h.length>0?g(h.reduce((d,v)=>d+v.wagePerHour,0)/h.length):g(0)}),e.jsxs("div",{className:"text-xs text-gray-700",children:["เฉลี่ยทั้งหมด ",h.length," ตำแหน่ง"]})]})]})})]})]})}function nn(){const{data:a,updateFixedCosts:s}=le(),[t,r]=m.useState(!1),[i,n]=m.useState(null),[l,c]=m.useState({id:"",name:"",amountPerMonth:0}),h=a?.fixedCosts||[],x=()=>{c({id:"",name:"",amountPerMonth:0})},f=()=>h.reduce((u,p)=>u+p.amountPerMonth,0),j=()=>f()*12,S=()=>{const u=l.id||`fixed_${Date.now()}`,p={...l,id:u},P=i!==null?h.map((k,O)=>O===i?p:k):[...h,p];try{const k=JSON.stringify(h),O=JSON.stringify(P);k===O||s(P)}catch{s(P)}x(),n(null),r(!1)},R=u=>{c(h[u]),n(u),r(!0)},T=u=>{const p=h.filter((P,k)=>k!==u);try{const P=JSON.stringify(h),k=JSON.stringify(p);P!==k&&s(p)}catch{s(p)}},w=u=>{const p=u.toLowerCase();return p.includes("เช่า")||p.includes("rent")?e.jsx(Ss,{className:"w-4 h-4"}):p.includes("เน็ต")||p.includes("internet")?e.jsx(Ia,{className:"w-4 h-4"}):p.includes("ซ่อม")||p.includes("maintenance")?e.jsx(Va,{className:"w-4 h-4"}):p.includes("เสื่อม")||p.includes("depreciation")?e.jsx(Xe,{className:"w-4 h-4"}):e.jsx(Ee,{className:"w-4 h-4"})},M=u=>{const p=u.toLowerCase();return p.includes("เช่า")||p.includes("rent")?"เช่าและค่าธรรมเนียม":p.includes("เน็ต")||p.includes("internet")||p.includes("โทร")?"สื่อสาร":p.includes("ซ่อม")||p.includes("maintenance")?"ซ่อมบำรุง":p.includes("เสื่อม")||p.includes("depreciation")?"ค่าเสื่อมราคา":p.includes("ประกัน")||p.includes("insurance")?"ประกัน":p.includes("ใบอนุญาต")||p.includes("license")?"ใบอนุญาต":"อื่น ๆ"},D=h.reduce((u,p)=>{const P=M(p.name);return u[P]||(u[P]=[]),u[P].push(p),u},{}),_=[{name:"ค่าเช่าพื้นที่",amount:0,category:"เช่าและค่าธรรมเนียม"},{name:"ค่าอินเทอร์เน็ต",amount:700,category:"สื่อสาร"},{name:"ค่าโทรศัพท์",amount:300,category:"สื่อสาร"},{name:"ค่าซ่อมบำรุงขั้นต่ำ",amount:1e3,category:"ซ่อมบำรุง"},{name:"ค่าเสื่อมราคาอุปกรณ์",amount:1500,category:"ค่าเสื่อมราคา"},{name:"ประกันอุบัติเหตุ",amount:500,category:"ประกัน"},{name:"ใบอนุญาตประกอบการ",amount:200,category:"ใบอนุญาต"},{name:"ค่าสมาชิกธนาคาร",amount:50,category:"เช่าและค่าธรรมเนียม"}],[y,b]=m.useState({}),o=m.useRef({});m.useEffect(()=>{const u=new Set(h.map(p=>p.id));b(p=>{const P={};for(const k of Object.keys(p))u.has(k)&&(P[k]=p[k]);return P})},[h]);const d=(u,p)=>{o.current[u]&&clearTimeout(o.current[u]),o.current[u]=setTimeout(()=>{v(u),delete o.current[u]},600)},v=u=>{const p=y[u],P=h.find(Q=>Q.id===u);if(!P)return;const k=typeof p=="number"?p:P.amountPerMonth;if(P.amountPerMonth===k)return;const O=h.map(Q=>Q.id===u?{...Q,amountPerMonth:k}:Q);try{const Q=JSON.stringify(h),ee=JSON.stringify(O);Q!==ee&&s(O)}catch{s(O)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"ค่าใช้จ่ายคงที่"}),e.jsx("p",{className:"text-muted-foreground",children:"จัดการต้นทุนที่ไม่เปลี่ยนแปลงตามปริมาณการขาย"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"ต้นทุนรวม/เดือน"}),e.jsx("div",{className:"text-xl font-bold",children:g(f())})]}),e.jsxs(Me,{open:t,onOpenChange:r,children:[e.jsx(Ae,{asChild:!0,children:e.jsxs(U,{onClick:()=>{x(),n(null)},children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"เพิ่มรายการ"]})}),e.jsxs(ke,{children:[e.jsxs(Re,{children:[e.jsx(Oe,{children:i!==null?"แก้ไขค่าใช้จ่ายคงที่":"เพิ่มค่าใช้จ่ายคงที่"}),e.jsx(He,{children:"กรอกรายการค่าใช้จ่ายที่เกิดขึ้นประจำทุกเดือน"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"cost-name",children:"รายการ"}),e.jsx(H,{id:"cost-name",value:l.name,onChange:u=>c(p=>({...p,name:u.target.value})),placeholder:"ค่าเช่า, ค่าไฟฟ้าพื้นฐาน, ค่าประกัน"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"amount",children:"จำนวนเงิน/เดือน (บาท)"}),e.jsx(H,{id:"amount",type:"number",value:l.amountPerMonth,onChange:u=>c(p=>({...p,amountPerMonth:Ce(u.target.value)})),onBlur:()=>{if(l.name&&l.amountPerMonth>0){const u=l.id||`fixed_${Date.now()}`,p={...l,id:u},P=i!==null?h.map((k,O)=>O===i?p:k):[...h,p];try{const k=JSON.stringify(h),O=JSON.stringify(P);k!==O&&s(P)}catch{s(P)}}},placeholder:"1000"})]}),e.jsxs("div",{className:"p-3 bg-muted rounded-lg",children:[e.jsxs("div",{className:"text-sm font-medium",children:["ประเภท: ",M(l.name)]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["ต้นทุนต่อปี: ",g(l.amountPerMonth*12)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"เพิ่มรายการแนะนำ:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:_.map((u,p)=>e.jsx(U,{variant:"outline",size:"sm",onClick:()=>c(P=>({...P,name:u.name,amountPerMonth:u.amount})),children:u.name},p))})]})]}),e.jsx(Te,{children:e.jsx(U,{onClick:S,children:i!==null?"บันทึกการแก้ไข":"เพิ่มรายการ"})})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(E,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"ต้นทุนรวม/เดือน"}),e.jsx("div",{className:"text-2xl font-bold",children:g(f())})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"ต้นทุนรวม/ปี"}),e.jsx("div",{className:"text-2xl font-bold",children:g(j())})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"จำนวนรายการ"}),e.jsxs("div",{className:"text-2xl font-bold",children:[h.length," รายการ"]})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"เฉลี่ย/รายการ"}),e.jsx("div",{className:"text-2xl font-bold",children:h.length>0?g(f()/h.length):g(0)})]})]}),e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(V,{children:"รายการค่าใช้จ่ายคงที่"}),e.jsx(G,{children:"ค่าใช้จ่ายที่เกิดขึ้นประจำทุกเดือนโดยไม่ขึ้นกับปริมาณการขาย"})]}),e.jsx(L,{children:e.jsxs(de,{children:[e.jsx(he,{children:e.jsxs(X,{children:[e.jsx($,{children:"รายการ"}),e.jsx($,{children:"ประเภท"}),e.jsx($,{className:"text-right",children:"จำนวน/เดือน"}),e.jsx($,{className:"text-right",children:"จำนวน/ปี"}),e.jsx($,{className:"text-right",children:"สัดส่วน"}),e.jsx($,{className:"text-right",children:"การดำเนินการ"})]})}),e.jsx(ue,{children:h.map((u,p)=>e.jsxs(X,{children:[e.jsx(C,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[w(u.name),u.name]})}),e.jsx(C,{children:e.jsx(se,{variant:"outline",children:M(u.name)})}),e.jsx(C,{className:"text-right font-medium",children:e.jsx(H,{type:"number",value:y[u.id]??u.amountPerMonth,onChange:P=>{const k=Ce(P.target.value);b(O=>({...O,[u.id]:k})),d(u.id)},onBlur:()=>v(u.id),className:"text-right"})}),e.jsx(C,{className:"text-right",children:g((y[u.id]??u.amountPerMonth)*12)}),e.jsx(C,{className:"text-right",children:f()>0?`${(u.amountPerMonth/f()*100).toFixed(1)}%`:"0%"}),e.jsx(C,{className:"text-right",children:e.jsxs("div",{className:"flex gap-1 justify-end",children:[e.jsx(U,{size:"sm",variant:"ghost",onClick:()=>R(p),children:e.jsx(ne,{className:"w-3 h-3"})}),e.jsx(U,{size:"sm",variant:"ghost",onClick:()=>T(p),children:e.jsx(ae,{className:"w-3 h-3"})})]})})]},u.id))})]})})]}),e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(V,{children:"สรุปตามประเภท"}),e.jsx(G,{children:"แสดงค่าใช้จ่ายคงที่จัดกลุ่มตามประเภท"})]}),e.jsx(L,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(D).map(([u,p])=>{const P=p.reduce((O,Q)=>O+Q.amountPerMonth,0),k=f()>0?P/f()*100:0;return e.jsxs(E,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h4",{className:"font-medium",children:u}),e.jsxs(se,{variant:"secondary",children:[p.length," รายการ"]})]}),e.jsx("div",{className:"space-y-1 text-sm text-muted-foreground mb-3",children:p.map(O=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:O.name}),e.jsx("span",{children:g(O.amountPerMonth)})]},O.id))}),e.jsxs("div",{className:"pt-2 border-t",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"รวม/เดือน:"}),e.jsx("span",{className:"font-bold",children:g(P)})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-muted-foreground",children:[e.jsx("span",{children:"สัดส่วน:"}),e.jsxs("span",{children:[k.toFixed(1),"%"]})]})]})]},u)})})})]}),e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(V,{children:"การวิเคราะห์ค่าใช้จ่ายคงที่"}),e.jsx(G,{children:"ตัวชี้วัดและข้อเสนอแนะ"})]}),e.jsx(L,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-blue-900",children:"ต้นทุนคงที่/วัน"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:g(f()/30)}),e.jsx("div",{className:"text-xs text-blue-700",children:"จำนวนเงินที่ต้องชดเชยทุกวัน"})]}),e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-green-900",children:"Break-Even ประมาณ"}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[Math.round(f()/30/40)," จาน/วัน"]}),e.jsx("div",{className:"text-xs text-green-700",children:"สมมติ CM เฉลี่ย 40 บาท/จาน"})]}),e.jsxs("div",{className:"p-4 bg-orange-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-orange-900",children:"รายการสูงสุด"}),e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:h.length>0?g(Math.max(...h.map(u=>u.amountPerMonth))):g(0)}),e.jsx("div",{className:"text-xs text-orange-700",children:h.length>0?h.find(u=>u.amountPerMonth===Math.max(...h.map(p=>p.amountPerMonth)))?.name:"ไม่มีข้อมูล"})]})]})})]})]})}function ln({currentScenario:a,onScenarioChange:s}){const[t]=m.useState(()=>({})),[r,i]=m.useState(!1),[n,l]=m.useState(""),[c,h]=m.useState(["base","S1"]),[x,f]=m.useState(0),[j,S]=m.useState(0),[R,T]=m.useState(0),[w,M]=m.useState(0),[D,_]=m.useState(0),y=[{name:"ขึ้นราคา 5%",deltas:{menuPriceDeltaPercent:5}},{name:"วัตถุดิบ +10%",deltas:{ingredientCostDeltaPercent:10}},{name:"ค่าไฟ +15%",deltas:{electricRateDeltaPercent:15}},{name:"ลด Waste 50%",deltas:{wasteDeltaPercent:-50}},{name:"เพิ่มประสิทธิภาพ 20%",deltas:{laborProductivityDeltaPercent:20}}],b=()=>{i(!1),l("")},o=u=>({revenue:18e4+(u==="S1"?9e3:0),profit:6e4+(u==="S1"?5e3:0),primeCostPct:58+(u==="S1"?-2:0),bepUnits:2500+(u==="S1"?-200:0)}),d=c.map(u=>{const p=o(u);return{scenario:u==="base"?"ฐาน":u,revenue:p.revenue,profit:p.profit,primeCost:p.primeCostPct,bep:p.bepUnits}}),v=[{variable:"ราคาเมนู",change:-10,impact:-15.2},{variable:"ราคาเมนู",change:-5,impact:-7.6},{variable:"ราคาเมนู",change:0,impact:0},{variable:"ราคาเมนู",change:5,impact:8.3},{variable:"ราคาเมนู",change:10,impact:16.7}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"สถานการณ์และการเปรียบเทียบ"}),e.jsx("p",{className:"text-muted-foreground",children:"สร้างและเปรียบเทียบสถานการณ์ทางการเงินที่แตกต่างกัน"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(se,{variant:"outline",children:["สถานการณ์ปัจจุบัน: ",a==="base"?"ฐาน":a]}),e.jsxs(Me,{open:r,onOpenChange:i,children:[e.jsx(Ae,{asChild:!0,children:e.jsxs(U,{children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"สร้างสถานการณ์"]})}),e.jsxs(ke,{children:[e.jsxs(Re,{children:[e.jsx(Oe,{children:"สร้างสถานการณ์ใหม่"}),e.jsx(He,{children:"สร้างสถานการณ์ใหม่เพื่อทดสอบการเปลี่ยนแปลงต่าง ๆ"})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"scenario-name",children:"ชื่อสถานการณ์"}),e.jsx(H,{id:"scenario-name",value:n,onChange:u=>l(u.target.value),placeholder:"เช่น: ขึ้นราคา 5%, ลดต้นทุน 10%"})]})}),e.jsx(Te,{children:e.jsx(U,{onClick:b,children:"สร้าง"})})]})]})]})]}),e.jsxs(we,{defaultValue:"adjust",className:"space-y-4",children:[e.jsxs(Pe,{children:[e.jsx(q,{value:"adjust",children:"ปรับตัวแปร"}),e.jsx(q,{value:"compare",children:"เปรียบเทียบ"}),e.jsx(q,{value:"sensitivity",children:"ความไว"}),e.jsx(q,{value:"quick",children:"Quick Scenarios"})]}),e.jsx(J,{value:"adjust",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(V,{children:"ปรับตัวแปรสถานการณ์"}),e.jsx(G,{children:"ใช้ Slider เพื่อปรับเปลี่ยนตัวแปรต่าง ๆ และดูผลกระทบทันที"})]}),e.jsxs(L,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(F,{children:"ราคาเมนู"}),e.jsxs(se,{variant:x>0?"default":x<0?"destructive":"secondary",children:[x>=0?"+":"",x.toFixed(1),"%"]})]}),e.jsx(ye,{value:[x],onValueChange:u=>{const p=u[0];f(p),s(a)},max:100,min:-50,step:.1,className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"-50%"}),e.jsx("span",{children:"+100%"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(F,{children:"ต้นทุนวัตถุดิบ"}),e.jsxs(se,{variant:j>0?"destructive":j<0?"default":"secondary",children:[j>=0?"+":"",j.toFixed(1),"%"]})]}),e.jsx(ye,{value:[j],onValueChange:u=>{const p=u[0];S(p),s(a)},max:200,min:-75,step:.1,className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"-75%"}),e.jsx("span",{children:"+200%"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(F,{children:"ค่าไฟฟ้า"}),e.jsxs(se,{variant:R>0?"destructive":R<0?"default":"secondary",children:[R>=0?"+":"",R.toFixed(1),"%"]})]}),e.jsx(ye,{value:[R],onValueChange:u=>{const p=u[0];T(p),s(a)},max:150,min:-50,step:.1,className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"-50%"}),e.jsx("span",{children:"+150%"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(F,{children:"ประสิทธิภาพแรงงาน"}),e.jsxs(se,{variant:w>0?"default":w<0?"destructive":"secondary",children:[w>=0?"+":"",w.toFixed(1),"%"]})]}),e.jsx(ye,{value:[w],onValueChange:u=>{const p=u[0];M(p),s(a)},max:300,min:-90,step:.1,className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"-90%"}),e.jsx("span",{children:"+300%"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(F,{children:"การเสียหาย/Waste"}),e.jsxs(se,{variant:D<0?"default":D>0?"destructive":"secondary",children:[D>=0?"+":"",D.toFixed(1),"%"]})]}),e.jsx(ye,{value:[D],onValueChange:u=>{const p=u[0];_(p),s(a)},max:500,min:-95,step:.1,className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"-95%"}),e.jsx("span",{children:"+500%"})]})]}),e.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"text-sm font-medium text-green-800 flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4"}),"การเปลี่ยนแปลงจะอัพเดตแดชบอร์ดทันที"]}),e.jsx("div",{className:"text-xs text-green-600 mt-1",children:"ลากแถบเลื่อนเพื่อดูผลกระทบต่อตัวเลขในแดชบอร์ด"})]})]})]}),e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(V,{children:"ผลกระทบจากการเปลี่ยนแปลง"}),e.jsx(G,{children:"ดูผลกระทบต่อ KPI สำคัญ"})]}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-blue-900",children:"รายได้/เดือน"}),e.jsx("div",{className:"text-lg font-bold text-blue-600",children:g(18e4*(1+x/100))}),e.jsxs("div",{className:"text-xs text-blue-700",children:[x>=0?"+":"",g(18e4*x/100)]})]}),e.jsxs("div",{className:"p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-green-900",children:"กำไรขั้นต้น"}),e.jsx("div",{className:"text-lg font-bold text-green-600",children:g(6e4+18e4*x/100-4e4*j/100)}),e.jsxs("div",{className:"text-xs text-green-700",children:["เปลี่ยนแปลง ",((x-j*.22)*3).toFixed(1),"%"]})]}),e.jsxs("div",{className:"p-3 bg-orange-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-orange-900",children:"Prime Cost %"}),e.jsxs("div",{className:"text-lg font-bold text-orange-600",children:[(58+j*.2-x*.3).toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-orange-700",children:"ฐาน: 58.0%"})]}),e.jsxs("div",{className:"p-3 bg-purple-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-purple-900",children:"BEP Units/เดือน"}),e.jsx("div",{className:"text-lg font-bold text-purple-600",children:Math.round(2500-x*50+j*30)}),e.jsx("div",{className:"text-xs text-purple-700",children:"ฐาน: 2,500 จาน"})]})]}),e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"สรุปผลกระทบ"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[x>0&&e.jsxs("div",{className:"flex items-center gap-2 text-green-700",children:[e.jsx(xe,{className:"w-3 h-3"}),"ขึ้นราคา ",x,"% จะเพิ่มรายได้ ",g(18e4*x/100)]}),j>0&&e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(Xe,{className:"w-3 h-3"}),"ต้นทุนวัตถุดิบเพิ่ม ",j,"% จะลดกำไร ",g(4e4*j/100)]}),R>0&&e.jsxs("div",{className:"flex items-center gap-2 text-orange-700",children:[e.jsx(Xe,{className:"w-3 h-3"}),"ค่าไฟเพิ่ม ",R,"% จะเพิ่มต้นทุน ",g(5e3*R/100),"/เดือน"]})]})]})]})]})]})}),e.jsx(J,{value:"compare",className:"space-y-4",children:e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(V,{children:"เปรียบเทียบสถานการณ์"}),e.jsx(G,{children:"เลือกสถานการณ์เพื่อเปรียบเทียบผลลัพธ์ทางการเงิน"})]}),e.jsx(L,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsxs(de,{children:[e.jsx(he,{children:e.jsxs(X,{children:[e.jsx($,{children:"เมตริก"}),e.jsx($,{className:"text-right",children:"ฐาน"}),e.jsx($,{className:"text-right",children:"S1"}),e.jsx($,{className:"text-right",children:"เปลี่ยนแปลง"})]})}),e.jsxs(ue,{children:[e.jsxs(X,{children:[e.jsx(C,{children:"รายได้/เดือน"}),e.jsx(C,{className:"text-right",children:g(18e4)}),e.jsx(C,{className:"text-right",children:g(189e3)}),e.jsxs(C,{className:"text-right text-green-600",children:["+",g(9e3)]})]}),e.jsxs(X,{children:[e.jsx(C,{children:"กำไรขั้นต้น"}),e.jsx(C,{className:"text-right",children:g(6e4)}),e.jsx(C,{className:"text-right",children:g(65e3)}),e.jsxs(C,{className:"text-right text-green-600",children:["+",g(5e3)]})]}),e.jsxs(X,{children:[e.jsx(C,{children:"Prime Cost %"}),e.jsx(C,{className:"text-right",children:"58.0%"}),e.jsx(C,{className:"text-right",children:"56.0%"}),e.jsx(C,{className:"text-right text-green-600",children:"-2.0%"})]}),e.jsxs(X,{children:[e.jsx(C,{children:"BEP Units"}),e.jsx(C,{className:"text-right",children:"2,500"}),e.jsx(C,{className:"text-right",children:"2,300"}),e.jsx(C,{className:"text-right text-green-600",children:"-200"})]})]})]})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-4",children:"เปรียบเทียบรายได้และกำไร"}),e.jsx(Qe,{width:"100%",height:300,children:e.jsxs(Ta,{data:d,children:[e.jsx(os,{strokeDasharray:"3 3"}),e.jsx(cs,{dataKey:"scenario"}),e.jsx(ds,{tickFormatter:u=>g(u)}),e.jsx(Ye,{formatter:u=>g(u)}),e.jsx(ks,{dataKey:"revenue",fill:"#8884d8",name:"รายได้"}),e.jsx(ks,{dataKey:"profit",fill:"#82ca9d",name:"กำไร"})]})})]})]})})]})}),e.jsx(J,{value:"sensitivity",className:"space-y-4",children:e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(V,{children:"การวิเคราะห์ความไว (Sensitivity Analysis)"}),e.jsx(G,{children:"ดูผลกระทบของการเปลี่ยนแปลงตัวแปรหนึ่งต่อกำไร"})]}),e.jsx(L,{children:e.jsx(Qe,{width:"100%",height:400,children:e.jsxs(ft,{data:v,children:[e.jsx(os,{strokeDasharray:"3 3"}),e.jsx(cs,{dataKey:"change",tickFormatter:u=>`${u}%`}),e.jsx(ds,{tickFormatter:u=>`${u}%`}),e.jsx(Ye,{formatter:u=>[`${u}%`,"ผลกระทบต่อกำไร"],labelFormatter:u=>`การเปลี่ยนแปลง: ${u}%`}),e.jsx(hs,{type:"monotone",dataKey:"impact",stroke:"#8884d8",strokeWidth:3,dot:{fill:"#8884d8",strokeWidth:2,r:4}})]})})})]})}),e.jsx(J,{value:"quick",className:"space-y-4",children:e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(V,{children:"Quick Scenarios"}),e.jsx(G,{children:"ใช้สถานการณ์ที่เตรียมไว้เพื่อการทดสอบเร็ว"})]}),e.jsx(L,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:y.map((u,p)=>e.jsxs(E,{className:"p-4 cursor-pointer hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h4",{className:"font-medium",children:u.name}),e.jsxs(U,{size:"sm",variant:"outline",children:[e.jsx(za,{className:"w-3 h-3 mr-1"}),"ใช้"]})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:Object.entries(u.deltas).map(([P,k])=>e.jsxs("div",{children:[P.includes("Price")&&"ราคา",P.includes("Cost")&&"ต้นทุน",P.includes("Rate")&&"อัตรา",P.includes("Waste")&&"การเสียหาย",P.includes("Productivity")&&"ประสิทธิภาพ",": ",k>=0?"+":"",k,"%"]},P))})]},p))})})]})})]})]})}function on({financialData:a}){const{exportFreshData:s}=le(),[t,r]=m.useState("monthly"),[i,n]=m.useState(!1),[l,c]=m.useState(""),h=async(y,b=3)=>{let o=0;const d=b+1;for(;o<d;){o++;try{c(`กำลังเตรียมข้อมูลล่าสุด... (${o}/${d})`),console.log(`[Reports] Export attempt ${o}/${d} for type: ${y}`);const v=await s(),u=JSON.parse(v);if(!u.computationResult)throw new Error("ไม่พบผลการคำนวณ ระบบอาจกำลังประมวลผลอยู่");return c("กำลังสร้างไฟล์..."),console.log(`[Reports] Fresh data validated successfully for ${y} export`),{freshData:u,computationResult:u.computationResult,exportInfo:{timestamp:u.exportTimestamp,version:u.dataVersion,type:y,attempt:o}}}catch(v){const u=v instanceof Error?v.message:"ข้อผิดพลาดที่ไม่ทราบสาเหตุ";if(console.error(`Export attempt ${o}/${d} failed:`,u),o===d)throw new Error(`การส่งออกล้มเหลวหลังจากพยายาม ${d} ครั้ง: ${u}`);const p=Math.min(1e3*Math.pow(2,o-1),3e3);c(`เกิดข้อผิดพลาด กำลังลองใหม่ในอีก ${Math.ceil(p/1e3)} วินาที...`),await new Promise(P=>setTimeout(P,p))}}throw new Error("การส่งออกล้มเหลวโดยไม่ทราบสาเหตุ")};if(!a)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(vt,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{children:"กำลังโหลดข้อมูลรายงาน..."})]})});const x=a?.kpis||{},f=a?.pnl||{daily:{},monthly:{}},j=a?.menus||[],S=async()=>{n(!0),c("กำลังเริ่มต้น...");try{const y=await h("pnl"),b=y.computationResult?.pnl||{daily:{},monthly:{}};c("กำลังสร้าง P&L...");const o=[{period:"รายวัน",revenue:b.daily?.revenue||0,cogs:b.daily?.cogs||0,grossProfit:b.daily?.grossProfit||0,operatingExpenses:b.daily?.operatingExpenses||0,operatingProfit:b.daily?.operatingProfit||0},{period:"รายเดือน",revenue:b.monthly?.revenue||0,cogs:b.monthly?.cogs||0,grossProfit:b.monthly?.grossProfit||0,operatingExpenses:b.monthly?.operatingExpenses||0,operatingProfit:b.monthly?.operatingProfit||0}],d=`pnl-${new Date().toISOString().split("T")[0]}.csv`;c("กำลังดาวน์โหลด..."),Hs(o,d),console.log(`[Reports] Real-time P&L export completed at ${y.exportInfo.timestamp}`),c("เสร็จสิ้น!")}catch(y){console.error("Real-time P&L export failed:",y);const b=y instanceof Error?y.message:"ไม่สามารถส่งออก P&L ได้";alert(`ข้อผิดพลาด: ${b}`),c("")}finally{setTimeout(()=>{n(!1),c("")},1e3)}},R=async()=>{n(!0),c("กำลังเริ่มต้น...");try{const y=await h("menu"),b=y.computationResult?.menus||[];c("กำลังสร้างการวิเคราะห์เมนู...");const o=b.map(v=>({menuName:v?.name||"Unknown",price:v?.price||0,variableCost:v?.vc||0,contributionMargin:v?.cm||0,contributionMarginPercent:v?.cmPct||0})),d=`menu-analysis-${new Date().toISOString().split("T")[0]}.csv`;c("กำลังดาวน์โหลด..."),Hs(o,d),console.log(`[Reports] Real-time menu analysis export completed at ${y.exportInfo.timestamp}`),c("เสร็จสิ้น!")}catch(y){console.error("Real-time menu analysis export failed:",y);const b=y instanceof Error?y.message:"ไม่สามารถส่งออกการวิเคราะห์เมนูได้";alert(`ข้อผิดพลาด: ${b}`),c("")}finally{setTimeout(()=>{n(!1),c("")},1e3)}},T=()=>{window.print()},w=async()=>{n(!0),c("กำลังเริ่มต้น...");try{const y=await h("comprehensive");if(!y||!y.computationResult)throw new Error("ไม่พบผลการคำนวณ กรุณาตรวจสอบข้อมูลในระบบ");const b=y.computationResult?.kpis||{},o=y.computationResult?.pnl||{daily:{},monthly:{}},d=y.computationResult?.menus||[];(!o.daily||!o.monthly)&&(console.warn("[Reports] P&L data incomplete, using empty structure"),o.daily=o.daily||{},o.monthly=o.monthly||{});const v=new Date().toISOString().split("T")[0];c("กำลังสร้างรายงานครบถ้วน..."),console.log("[Reports] Export data validated successfully:",{hasKpis:!!b,hasPnL:!!o,hasMenus:Array.isArray(d),menuCount:d.length});const u={grossMargin:o.daily?.grossProfit&&o.daily?.revenue?o.daily.grossProfit/o.daily.revenue*100:0,operatingMargin:o.daily?.operatingProfit&&o.daily?.revenue?o.daily.operatingProfit/o.daily.revenue*100:0,contributionMargin:b?.cmPct||0},p=[{category:"ต้นทุนขาย (COGS)",amount:o.daily?.cogs||0,percentage:o.daily?.cogs&&o.daily?.revenue?o.daily.cogs/o.daily.revenue*100:0},{category:"ค่าใช้จ่ายดำเนินงาน",amount:o.daily?.operatingExpenses||0,percentage:o.daily?.operatingExpenses&&o.daily?.revenue?o.daily.operatingExpenses/o.daily.revenue*100:0}],Q="\uFEFF"+[["หัวข้อ","ค่า","หน่วย/หมายเหตุ"],[""],["=== สรุปผลรวม ==="],["รายได้รายวัน",g(b?.revenue||0),"บาท"],["กำไรขั้นต้น",g(b?.grossProfit||0),"บาท"],["กำไรจากการดำเนินงาน",g(b?.operatingProfit||0),"บาท"],["เปอร์เซ็นต์ต้นทุนหลัก",W(b?.primeCostPct||0),"%"],["เปอร์เซ็นต์ต้นทุนอาหาร",W(b?.foodCostPct||0),"%"],["เปอร์เซ็นต์ค่าแรงงาน",W(b?.laborPct||0),"%"],["จุดคุ้มทุนต่อวัน",`${Math.round(b?.bepPerDay||0)} จาน`,"จาน"],["อัตราส่วนความปลอดภัย",W(b?.safetyMargin||0),"%"],[""],["=== อัตรากำไร ==="],["อัตรากำไรขั้นต้น",W(u.grossMargin),"%"],["อัตรากำไรจากการดำเนินงาน",W(u.operatingMargin),"%"],["อัตรากำไรส่วนเพิ่ม",W(u.contributionMargin),"%"],[""],["=== โครงสร้างต้นทุน ==="],...p.map(B=>[B.category,g(B.amount),`${W(B.percentage)} ของรายได้`]),[""],["=== งบกำไรขาดทุน (P&L) ==="],["รายการ","รายวัน","รายเดือน","เปอร์เซ็นต์ของรายได้"],["รายได้",g(o.daily?.revenue||0),g(o.monthly?.revenue||0),"100.0%"],["ต้นทุนขาย",`(${g(o.daily?.cogs||0)})`,`(${g(o.monthly?.cogs||0)})`,`(${W(o.daily?.cogs&&o.daily?.revenue?o.daily.cogs/o.daily.revenue*100:0)})`],["กำไรขั้นต้น",g(o.daily?.grossProfit||0),g(o.monthly?.grossProfit||0),W(o.daily?.grossProfit&&o.daily?.revenue?o.daily.grossProfit/o.daily.revenue*100:0)],["ค่าใช้จ่ายดำเนินงาน",`(${g(o.daily?.operatingExpenses||0)})`,`(${g(o.monthly?.operatingExpenses||0)})`,`(${W(o.daily?.operatingExpenses&&o.daily?.revenue?o.daily.operatingExpenses/o.daily.revenue*100:0)})`],["กำไรจากการดำเนินงาน",g(o.daily?.operatingProfit||0),g(o.monthly?.operatingProfit||0),W(o.daily?.operatingProfit&&o.daily?.revenue?o.daily.operatingProfit/o.daily.revenue*100:0)],[""],["=== การวิเคราะห์เมนู ==="],["ชื่อเมนู","ราคาขาย","ต้นทุนผันแปร","กำไรส่วนเพิ่ม","เปอร์เซ็นต์กำไรส่วนเพิ่ม"],...d.map(B=>[B?.name||"Unknown",g(B?.price||0),g(B?.vc||0),g(B?.cm||0),W(B?.cmPct||0)])].map(B=>B.map(Z=>{const te=String(Z||"");return te.includes(",")||te.includes('"')||te.includes(`
`)?`"${te.replace(/"/g,'""')}"`:te}).join(",")).join(`\r
`),ee=new Blob([Q],{type:"text/csv;charset=utf-8;"}),N=URL.createObjectURL(ee),A=document.createElement("a");A.href=N,A.download=`financial_report_${v}.csv`,document.body.appendChild(A),A.click(),document.body.removeChild(A),URL.revokeObjectURL(N),console.log(`[Reports] Real-time comprehensive export completed at ${y.exportInfo.timestamp}`),c("เสร็จสิ้น!")}catch(y){console.error("Real-time comprehensive export failed:",y);const b=y instanceof Error?y.message:"ไม่สามารถส่งออกรายงานครบถ้วนได้";alert(`ข้อผิดพลาด: ${b}`),c("")}finally{setTimeout(()=>{n(!1),c("")},1e3)}},M={grossMargin:f.daily.grossProfit/f.daily.revenue*100,operatingMargin:f.daily.operatingProfit/f.daily.revenue*100,contributionMargin:x.cmPct},D=[{category:"ต้นทุนขาย (COGS)",amount:f.daily.cogs,percentage:f.daily.cogs/f.daily.revenue*100},{category:"ค่าใช้จ่ายดำเนินงาน",amount:f.daily.operatingExpenses,percentage:f.daily.operatingExpenses/f.daily.revenue*100}],_=[{metric:"รายได้รายวัน",value:g(x.revenue),status:"good"},{metric:"กำไรขั้นต้น",value:g(x.grossProfit),status:"good"},{metric:"กำไรจากการดำเนินงาน",value:g(x.operatingProfit),status:x.operatingProfit>0?"good":"warning"},{metric:"Prime Cost %",value:W(x.primeCostPct),status:x.primeCostPct<60?"good":"warning"},{metric:"Food Cost %",value:W(x.foodCostPct),status:x.foodCostPct<35?"good":"warning"},{metric:"Labor %",value:W(x.laborPct),status:x.laborPct<25?"good":"warning"},{metric:"จุดคุ้มทุน/วัน",value:`${Math.round(x.bepPerDay)} จาน`,status:x.bepPerDay<100?"good":"warning"},{metric:"Safety Margin",value:W(x.safetyMargin),status:x.safetyMargin>30?"good":"warning"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"รายงานการเงิน"}),e.jsx("p",{className:"text-muted-foreground",children:"สรุปผลการดำเนินงานและการส่งออกข้อมูล"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(U,{variant:"outline",onClick:T,children:[e.jsx(Ba,{className:"w-4 h-4 mr-2"}),"พิมพ์"]}),e.jsxs(U,{variant:"outline",onClick:w,disabled:i,children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),i?l||"กำลังส่งออก...":"Export"]})]})]}),e.jsxs(we,{defaultValue:"summary",className:"space-y-4",children:[e.jsxs(Pe,{children:[e.jsx(q,{value:"summary",children:"สรุปผลการดำเนินงาน"}),e.jsx(q,{value:"pnl",children:"งบกำไรขาดทุน"}),e.jsx(q,{value:"menu",children:"วิเคราะห์เมนู"})]}),e.jsxs(J,{value:"summary",className:"space-y-6",children:[e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(ss,{className:"w-5 h-5"}),"สรุปผู้บริหาร"]}),e.jsxs(G,{children:["ตัวชี้วัดสำคัญและผลการดำเนินงาน ณ วันที่ ",new Date().toLocaleDateString("th-TH")]})]}),e.jsx(L,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:_.map((y,b)=>e.jsxs("div",{className:"p-3 bg-muted rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:y.metric}),e.jsx("div",{className:"text-lg font-bold mt-1",children:y.value}),e.jsx(se,{variant:y.status==="good"?"default":"secondary",className:"text-xs mt-1",children:y.status==="good"?"ดี":"ต้องปรับปรุง"})]},b))})})]}),e.jsxs(E,{children:[e.jsx(I,{children:e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5"}),"วิเคราะห์ความสามารถในการทำกำไร"]})}),e.jsx(L,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-green-900",children:"Gross Profit Margin"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:W(M.grossMargin)}),e.jsx("div",{className:"text-xs text-green-700",children:"อุตสาหกรรมเฉลี่ย: 65-75%"})]}),e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-blue-900",children:"Operating Profit Margin"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:W(M.operatingMargin)}),e.jsxs("div",{className:"text-xs text-blue-700",children:["เป้าหมาย: ",">"," 15%"]})]}),e.jsxs("div",{className:"p-4 bg-orange-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-orange-900",children:"Contribution Margin"}),e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:W(M.contributionMargin)}),e.jsxs("div",{className:"text-xs text-orange-700",children:["เป้าหมาย: ",">"," 60%"]})]})]})})]}),e.jsxs(E,{children:[e.jsx(I,{children:e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(Ka,{className:"w-5 h-5"}),"โครงสร้างต้นทุน"]})}),e.jsx(L,{children:e.jsxs(de,{children:[e.jsx(he,{children:e.jsxs(X,{children:[e.jsx($,{children:"หมวดหมู่"}),e.jsx($,{className:"text-right",children:"จำนวน (รายวัน)"}),e.jsx($,{className:"text-right",children:"ร้อยละของรายได้"}),e.jsx($,{className:"text-right",children:"สถานะ"})]})}),e.jsx(ue,{children:D.map((y,b)=>e.jsxs(X,{children:[e.jsx(C,{className:"font-medium",children:y.category}),e.jsx(C,{className:"text-right",children:g(y.amount)}),e.jsx(C,{className:"text-right",children:W(y.percentage)}),e.jsx(C,{className:"text-right",children:e.jsx(se,{variant:y.percentage<50?"default":"secondary",children:y.percentage<50?"เหมาะสม":"ต้องตรวจสอบ"})})]},b))})]})})]})]}),e.jsx(J,{value:"pnl",className:"space-y-4",children:e.jsxs(E,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(V,{children:"งบกำไรขาดทุน (P&L Statement)"}),e.jsx(G,{children:"แสดงผลการดำเนินงานทางการเงินรายวันและรายเดือน"})]}),e.jsxs(U,{onClick:S,disabled:i,children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),i?l||"กำลังส่งออก...":"Export P&L"]})]})}),e.jsx(L,{children:e.jsxs(de,{children:[e.jsx(he,{children:e.jsxs(X,{children:[e.jsx($,{children:"รายการ"}),e.jsx($,{className:"text-right",children:"รายวัน"}),e.jsx($,{className:"text-right",children:"รายเดือน"}),e.jsx($,{className:"text-right",children:"% ของรายได้"})]})}),e.jsxs(ue,{children:[e.jsxs(X,{className:"font-medium",children:[e.jsx(C,{children:"รายได้"}),e.jsx(C,{className:"text-right",children:g(f.daily.revenue)}),e.jsx(C,{className:"text-right",children:g(f.monthly.revenue)}),e.jsx(C,{className:"text-right",children:"100.0%"})]}),e.jsxs(X,{children:[e.jsx(C,{className:"pl-4",children:"ต้นทุนขาย (COGS)"}),e.jsxs(C,{className:"text-right",children:["(",g(f.daily.cogs),")"]}),e.jsxs(C,{className:"text-right",children:["(",g(f.monthly.cogs),")"]}),e.jsxs(C,{className:"text-right",children:["(",W(f.daily.cogs/f.daily.revenue*100),")"]})]}),e.jsxs(X,{className:"font-medium border-t",children:[e.jsx(C,{children:"กำไรขั้นต้น"}),e.jsx(C,{className:"text-right",children:g(f.daily.grossProfit)}),e.jsx(C,{className:"text-right",children:g(f.monthly.grossProfit)}),e.jsx(C,{className:"text-right",children:W(f.daily.grossProfit/f.daily.revenue*100)})]}),e.jsxs(X,{children:[e.jsx(C,{className:"pl-4",children:"ค่าใช้จ่ายดำเนินงาน"}),e.jsxs(C,{className:"text-right",children:["(",g(f.daily.operatingExpenses),")"]}),e.jsxs(C,{className:"text-right",children:["(",g(f.monthly.operatingExpenses),")"]}),e.jsxs(C,{className:"text-right",children:["(",W(f.daily.operatingExpenses/f.daily.revenue*100),")"]})]}),e.jsxs(X,{className:"font-bold border-t",children:[e.jsx(C,{children:"กำไรจากการดำเนินงาน"}),e.jsx(C,{className:"text-right",children:g(f.daily.operatingProfit)}),e.jsx(C,{className:"text-right",children:g(f.monthly.operatingProfit)}),e.jsx(C,{className:"text-right",children:W(f.daily.operatingProfit/f.daily.revenue*100)})]})]})]})})]})}),e.jsx(J,{value:"menu",className:"space-y-4",children:e.jsxs(E,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(V,{children:"วิเคราะห์ผลตอบแทนรายเมนู"}),e.jsx(G,{children:"Unit Economics และ Contribution Margin ของแต่ละรายการอาหาร"})]}),e.jsxs(U,{onClick:R,disabled:i,children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),i?l||"กำลังส่งออก...":"Export Menu Analysis"]})]})}),e.jsxs(L,{children:[e.jsxs(de,{children:[e.jsx(he,{children:e.jsxs(X,{children:[e.jsx($,{children:"เมนู"}),e.jsx($,{className:"text-right",children:"ราคาขาย"}),e.jsx($,{className:"text-right",children:"ต้นทุนผันแปร"}),e.jsx($,{className:"text-right",children:"Contribution Margin"}),e.jsx($,{className:"text-right",children:"CM %"}),e.jsx($,{className:"text-right",children:"การประเมิน"})]})}),e.jsx(ue,{children:j.map((y,b)=>e.jsxs(X,{children:[e.jsx(C,{className:"font-medium",children:y.name}),e.jsx(C,{className:"text-right",children:g(y.price)}),e.jsx(C,{className:"text-right",children:g(y.vc)}),e.jsx(C,{className:"text-right",children:g(y.cm)}),e.jsx(C,{className:"text-right",children:e.jsx(se,{variant:y.cmPct>60?"default":y.cmPct>40?"secondary":"destructive",children:W(y.cmPct)})}),e.jsx(C,{className:"text-right",children:y.cmPct>60?"⭐ ดีเยี่ยม":y.cmPct>40?"✅ ปานกลาง":"⚠️ ต้องปรับปรุง"})]},b))})]}),e.jsxs("div",{className:"mt-6 p-4 bg-muted rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"ข้อเสนะแนะการปรับปรุงเมนู"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[j.some(y=>y.cmPct<40)&&e.jsx("div",{className:"text-orange-700",children:"• เมนูที่มี CM % ต่ำกว่า 40% ควรทบทวนราคาขายหรือลดต้นทุนวัตถุดิบ"}),j.some(y=>y.cmPct>70)&&e.jsx("div",{className:"text-green-700",children:"• เมนูที่มี CM % สูงกว่า 70% สามารถใช้เป็นจุดแข็งในการขาย"}),e.jsx("div",{className:"text-blue-700",children:"• เป้าหมาย CM % เฉลี่ย: 60-65% สำหรับร้านอาหารประเภทนี้"})]})]})]})]})})]})]})}var as="Switch",[cn]=ws(as),[dn,hn]=cn(as),Bt=m.forwardRef((a,s)=>{const{__scopeSwitch:t,name:r,checked:i,defaultChecked:n,required:l,disabled:c,value:h="on",onCheckedChange:x,form:f,...j}=a,[S,R]=m.useState(null),T=ie(s,y=>R(y)),w=m.useRef(!1),M=S?f||!!S.closest("form"):!0,[D,_]=nt({prop:i,defaultProp:n??!1,onChange:x,caller:as});return e.jsxs(dn,{scope:t,checked:D,disabled:c,children:[e.jsx(je.button,{type:"button",role:"switch","aria-checked":D,"aria-required":l,"data-state":Wt(D),"data-disabled":c?"":void 0,disabled:c,value:h,...j,ref:T,onClick:fe(a.onClick,y=>{_(b=>!b),M&&(w.current=y.isPropagationStopped(),w.current||y.stopPropagation())})}),M&&e.jsx(Ht,{control:S,bubbles:!w.current,name:r,value:h,checked:D,required:l,disabled:c,form:f,style:{transform:"translateX(-100%)"}})]})});Bt.displayName=as;var Kt="SwitchThumb",Gt=m.forwardRef((a,s)=>{const{__scopeSwitch:t,...r}=a,i=hn(Kt,t);return e.jsx(je.span,{"data-state":Wt(i.checked),"data-disabled":i.disabled?"":void 0,...r,ref:s})});Gt.displayName=Kt;var un="SwitchBubbleInput",Ht=m.forwardRef(({__scopeSwitch:a,control:s,checked:t,bubbles:r=!0,...i},n)=>{const l=m.useRef(null),c=ie(l,n),h=ot(t),x=lt(s);return m.useEffect(()=>{const f=l.current;if(!f)return;const j=window.HTMLInputElement.prototype,R=Object.getOwnPropertyDescriptor(j,"checked").set;if(h!==t&&R){const T=new Event("click",{bubbles:r});R.call(f,t),f.dispatchEvent(T)}},[h,t,r]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:t,...i,tabIndex:-1,ref:c,style:{...i.style,...x,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Ht.displayName=un;function Wt(a){return a?"checked":"unchecked"}var xn=Bt,mn=Gt;function Le({className:a,...s}){return e.jsx(xn,{"data-slot":"switch",className:z("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-switch-background focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",a),...s,children:e.jsx(mn,{"data-slot":"switch-thumb",className:z("bg-card dark:data-[state=unchecked]:bg-card-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}var qt="AlertDialog",[pn]=ws(qt,[gt]),me=gt(),Jt=a=>{const{__scopeAlertDialog:s,...t}=a,r=me(s);return e.jsx(pt,{...r,...t,modal:!0})};Jt.displayName=qt;var gn="AlertDialogTrigger",Qt=m.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...r}=a,i=me(t);return e.jsx(ct,{...i,...r,ref:s})});Qt.displayName=gn;var fn="AlertDialogPortal",Yt=a=>{const{__scopeAlertDialog:s,...t}=a,r=me(s);return e.jsx(mt,{...r,...t})};Yt.displayName=fn;var jn="AlertDialogOverlay",Xt=m.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...r}=a,i=me(t);return e.jsx(dt,{...i,...r,ref:s})});Xt.displayName=jn;var De="AlertDialogContent",[vn,yn]=pn(De),bn=Ea("AlertDialogContent"),Zt=m.forwardRef((a,s)=>{const{__scopeAlertDialog:t,children:r,...i}=a,n=me(t),l=m.useRef(null),c=ie(s,l),h=m.useRef(null);return e.jsx(Da,{contentName:De,titleName:ea,docsSlug:"alert-dialog",children:e.jsx(vn,{scope:t,cancelRef:h,children:e.jsxs(ht,{role:"alertdialog",...n,...i,ref:c,onOpenAutoFocus:fe(i.onOpenAutoFocus,x=>{x.preventDefault(),h.current?.focus({preventScroll:!0})}),onPointerDownOutside:x=>x.preventDefault(),onInteractOutside:x=>x.preventDefault(),children:[e.jsx(bn,{children:r}),e.jsx(wn,{contentRef:l})]})})})});Zt.displayName=De;var ea="AlertDialogTitle",sa=m.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...r}=a,i=me(t);return e.jsx(ut,{...i,...r,ref:s})});sa.displayName=ea;var ta="AlertDialogDescription",aa=m.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...r}=a,i=me(t);return e.jsx(xt,{...i,...r,ref:s})});aa.displayName=ta;var Nn="AlertDialogAction",ra=m.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...r}=a,i=me(t);return e.jsx(es,{...i,...r,ref:s})});ra.displayName=Nn;var na="AlertDialogCancel",ia=m.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...r}=a,{cancelRef:i}=yn(na,t),n=me(t),l=ie(s,i);return e.jsx(es,{...n,...r,ref:l})});ia.displayName=na;var wn=({contentRef:a})=>{const s=`\`${De}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${De}\` by passing a \`${ta}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${De}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return m.useEffect(()=>{document.getElementById(a.current?.getAttribute("aria-describedby"))||console.warn(s)},[s,a]),null},Pn=Jt,Sn=Qt,Cn=Yt,Dn=Xt,En=Zt,Mn=ra,An=ia,kn=sa,Rn=aa;function qs({...a}){return e.jsx(Pn,{"data-slot":"alert-dialog",...a})}function Js({...a}){return e.jsx(Sn,{"data-slot":"alert-dialog-trigger",...a})}function Tn({...a}){return e.jsx(Cn,{"data-slot":"alert-dialog-portal",...a})}function On({className:a,...s}){return e.jsx(Dn,{"data-slot":"alert-dialog-overlay",className:z("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",a),...s})}function Qs({className:a,...s}){return e.jsxs(Tn,{children:[e.jsx(On,{}),e.jsx(En,{"data-slot":"alert-dialog-content",className:z("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",a),...s})]})}function Ys({className:a,...s}){return e.jsx("div",{"data-slot":"alert-dialog-header",className:z("flex flex-col gap-2 text-center sm:text-left",a),...s})}function Xs({className:a,...s}){return e.jsx("div",{"data-slot":"alert-dialog-footer",className:z("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",a),...s})}function Zs({className:a,...s}){return e.jsx(kn,{"data-slot":"alert-dialog-title",className:z("text-lg font-semibold",a),...s})}function et({className:a,...s}){return e.jsx(Rn,{"data-slot":"alert-dialog-description",className:z("text-muted-foreground text-sm",a),...s})}function st({className:a,...s}){return e.jsx(Mn,{className:z(Es(),a),...s})}function tt({className:a,...s}){return e.jsx(An,{className:z(Es({variant:"outline"}),a),...s})}function Fn(){const{data:a,reset:s,exportData:t,importData:r}=le(),[i,n]=m.useState(()=>a?.meta||{}),[l,c]=m.useState("th"),[h,x]=m.useState("THB"),[f,j]=m.useState(7),[S,R]=m.useState(!0);m.useEffect(()=>{a?.meta&&(n(a.meta),x(a.meta.currency||"THB"),j(a.meta.vatPercent||7))},[a]);const T=()=>{const P={...i,currency:h,vatPercent:f,language:l};n(P),alert("บันทึกการตั้งค่าเรียบร้อย")},w=()=>{localStorage.clear(),alert("ข้อมูลทั้งหมดถูกลบแล้ว กรุณาโหลดหน้าใหม่"),window.location.reload()},M=()=>{s(),alert("รีเซ็ตการตั้งค่าเรียบร้อย")},[D,_]=m.useState("idle"),[y,b]=m.useState("idle"),[o,d]=m.useState(""),v=()=>{try{_("loading"),d("");const P=t();if(!P||P.trim()==="")throw new Error("ไม่มีข้อมูลที่จะส่งออก");const O="\uFEFF"+P,Q=new Blob([O],{type:"application/json;charset=utf-8;"}),ee=URL.createObjectURL(Q),N=document.createElement("a");N.href=ee,N.download=`finance-data-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(N),N.click(),document.body.removeChild(N),URL.revokeObjectURL(ee),_("success"),setTimeout(()=>_("idle"),3e3)}catch(P){console.error("Export failed:",P);const k=P instanceof Error?P.message:"เกิดข้อผิดพลาดในการส่งออกข้อมูล";d(k),_("error"),setTimeout(()=>_("idle"),5e3)}},u=P=>{const k=P.target.files?.[0];if(!k)return;if(b("loading"),d(""),!k.name.toLowerCase().endsWith(".json")){d("กรุณาเลือกไฟล์ .json เท่านั้น"),b("error"),setTimeout(()=>b("idle"),5e3);return}if(k.size>10*1024*1024){d("ไฟล์มีขนาดใหญ่เกินไป (สูงสุด 10MB)"),b("error"),setTimeout(()=>b("idle"),5e3);return}const O=new FileReader;O.onload=Q=>{try{const N=(Q.target?.result).replace(/^\uFEFF/,"");try{JSON.parse(N)}catch{throw new Error("ไฟล์ JSON ไม่ถูกต้อง")}const A=r(N);if(A.success)b("success"),setTimeout(()=>{b("idle"),window.location.reload()},2e3);else throw new Error(A.error||"เกิดข้อผิดพลาดในการนำเข้าข้อมูล")}catch(ee){console.error("Import failed:",ee);const N=ee instanceof Error?ee.message:"เกิดข้อผิดพลาดในการนำเข้าข้อมูล";d(N),b("error"),setTimeout(()=>b("idle"),5e3)}},O.onerror=()=>{d("ไม่สามารถอ่านไฟล์ได้"),b("error"),setTimeout(()=>b("idle"),5e3)},O.readAsText(k,"utf-8"),P.target.value=""},p=[{name:"ค่าไฟฟ้าต่อหน่วย",value:"5.00 บาท/kWh",description:"อัตราเฉลี่ยสำหรับธุรกิจขนาดเล็ก"},{name:"ค่าแก๊ส LPG",value:"29.33 บาท/กก.",description:"ราคาถังแก๊ส 15 กก. ประมาณ 440 บาท"},{name:"ค่าน้ำประปา",value:"14.00 บาท/ลบ.ม.",description:"อัตราเฉลี่ยกรุงเทพและปริมณฑล"},{name:"ค่าจ้างขั้นต่ำ",value:"354 บาท/วัน",description:"ปี 2024 (อ้างอิงเท่านั้น)"},{name:"Prime Cost เป้าหมาย",value:"< 60%",description:"มาตรฐานอุตสาหกรรมอาหาร"},{name:"Food Cost เป้าหมาย",value:"< 35%",description:"เฉพาะต้นทุนวัตถุดิบ"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"การตั้งค่าระบบ"}),e.jsx("p",{className:"text-muted-foreground",children:"จัดการการตั้งค่าทั่วไปและความเป็นส่วนตัว"})]}),e.jsxs(U,{onClick:T,children:[e.jsx(yt,{className:"w-4 h-4 mr-2"}),"บันทึกการตั้งค่า"]})]}),e.jsxs(we,{defaultValue:"general",className:"space-y-4",children:[e.jsxs(Pe,{children:[e.jsx(q,{value:"general",children:"ทั่วไป"}),e.jsx(q,{value:"finance",children:"การเงิน"}),e.jsx(q,{value:"privacy",children:"ความเป็นส่วนตัว"}),e.jsx(q,{value:"defaults",children:"ค่าเริ่มต้น"}),e.jsx(q,{value:"help",children:"ความช่วยเหลือ"})]}),e.jsxs(J,{value:"general",className:"space-y-4",children:[e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(Ga,{className:"w-5 h-5"}),"การตั้งค่าทั่วไป"]}),e.jsx(G,{children:"ภาษา สกุลเงิน และรูปแบบการแสดงผล"})]}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"language",children:"ภาษา"}),e.jsxs(ze,{value:l,onValueChange:c,children:[e.jsx(Ke,{children:e.jsx(Be,{})}),e.jsxs(Ge,{children:[e.jsx(re,{value:"th",children:"ไทย"}),e.jsx(re,{value:"en",children:"English"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"currency",children:"สกุลเงิน"}),e.jsxs(ze,{value:h,onValueChange:x,children:[e.jsx(Ke,{children:e.jsx(Be,{})}),e.jsxs(Ge,{children:[e.jsx(re,{value:"THB",children:"บาทไทย (THB)"}),e.jsx(re,{value:"USD",children:"ดอลลาร์สหรัฐ (USD)"}),e.jsx(re,{value:"EUR",children:"ยูโร (EUR)"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"vat",children:"อัตราภาษีมูลค่าเพิ่ม (%)"}),e.jsx(H,{id:"vat",type:"number",step:"0.1",value:f,onChange:P=>j(parseFloat(P.target.value)||0),placeholder:"7"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"อัตรา VAT มาตรฐานในประเทศไทย: 7%"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"decimal",children:"ทศนิยม"}),e.jsxs(ze,{defaultValue:"2",children:[e.jsx(Ke,{children:e.jsx(Be,{})}),e.jsxs(Ge,{children:[e.jsx(re,{value:"0",children:"ไม่มีทศนิยม"}),e.jsx(re,{value:"2",children:"2 ตำแหน่ง"}),e.jsx(re,{value:"4",children:"4 ตำแหน่ง"})]})]})]})]})]})]}),e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(V,{children:"วันและเวลาดำเนินการ"}),e.jsx(G,{children:"กำหนดวันเปิด-ปิดและชั่วโมงทำการ"})]}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"open-time",children:"เวลาเปิด"}),e.jsx(H,{id:"open-time",type:"time",defaultValue:"07:00"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"close-time",children:"เวลาปิด"}),e.jsx(H,{id:"close-time",type:"time",defaultValue:"15:00"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"วันเปิดทำการ"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:["จันทร์","อังคาร","พุธ","พฤหัสบดี","ศุกร์","เสาร์","อาทิตย์"].map((P,k)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Le,{id:`day-${k}`,defaultChecked:k<6}),e.jsx(F,{htmlFor:`day-${k}`,className:"text-sm",children:P})]},P))})]})]})]})]}),e.jsx(J,{value:"finance",className:"space-y-4",children:e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-5 h-5"}),"การตั้งค่าทางการเงิน"]}),e.jsx(G,{children:"กำหนดค่าเริ่มต้นสำหรับการคำนวณทางการเงิน"})]}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"target-profit",children:"เป้าหมายกำไร/เดือน (บาท)"}),e.jsx(H,{id:"target-profit",type:"number",placeholder:"50000"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"safety-margin",children:"Safety Margin ขั้นต่ำ (%)"}),e.jsx(H,{id:"safety-margin",type:"number",placeholder:"30"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"max-prime-cost",children:"Prime Cost สูงสุด (%)"}),e.jsx(H,{id:"max-prime-cost",type:"number",defaultValue:"60"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"max-food-cost",children:"Food Cost สูงสุด (%)"}),e.jsx(H,{id:"max-food-cost",type:"number",defaultValue:"35"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(F,{htmlFor:"include-vat",children:"รวม VAT ในราคาขาย"}),e.jsx(Le,{id:"include-vat",defaultChecked:!0})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"เปิดใช้งานหากราคาเมนูในระบบรวม VAT แล้ว"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(F,{htmlFor:"auto-calculate",children:"คำนวณอัตโนมัติ"}),e.jsx(Le,{id:"auto-calculate",defaultChecked:!0})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"คำนวณใหม่ทุกครั้งที่มีการเปลี่ยนแปลงข้อมูล"})]})]})]})}),e.jsxs(J,{value:"privacy",className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Fs,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"font-medium text-blue-900",children:"ข้อมูลของคุณปลอดภัย"})]}),e.jsx("p",{className:"text-sm text-blue-700",children:"ข้อมูลทั้งหมดถูกเก็บไว้ในเครื่องของคุณเท่านั้น ไม่มีการส่งข้อมูลไปยังเซิร์ฟเวอร์ภายนอก"})]}),e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsxs(V,{className:"flex items-center gap-2 text-green-700",children:[e.jsx(Ve,{className:"w-5 h-5"}),"ส่งออกข้อมูล"]}),e.jsx(G,{children:"ดาวน์โหลดข้อมูลทั้งหมดเพื่อสำรองหรือโอนย้าย"})]}),e.jsx(L,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs(U,{onClick:v,disabled:D==="loading",className:"w-full justify-start bg-green-600 hover:bg-green-700",children:[D==="loading"?e.jsx(xs,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Ve,{className:"w-4 h-4 mr-2"}),"ส่งออกข้อมูลทั้งหมด (JSON)"]}),D==="success"&&e.jsxs("div",{className:"flex items-center gap-2 text-green-600 text-sm",children:[e.jsx(ms,{className:"w-4 h-4"}),"ส่งออกข้อมูลเรียบร้อยแล้ว"]}),D==="error"&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(ps,{className:"w-4 h-4"}),o]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ไฟล์จะถูกบันทึกในรูปแบบ JSON พร้อมการเข้ารหัส UTF-8 สำหรับตัวอักษรไทย"})]})})]}),e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsxs(V,{className:"flex items-center gap-2 text-blue-700",children:[e.jsx(_s,{className:"w-5 h-5"}),"นำเข้าข้อมูล"]}),e.jsx(G,{children:"อัพโหลดไฟล์ข้อมูลที่ส่งออกไว้ก่อนหน้า"})]}),e.jsx(L,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",accept:".json",onChange:u,disabled:y==="loading",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer disabled:cursor-not-allowed"}),e.jsxs(U,{variant:"outline",className:"w-full justify-start border-blue-200 hover:bg-blue-50",disabled:y==="loading",children:[y==="loading"?e.jsx(xs,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(_s,{className:"w-4 h-4 mr-2"}),"เลือกไฟล์เพื่อนำเข้า (.json)"]})]}),y==="success"&&e.jsxs("div",{className:"flex items-center gap-2 text-green-600 text-sm",children:[e.jsx(ms,{className:"w-4 h-4"}),"นำเข้าข้อมูลเรียบร้อย กำลังโหลดหน้าใหม่..."]}),y==="error"&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(ps,{className:"w-4 h-4"}),o]}),e.jsxs("div",{className:"space-y-2 text-xs text-muted-foreground",children:[e.jsx("p",{children:"• รองรับเฉพาะไฟล์ .json ที่ส่งออกจากระบบนี้"}),e.jsx("p",{children:"• ขนาดไฟล์สูงสุด 10MB"}),e.jsx("p",{children:"• การนำเข้าจะแทนที่ข้อมูลปัจจุบันทั้งหมด"})]})]})})]}),e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsxs(V,{className:"flex items-center gap-2 text-red-700",children:[e.jsx(ae,{className:"w-5 h-5"}),"รีเซ็ต / ลบข้อมูลทั้งหมด"]}),e.jsx(G,{children:"การดำเนินการที่ไม่สามารถย้อนกลับได้"})]}),e.jsx(L,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs(qs,{children:[e.jsx(Js,{asChild:!0,children:e.jsxs(U,{variant:"outline",className:"w-full justify-start border-orange-200 text-orange-700 hover:bg-orange-50",children:[e.jsx(Us,{className:"w-4 h-4 mr-2"}),"รีเซ็ตการตั้งค่าเป็นค่าเริ่มต้น"]})}),e.jsxs(Qs,{children:[e.jsxs(Ys,{children:[e.jsxs(Zs,{className:"flex items-center gap-2",children:[e.jsx(Us,{className:"w-5 h-5 text-orange-600"}),"รีเซ็ตการตั้งค่า"]}),e.jsxs(et,{children:["การดำเนินการนี้จะรีเซ็ตการตั้งค่าทั้งหมดกลับเป็นค่าเริ่มต้น แต่จะ",e.jsx("strong",{children:"ไม่ลบข้อมูล"}),"เมนู ต้นทุน และสถานการณ์ที่คุณสร้างไว้"]})]}),e.jsxs(Xs,{children:[e.jsx(tt,{children:"ยกเลิก"}),e.jsx(st,{onClick:M,className:"bg-orange-600 hover:bg-orange-700",children:"รีเซ็ตการตั้งค่า"})]})]})]}),e.jsxs(qs,{children:[e.jsx(Js,{asChild:!0,children:e.jsxs(U,{variant:"destructive",className:"w-full justify-start",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"ลบข้อมูลทั้งหมดอย่างถาวร"]})}),e.jsxs(Qs,{children:[e.jsxs(Ys,{children:[e.jsxs(Zs,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-red-600"}),"ลบข้อมูลทั้งหมด"]}),e.jsx(et,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:["⚠️ ",e.jsx("strong",{children:"การดำเนินการนี้จะลบข้อมูลทั้งหมดอย่างถาวร"})]}),e.jsx("p",{children:"ข้อมูลที่จะถูกลบ:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm",children:[e.jsx("li",{children:"เมนูอาหารและราคา"}),e.jsx("li",{children:"ต้นทุนและค่าใช้จ่าย"}),e.jsx("li",{children:"สถานการณ์จำลอง"}),e.jsx("li",{children:"การตั้งค่าทั้งหมด"})]}),e.jsx("p",{className:"text-red-600 font-medium",children:"ไม่สามารถกู้คืนได้!"})]})})]}),e.jsxs(Xs,{children:[e.jsx(tt,{children:"ยกเลิก"}),e.jsx(st,{onClick:w,className:"bg-red-600 hover:bg-red-700",children:"ลบข้อมูลทั้งหมด"})]})]})]}),e.jsx("div",{className:"p-3 bg-amber-50 rounded-lg border border-amber-200",children:e.jsxs("p",{className:"text-xs text-amber-800",children:[e.jsx("strong",{children:"คำแนะนำ:"})," ควรส่งออกข้อมูลเพื่อสำรองก่อนที่จะดำเนินการรีเซ็ตหรือลบ"]})})]})})]}),e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(Fs,{className:"w-5 h-5"}),"การตั้งค่าความเป็นส่วนตัว"]}),e.jsx(G,{children:"จัดการการรักษาความปลอดภัยข้อมูล"})]}),e.jsx(L,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(F,{children:"ยอมรับนโยบายความเป็นส่วนตัว"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ข้อมูลจะถูกเก็บในหน่วยความจำของเบราว์เซอร์เท่านั้น"})]}),e.jsx(Le,{checked:S,onCheckedChange:R})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(F,{children:"เปิดใช้งานการสำรองข้อมูลอัตโนมัติ"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"สำรองข้อมูลลงใน localStorage ทุก 5 นาที"})]}),e.jsx(Le,{defaultChecked:!0})]})]})})]})]}),e.jsx(J,{value:"defaults",className:"space-y-4",children:e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(V,{children:"ค่าเริ่มต้นที่แนะนำ"}),e.jsx(G,{children:"ค่าต่าง ๆ ที่แนะนำสำหรับร้านอาหารขนาดเล็ก (ข้อมูลอ้างอิงเท่านั้น)"})]}),e.jsxs(L,{children:[e.jsx("div",{className:"space-y-4",children:p.map((P,k)=>e.jsxs("div",{className:"flex justify-between items-start p-3 bg-muted rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:P.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:P.description})]}),e.jsx(se,{variant:"outline",children:P.value})]},k))}),e.jsxs("div",{className:"mt-6 p-4 bg-orange-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-orange-900 mb-2",children:"หมายเหตุ"}),e.jsx("p",{className:"text-sm text-orange-700",children:"ค่าดังกล่าวเป็นเพียงข้อมูลอ้างอิงเท่านั้น กรุณาปรับให้เหมาะสมกับสถานการณ์จริงของธุรกิจ"})]})]})]})}),e.jsx(J,{value:"help",className:"space-y-4",children:e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(Ha,{className:"w-5 h-5"}),"ความช่วยเหลือ"]}),e.jsx(G,{children:"คำแนะนำการใช้งานและคำศัพท์ทางการเงิน"})]}),e.jsx(L,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"คำศัพท์สำคัญ"}),e.jsx("div",{className:"space-y-2 text-sm",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-3 bg-muted rounded",children:[e.jsx("div",{className:"font-medium",children:"Prime Cost"}),e.jsx("div",{className:"text-muted-foreground",children:"ต้นทุนวัตถุดิบ + แรงงานโดยตรง"})]}),e.jsxs("div",{className:"p-3 bg-muted rounded",children:[e.jsx("div",{className:"font-medium",children:"Contribution Margin (CM)"}),e.jsx("div",{className:"text-muted-foreground",children:"ราคาขาย - ต้นทุนผันแปร"})]}),e.jsxs("div",{className:"p-3 bg-muted rounded",children:[e.jsx("div",{className:"font-medium",children:"Break-Even Point (BEP)"}),e.jsx("div",{className:"text-muted-foreground",children:"จุดคุ้มทุน (ไม่กำไรไม่ขาดทุน)"})]}),e.jsxs("div",{className:"p-3 bg-muted rounded",children:[e.jsx("div",{className:"font-medium",children:"Safety Margin"}),e.jsx("div",{className:"text-muted-foreground",children:"ระยะห่างจากจุดคุ้มทุน"})]})]})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"เป้าหมายที่แนะนำ"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("div",{children:"• Prime Cost: ไม่เกิน 60% ของรายได้"}),e.jsx("div",{children:"• Food Cost: ไม่เกิน 35% ของรายได้"}),e.jsx("div",{children:"• Labor Cost: ไม่เกิน 25% ของรายได้"}),e.jsx("div",{children:"• Contribution Margin: มากกว่า 60%"}),e.jsx("div",{children:"• Safety Margin: มากกว่า 30%"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"การแก้ไขปัญหา"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("div",{children:"• หาก Prime Cost สูง: ลดต้นทุนวัตถุดิบหรือเพิ่มราคาขาย"}),e.jsx("div",{children:"• หาก Safety Margin ต่ำ: เพิ่มยอดขายหรือลดต้นทุนคงที่"}),e.jsx("div",{children:"• หาก CM % ต่ำ: ทบทวนสูตรอาหารหรือขึ้นราคา"})]})]})]})})]})})]})]})}const _n=Ds("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function bs({className:a,variant:s,...t}){return e.jsx("div",{"data-slot":"alert",role:"alert",className:z(_n({variant:s}),a),...t})}function Ns({className:a,...s}){return e.jsx("div",{"data-slot":"alert-description",className:z("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",a),...s})}class Un extends m.Component{constructor(s){super(s),this.state={hasError:!1,error:null,errorInfo:null,errorId:""}}static getDerivedStateFromError(s){return{hasError:!0,error:s,errorId:`error_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}}componentDidCatch(s,t){console.error("ErrorBoundary caught an error:",s,t),this.setState({error:s,errorInfo:t}),this.props.onError&&this.props.onError(s,t),this.logErrorToService(s,t)}logErrorToService(s,t){try{const r={errorId:this.state.errorId,message:s.message,stack:s.stack,componentStack:t.componentStack,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href};console.error("Error Report:",r)}catch(r){console.error("Failed to log error:",r)}}handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null,errorId:""})};handleReload=()=>{window.location.reload()};handleGoHome=()=>{window.location.href="/"};render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:e.jsxs(E,{className:"w-full max-w-2xl",children:[e.jsxs(I,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-red-100",children:e.jsx(be,{className:"h-6 w-6 text-red-600"})}),e.jsx(V,{className:"text-2xl font-bold text-gray-900",children:"เกิดข้อผิดพลาด"}),e.jsx(G,{className:"text-gray-600",children:"ระบบพบข้อผิดพลาดที่ไม่คาดคิด กรุณาลองใหม่อีกครั้ง"})]}),e.jsxs(L,{className:"space-y-6",children:[e.jsxs(bs,{variant:"destructive",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx(Ns,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium",children:"รายละเอียดข้อผิดพลาด:"}),e.jsx("p",{className:"text-sm",children:this.state.error?.message||"Unknown error"}),!1]})})]}),e.jsxs("div",{className:"text-center text-sm text-gray-500",children:[e.jsxs("p",{children:["Error ID: ",e.jsx("code",{className:"bg-gray-100 px-2 py-1 rounded",children:this.state.errorId})]}),e.jsx("p",{className:"mt-1",children:"กรุณาบันทึก Error ID นี้ไว้สำหรับการติดต่อฝ่ายสนับสนุน"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsxs(U,{onClick:this.handleRetry,className:"flex items-center gap-2",children:[e.jsx($s,{className:"h-4 w-4"}),"ลองใหม่"]}),e.jsxs(U,{variant:"outline",onClick:this.handleReload,className:"flex items-center gap-2",children:[e.jsx($s,{className:"h-4 w-4"}),"โหลดหน้าใหม่"]}),e.jsxs(U,{variant:"outline",onClick:this.handleGoHome,className:"flex items-center gap-2",children:[e.jsx(Ss,{className:"h-4 w-4"}),"กลับหน้าหลัก"]})]}),e.jsxs("div",{className:"text-center text-sm text-gray-600",children:[e.jsx("p",{children:"หากปัญหายังคงเกิดขึ้น กรุณา:"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-left max-w-md mx-auto",children:[e.jsx("li",{children:"• ตรวจสอบการเชื่อมต่ออินเทอร์เน็ต"}),e.jsx("li",{children:"• ล้างข้อมูลเบราว์เซอร์ (Cache & Cookies)"}),e.jsx("li",{children:"• ลองใช้เบราว์เซอร์อื่น"}),e.jsx("li",{children:"• ติดต่อฝ่ายสนับสนุนพร้อม Error ID"})]})]})]})]})}):this.props.children}}const $n={sm:"h-4 w-4",md:"h-6 w-6",lg:"h-8 w-8",xl:"h-12 w-12"},la=({size:a="md",className:s,text:t,fullScreen:r=!1})=>{const i=e.jsx("div",{className:fs("flex items-center justify-center",s),children:e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx(xs,{className:fs("animate-spin text-blue-600",$n[a])}),t&&e.jsx("p",{className:"text-sm text-gray-600 animate-pulse",children:t})]})});return r?e.jsx("div",{className:"fixed inset-0 bg-white bg-opacity-75 flex items-center justify-center z-50",children:i}):i},Ln=({isLoading:a,children:s,text:t="กำลังโหลด...",className:r})=>e.jsxs("div",{className:fs("relative",r),children:[s,a&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center z-10",children:e.jsx(la,{text:t,size:"lg"})})]}),at=({validationResults:a,onDismiss:s,className:t,showWarnings:r=!0,compact:i=!1})=>{if(!a||a.length===0)return null;const n=a.some(x=>!x.isValid),l=a.some(x=>x.warnings.length>0),c=a.flatMap(x=>x.errors),h=a.flatMap(x=>x.warnings);return!n&&(!r||!l)?null:i?e.jsxs("div",{className:t,children:[n&&e.jsxs(bs,{variant:"destructive",className:"mb-2",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx(Ns,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["พบข้อผิดพลาด ",c.length," ข้อ",l&&r&&` และคำเตือน ${h.length} ข้อ`]}),s&&e.jsx(U,{variant:"ghost",size:"sm",onClick:s,className:"h-auto p-1",children:e.jsx(Ie,{className:"h-4 w-4"})})]})})]}),!n&&l&&r&&e.jsxs(bs,{className:"mb-2",children:[e.jsx(Ls,{className:"h-4 w-4"}),e.jsx(Ns,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["พบคำเตือน ",h.length," ข้อ"]}),s&&e.jsx(U,{variant:"ghost",size:"sm",onClick:s,className:"h-auto p-1",children:e.jsx(Ie,{className:"h-4 w-4"})})]})})]})]}):e.jsxs("div",{className:t,children:[n&&e.jsxs(E,{className:"mb-4 border-red-200 bg-red-50",children:[e.jsxs(I,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(be,{className:"h-5 w-5 text-red-600"}),e.jsx(V,{className:"text-red-800",children:"ข้อผิดพลาดที่ต้องแก้ไข"})]}),s&&e.jsx(U,{variant:"ghost",size:"sm",onClick:s,className:"h-auto p-1 text-red-600 hover:text-red-800",children:e.jsx(Ie,{className:"h-4 w-4"})})]}),e.jsxs(G,{className:"text-red-700",children:["พบข้อผิดพลาด ",c.length," ข้อที่ต้องแก้ไขก่อนดำเนินการต่อ"]})]}),e.jsx(L,{children:e.jsx("ul",{className:"space-y-2",children:c.map((x,f)=>e.jsxs("li",{className:"flex items-start space-x-2 text-sm text-red-700",children:[e.jsx("span",{className:"text-red-500 mt-0.5",children:"•"}),e.jsx("span",{children:x})]},f))})})]}),l&&r&&e.jsxs(E,{className:"mb-4 border-yellow-200 bg-yellow-50",children:[e.jsxs(I,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ls,{className:"h-5 w-5 text-yellow-600"}),e.jsx(V,{className:"text-yellow-800",children:"คำเตือน"})]}),s&&e.jsx(U,{variant:"ghost",size:"sm",onClick:s,className:"h-auto p-1 text-yellow-600 hover:text-yellow-800",children:e.jsx(Ie,{className:"h-4 w-4"})})]}),e.jsxs(G,{className:"text-yellow-700",children:["พบคำเตือน ",h.length," ข้อ กรุณาตรวจสอบข้อมูล"]})]}),e.jsx(L,{children:e.jsx("ul",{className:"space-y-2",children:h.map((x,f)=>e.jsxs("li",{className:"flex items-start space-x-2 text-sm text-yellow-700",children:[e.jsx("span",{className:"text-yellow-500 mt-0.5",children:"•"}),e.jsx("span",{children:x})]},f))})})]})]})};function In({className:a=""}){const{error:s,lastUpdated:t}=le(),[r,i]=m.useState("saved"),[n,l]=m.useState("");m.useEffect(()=>{s?i("error"):t&&(i("saved"),l(new Date(t).toLocaleTimeString()))},[s,t]);const c=()=>{switch(r){case"saved":return e.jsx(ms,{className:"w-3 h-3"});case"saving":return e.jsx(Ze,{className:"w-3 h-3 animate-spin"});case"error":return e.jsx(ps,{className:"w-3 h-3"});default:return e.jsx(Wa,{className:"w-3 h-3"})}},h=()=>{switch(r){case"saved":return"bg-green-100 text-green-800 border-green-200";case"saving":return"bg-blue-100 text-blue-800 border-blue-200";case"error":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},x=()=>{switch(r){case"saved":return n?`บันทึกแล้ว ${n}`:"บันทึกแล้ว";case"saving":return"กำลังบันทึก...";case"error":return"เกิดข้อผิดพลาด";default:return"สถานะไม่ทราบ"}};return e.jsxs(se,{variant:"outline",className:`flex items-center gap-1 ${h()} ${a}`,children:[c(),e.jsx("span",{className:"text-xs",children:x()})]})}const Vn=({data:a,forceSave:s})=>(m.useEffect(()=>{if(a){const t=setTimeout(()=>{s()},1e3);return()=>clearTimeout(t)}},[a,s]),m.useEffect(()=>{const t=i=>{s(),i.preventDefault(),i.returnValue=""},r=()=>{document.hidden&&s()};return window.addEventListener("beforeunload",t),document.addEventListener("visibilitychange",r),()=>{window.removeEventListener("beforeunload",t),document.removeEventListener("visibilitychange",r)}},[s]),m.useEffect(()=>{const t=setInterval(()=>{a&&s()},3e4);return()=>clearInterval(t)},[a,s]),{saveNow:s,hasData:!!a});function zn({scenarios:a,currentScenario:s,onScenarioChange:t,onCompare:r}){return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-sm font-medium",children:"สถานการณ์:"}),e.jsx("select",{value:s,onChange:i=>t(i.target.value),className:"bg-background border border-border rounded px-2 py-1 text-sm",children:a.map(i=>e.jsx("option",{value:i,children:i==="base"?"ฐาน (Base)":i},i))})]}),e.jsxs(U,{size:"sm",variant:"outline",onClick:r,children:[e.jsx(ss,{className:"w-4 h-4 mr-1"}),"เปรียบเทียบ"]})]})}function Bn(){const[a,s]=m.useState(()=>{try{return localStorage.getItem("lastActiveTab")||"dashboard"}catch(T){return console.warn("Failed to load last active tab:",T),"dashboard"}}),{data:t,computationResult:r,validationResults:i,isLoading:n,error:l,scenarios:c,currentScenario:h,setCurrentScenario:x,clearError:f,forceSave:j}=le();Vn({data:t,forceSave:j});const{hasErrors:S,hasWarnings:R}=Qr();return m.useEffect(()=>{try{localStorage.setItem("lastActiveTab",a)}catch(T){console.warn("Failed to save active tab:",T)}},[a]),m.useEffect(()=>{const T=()=>{try{localStorage.setItem("lastActiveTab",a)}catch(w){console.warn("Failed to save active tab on beforeunload:",w)}};return window.addEventListener("beforeunload",T),()=>{window.removeEventListener("beforeunload",T)}},[a]),n&&!t?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx(la,{size:"xl",text:"กำลังเริ่มต้นระบบเสน่ห์ข้าวมันไก่..."})})}):e.jsx(Un,{children:e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b brand-header",children:e.jsx("div",{className:"container mx-auto px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ee,{className:"w-8 h-8 brand-icon"}),e.jsxs("div",{children:[e.jsx("h1",{className:"brand-title",children:"เสน่ห์ข้าวมันไก่"}),e.jsx("p",{className:"brand-subtitle",children:"SANAE CHICKEN RICE"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(zn,{scenarios:Object.keys(c),currentScenario:h,onScenarioChange:x,onCompare:()=>s("scenarios")}),e.jsx(In,{})]})]})})}),l&&e.jsx("div",{className:"container mx-auto px-4 py-2",children:e.jsx(at,{validationResults:[{isValid:!1,errors:[l],warnings:[]}],onDismiss:f,compact:!0})}),(S||R)&&e.jsx("div",{className:"container mx-auto px-4 py-2",children:e.jsx(at,{validationResults:i,onDismiss:f})}),e.jsx(Ln,{isLoading:n,text:"กำลังคำนวณ...",children:e.jsx("div",{className:"container mx-auto px-4 py-6 page-transition",children:e.jsxs(we,{value:a,onValueChange:s,className:"space-y-6",children:[e.jsxs(Pe,{className:"grid w-full grid-cols-9 gap-1",children:[e.jsxs(q,{value:"dashboard",className:"flex flex-col gap-1 p-3 tab-smooth hover-lift",children:[e.jsx(Ss,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"แดชบอร์ด"})]}),e.jsxs(q,{value:"sales",className:"flex flex-col gap-1 p-3 tab-smooth hover-lift",children:[e.jsx(xe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"ยอดขาย"})]}),e.jsxs(q,{value:"menu",className:"flex flex-col gap-1 p-3 tab-smooth hover-lift",children:[e.jsx(qa,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"เมนู & สูตร"})]}),e.jsxs(q,{value:"utilities",className:"flex flex-col gap-1 p-3 tab-smooth hover-lift",children:[e.jsx(qe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"สาธารณูปโภค"})]}),e.jsxs(q,{value:"labor",className:"flex flex-col gap-1 p-3 tab-smooth hover-lift",children:[e.jsx(Je,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"แรงงาน"})]}),e.jsxs(q,{value:"fixed",className:"flex flex-col gap-1 p-3 tab-smooth hover-lift",children:[e.jsx(Ee,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"ค่าใช้จ่ายคงที่"})]}),e.jsxs(q,{value:"scenarios",className:"flex flex-col gap-1 p-3 tab-smooth hover-lift",children:[e.jsx(ss,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"สถานการณ์"})]}),e.jsxs(q,{value:"reports",className:"flex flex-col gap-1 p-3 tab-smooth hover-lift",children:[e.jsx(vt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"รายงาน"})]}),e.jsxs(q,{value:"settings",className:"flex flex-col gap-1 p-3 tab-smooth hover-lift",children:[e.jsx(yt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"ตั้งค่า"})]})]}),e.jsx(J,{value:"dashboard",className:"space-y-6",children:e.jsx(Dr,{currentScenario:h,financialData:r})}),e.jsx(J,{value:"sales",className:"space-y-6",children:e.jsx(Yr,{})}),e.jsx(J,{value:"menu",className:"space-y-6",children:e.jsx(en,{})}),e.jsx(J,{value:"utilities",className:"space-y-6",children:e.jsx(an,{})}),e.jsx(J,{value:"labor",className:"space-y-6",children:e.jsx(rn,{})}),e.jsx(J,{value:"fixed",className:"space-y-6",children:e.jsx(nn,{})}),e.jsx(J,{value:"scenarios",className:"space-y-6",children:e.jsx(ln,{currentScenario:h,onScenarioChange:x})}),e.jsx(J,{value:"reports",className:"space-y-6",children:e.jsx(on,{financialData:r})}),e.jsx(J,{value:"settings",className:"space-y-6",children:e.jsx(Fn,{})})]})})})]})})}const oa=document.getElementById("root");if(!oa)throw new Error("Root element not found");bt(oa).render(e.jsx(Bn,{}));
